(function(e){function t(){this.items=new Array;this.itemsCount=0;this.put=function(e,t){if(!this.containsKey(e)){this.items[e]=t;this.itemsCount++}else this.items[e]=t};this.get=function(e){if(this.containsKey(e))return this.items[e];else return null};this.remove=function(e){if(this.containsKey(e)){delete this.items[e];this.itemsCount--}else throw"key '"+e+"' does not exists."};this.containsKey=function(e){return typeof this.items[e]!="undefined"};this.containsValue=function(t){for(var n in this.items)if(this.items[n]==t)return true;return false};this.contains=function(e){return this.containsKey(e)||this.containsValue(e)};this.clear=function(){this.items=new Array;itemsCount=0};this.size=function(){return this.itemsCount};this.isEmpty=function(){return this.size()==0}}function f(e,t,n){this.dec=e;this.group=t;this.neg=n}function l(){for(var e=0;e<a.length;e++){localeGroup=a[e];for(var t=0;t<localeGroup.length;t++)n.put(localeGroup[t],e)}}function c(e,t){if(n.size()==0)l();var r=".";var i=",";var s="-";if(t==false)if(e.indexOf("_")!=-1)e=e.split("_")[1].toLowerCase();else if(e.indexOf("-")!=-1)e=e.split("-")[1].toLowerCase();var o=n.get(e);if(o){var a=u[o];if(a){r=a[0];i=a[1]}}return new f(r,i,s)}var n=new t;var r=["ae","au","ca","cn","eg","gb","hk","il","in","jp","sk","th","tw","us"];var i=["at","br","de","dk","es","gr","it","nl","pt","tr","vn"];var s=["cz","fi","fr","ru","se","pl"];var o=["ch"];var u=[[".",","],[",","."],[","," "],[".","'"]];var a=[r,i,s,o];e.fn.formatNumber=function(t,n,r){return this.each(function(){if(n==null)n=true;if(r==null)r=true;var i;if(e(this).is(":input"))i=new String(e(this).val());else i=new String(e(this).text());var s=e.formatNumber(i,t);if(n)if(e(this).is(":input"))e(this).val(s);else e(this).text(s);if(r)return s})};e.formatNumber=function(t,n){var n=e.extend({},e.fn.formatNumber.defaults,n);var r=c(n.locale.toLowerCase(),n.isFullLocale);var i=r.dec;var s=r.group;var o=r.neg;var u="0#-,.";var a="";var f=false;for(var l=0;l<n.format.length;l++)if(u.indexOf(n.format.charAt(l))==-1)a=a+n.format.charAt(l);else if(l==0&&n.format.charAt(l)=="-")f=true;else break;var h="";for(var l=n.format.length-1;l>=0;l--)if(u.indexOf(n.format.charAt(l))==-1)h=n.format.charAt(l)+h;else break;n.format=n.format.substring(a.length);n.format=n.format.substring(0,n.format.length-h.length);var p=new Number(t);return e._formatNumber(p,n,h,a,f)};e._formatNumber=function(t,n,r,i,s){var n=e.extend({},e.fn.formatNumber.defaults,n);var o=c(n.locale.toLowerCase(),n.isFullLocale);var u=o.dec;var a=o.group;var f=o.neg;var l=false;if(isNaN(t))if(n.nanForceZero==true){t=0;l=true}else return null;if(r=="%")t=t*100;var h="";if(n.format.indexOf(".")>-1){var p=u;var d=n.format.substring(n.format.lastIndexOf(".")+1);if(n.round==true)t=new Number(t.toFixed(d.length));else{var v=t.toString();v=v.substring(0,v.lastIndexOf(".")+d.length+1);t=new Number(v)}var m=t%1;var g=new String(m.toFixed(d.length));g=g.substring(g.lastIndexOf(".")+1);for(var y=0;y<d.length;y++)if(d.charAt(y)=="#"&&g.charAt(y)!="0")p+=g.charAt(y);else if(d.charAt(y)=="#"&&g.charAt(y)=="0"){var b=g.substring(y);if(b.match("[1-9]"))p+=g.charAt(y);else break}else if(d.charAt(y)=="0")p+=g.charAt(y);h+=p}else t=Math.round(t);var w=Math.floor(t);if(t<0)w=Math.ceil(t);var E="";if(n.format.indexOf(".")==-1)E=n.format;else E=n.format.substring(0,n.format.indexOf("."));var S="";if(!(w==0&&E.substr(E.length-1)=="#")||l){var x=new String(Math.abs(w));var T=9999;if(E.lastIndexOf(",")!=-1)T=E.length-E.lastIndexOf(",")-1;var N=0;for(var y=x.length-1;y>-1;y--){S=x.charAt(y)+S;N++;if(N==T&&y!=0){S=a+S;N=0}}if(E.length>S.length){var C=E.indexOf("0");if(C!=-1){var k=E.length-C;var L=E.length-S.length-1;while(S.length<k){var A=E.charAt(L);if(A==",")A=a;S=A+S;L--}}}}if(!S&&E.indexOf("0",E.length-1)!==-1)S="0";h=S+h;if(t<0&&s&&i.length>0)i=f+i;else if(t<0)h=f+h;if(!n.decimalSeparatorAlwaysShown)if(h.lastIndexOf(u)==h.length-1)h=h.substring(0,h.length-1);h=i+h+r;return h};e.fn.parseNumber=function(t,n,r){if(n==null)n=true;if(r==null)r=true;var i;if(e(this).is(":input"))i=new String(e(this).val());else i=new String(e(this).text());var s=e.parseNumber(i,t);if(s){if(n)if(e(this).is(":input"))e(this).val(s.toString());else e(this).text(s.toString());if(r)return s}};e.parseNumber=function(t,n){var n=e.extend({},e.fn.parseNumber.defaults,n);var r=c(n.locale.toLowerCase(),n.isFullLocale);var i=r.dec;var s=r.group;var o=r.neg;var u="1234567890.-";while(t.indexOf(s)>-1)t=t.replace(s,"");t=t.replace(i,".").replace(o,"-");var a="";var f=false;if(t.charAt(t.length-1)=="%"||n.isPercentage==true)f=true;for(var l=0;l<t.length;l++)if(u.indexOf(t.charAt(l))>-1)a=a+t.charAt(l);var h=new Number(a);if(f){h=h/100;var p=a.indexOf(".");if(p!=-1){var d=a.length-p-1;h=h.toFixed(d+2)}else h=h.toFixed(a.length-1)}return h};e.fn.parseNumber.defaults={locale:"us",decimalSeparatorAlwaysShown:false,isPercentage:false,isFullLocale:false};e.fn.formatNumber.defaults={format:"#,###.00",locale:"us",decimalSeparatorAlwaysShown:false,nanForceZero:true,round:true,isFullLocale:false};Number.prototype.toFixed=function(t){return e._roundNumber(this,t)};e._roundNumber=function(e,t){var n=Math.pow(10,t||0);var r=String(Math.round(e*n)/n);if(t>0){var i=r.indexOf(".");if(i==-1){r+=".";i=0}else i=r.length-(i+1);while(i<t){r+="0";i++}}return r}})(jQuery);var Zoomdata=function(e){var t={};t.Visualizations=t.Visualizations||{};t.MVC=_.clone(e.Backbone);t.eventDispatcher=_.clone(t.MVC.Events);e.Backbone.sync=function(e,n,r){var i=_.result(n,"url"),s=n.remote,o=n.secure,u=n.apiKey;r||(r={});if(!r.crossDomain)r.crossDomain=true;if(!r.xhrFields)r.xhrFields={withCredentials:false};if(s)r.url=[o?"https://":"http://",s+"/",i].join("");if(u)r.data=$.extend({},r.data,{key:u});return t.MVC.sync(e,n,r)};t.MVC.View=e.Backbone.View.extend({defaults:{},initialize:function(e){this.childViews=[];this.options=$.extend({},this.defaults,e)},_removeChildViews:function(){_.each(this.childViews,function(e){e?e.remove():null});this.childViews=[]},popChildView:function(e){var t=this.childViews,n=t.indexOf(e);return n!==-1?t.splice(n,1):null},empty:function(){this._removeChildViews();this.$el.children().remove();return this},remove:function(){this._removeChildViews();Backbone.View.prototype.remove.call(this,arguments)},delegateEvents:function(){Backbone.View.prototype.delegateEvents.apply(this,arguments);_.each(this.childViews,function(e){if(e&&e.delegateEvents)e.delegateEvents()})}});t.MVC.Model=e.Backbone.Model.extend({initialize:function(t,n){n=n||{};this.secure=this.collection?this.collection.secure:null;this.remote=this.collection?this.collection.remote:null;this.apiKey=this.collection?this.collection.apiKey:null;if(typeof n.apiKey!=="undefined"){this.apiKey=n.apiKey;delete n.apiKey}if(typeof n.remote!=="undefined"){this.remote=n.remote;delete n.remote;if(typeof n.secure!=="undefined"){this.secure=n.secure;delete n.secure}else this.secure=false}e.Backbone.Model.prototype.initialize.apply(this,arguments)},isBootstrapped:function(){this._bootstrapped=this._bootstrapped||false;return this._bootstrapped?true:false},bootstrap:function(){var e=$.Deferred(),t=this;if(!this.isBootstrapped())this.fetch().done(function(n){t._bootstrapped=true;e.resolve(n)}).fail(e.reject).progress(e.notify);else e.resolve(this.toJSON());return e.promise()},matchesSearch:function(e,t){t=t||{};var n="g"+(t.caseSensitive?"":"i"),r=t.words?new RegExp("(\\W|^)"+t.needle+"(\\W|$)",n):t.regExp?new RegExp(t.needle,n):new RegExp(t.needle,n);if(typeof t.needle!=="undefined"&&t.needle!=="")return!!this.get(e).match(r);else return false}});t.MVC.Collection=e.Backbone.Collection.extend({initialize:function(t,n){n=n||{};this.apiKey=null;this.remote=null;this.secure=null;if(typeof n.apiKey!=="undefined"){this.apiKey=n.apiKey;delete n.apiKey}if(typeof n.remote!=="undefined"){this.remote=n.remote;delete n.remote;if(typeof n.secure!=="undefined"){this.secure=n.secure;delete n.secure}else this.secure=false}e.Backbone.Collection.prototype.initialize.apply(this,arguments)},add:function(){e.Backbone.Collection.prototype.add.apply(this,arguments);return this},fetchModels:function(e){var t=$.Deferred(),n=0,r=0,i=this.length,s=[],o=this;this.each(function(u){u.fetch(e).done(function(e){n++;s.push(e);t.notify(u,e);if(s.length===i&&r===0)t.resolve(o,s)}).fail(function(e){r++;s.push(e);t.notify(u,e);if(s.length==i&&r>0)t.reject(o,s)})});return t},saveModels:function(){var e=$.Deferred(),t=0,n=0,r=[],i=this;this.each(function(s){s.save().done(function(o){t++;r.push(o);e.notify(s,o);if(r.length===i.length&&n===0)e.resolve(i,r)}).fail(function(t){n++;r.push(t);e.notify(s,t);if(r.length==i.length&&n>0)e.reject(i,r)})});return e},setIdOrder:function(e){var t=this.comparator,n=function(t){var n=t.cid;return e.indexOf(n)};this.comparator=n;this.sort();this.comparator=t},hasNewModels:function(){var e=false;this.each(function(t){if(t.isNew())e=true});return e},isBootstrapped:function(){this._bootstrapped=this._bootstrapped||false;return this._bootstrapped?true:false},bootstrap:function(e){var t=$.Deferred(),n=this;if(!this.isBootstrapped())this.fetch(e).done(function(e){n._bootstrapped=true;t.resolve(e)}).fail(t.reject).progress(t.notify);else t.resolve(this.toJSON());return t.promise()},search:function(e,t){t=t||{};var n=[],r="g"+(t.caseSensitive?"":"i"),i=t.words?new RegExp("(\\W|^)"+t.needle+"(\\W|$)",r):t.regExp?new RegExp(t.needle,r):new RegExp(t.needle,r);if(typeof t.needle!=="undefined"&&t.needle!=="")n=this.filter(function(t){return!!t.get(e).match(i)});else n=this.models;return n},fetch:function(){var t=this;this.trigger("request:collection",this);return e.Backbone.Collection.prototype.fetch.apply(this,arguments).done(function(e,n,r){t.trigger("sync:collection",t,r)})}});t.DataStreamProvider=function(){function e(e){var t=function(e){var t=this;this._dfd=$.Deferred();this.socket=new WebSocket(e);this.socket.onerror=function(){t._dfd.reject.call(t._dfd,arguments)};this.type="WebSocket";this.publish()};t.prototype={publish:function(t){var n=this;this.socket.onopen=function(e){var r=Array.prototype.slice.call(arguments,0);if(n.onOpen)n.onOpen.apply(n,r);r.unshift("stream:open");if(t)t.trigger.apply(t,r);n._dfd.resolve.call(n._dfd,e)};this.socket.onclose=function(e){var r=Array.prototype.slice.call(arguments,0);if(n.onClose)n.onClose.apply(n,r);r.unshift("stream:close");if(t)t.trigger.apply(t,r)};this.socket.onmessage=function(e){var r=Array.prototype.slice.call(arguments,0),i=JSON.parse(e.data),s=i.status||"message";if(n.onMessage)n.onMessage.apply(n,r);if(i.error)s="error";else if(i.status)s=i.status;else s="message";r.unshift("stream:"+s);if(t)t.trigger.apply(t,r)}},send:function(){var e=this,t=arguments;this._dfd.done(function(){e.socket.send.apply(e.socket,t)})},onOpen:function(e){this._dfd.done(e)},onClose:$.noop,onMessage:function(e){this._dfd.done(e)}};return new t(e)}return{getStream:e}}();return t}(window);(function(){var e=0;var t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n){window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(t,n){var r=(new Date).getTime();var i=Math.max(0,16-(r-e));var s=window.setTimeout(function(){t(r+i)},i);e=r+i;return s};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(e){clearTimeout(e)}})();(function(e,t){function u(e,t){return e<t?"0"+e:e.toString()}function a(e){return decodeURIComponent(((new RegExp("[?|&]"+e+"="+"([^&;]+?)(&|#|;|$)")).exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function f(e){return decodeURIComponent(((new RegExp("[?|&]"+e+"="+"([^&;]+?)(&|#|;|$)")).exec(location.hash)||[,""])[1].replace(/\+/g,"%20"))||null}function l(){var e=[],t={};if(location.search.indexOf("?")!==-1)e=location.search.split("?")[1].split("#")[0].split("&");for(var n=0;n<e.length;n++){var r=e[n].split("=");t[r[0]]=r[1]}var i=t.server||window.location.hostname;var s=t.port||location.port||false;var o=(location.protocol=="https:"?"wss":"ws")+"://"+i+(s?":"+s:"")+"/zoomdata/websocket/"+(t.key?"?key="+t.key:"");return{host:o,time:(new Date).getTime(),params:t}}function c(e,t){var n=e.visualizations||[],r=t||a("visId");for(var i=0;i<n.length;i++)if(n[i].visId==r){var s=n[i];return s}}function h(e){var t=["avg","min","max","sum"];if(e)p(e)&&t.push("last_value");return t}function p(e){if(!e){throw new ReferenceError("Source needed");return null}if(e.toRequest().cfg.group.metrics.length>1)return false;return e.config.attributes.source.sourceFeatures.indexOf("LV_METRIC")>=0}function d(e){var t=["MONEY","INTEGER","NUMBER","COUNT OF","FORMULA"];return t.indexOf(e.toUpperCase())>=0}function v(e){var t=e.visualizations;var n=a("visId");for(var r=0;r<t.length;r++)if(t[r].visId==n){var i=t[r];return i.source}}function m(e){if(e>=12)e=e-12;if(e===0)e=12;return e}function g(e){var t=new Date(Math.round(e));var n=t.getHours()>=12?" PM":" AM";return m(t.getHours())+":"+u(t.getMinutes(),10)+":"+u(t.getSeconds(),10)+n}function y(e,t,n){var r=new Date(Math.round(e));var i=n?r.getUTCMonth():r.getMonth(),s=n?r.getUTCDate():r.getDate(),o=n?r.getUTCFullYear():r.getFullYear();i+=1;if(i<10)i="0"+i;return t?i+"/"+s+"/"+o:o+"/"+i+"/"+s}function b(e){var t=new Date(Math.round(e));var n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return t.getDate()+" "+n[t.getMonth()]+" "+(1900+t.getYear())}function w(e,t){return y(e,t)+" "+g(e)}function E(e){var t=new Date(e);var n=t.getTimezoneOffset()/-60;return"GMT"+(n>0?"+":"")+n}function S(){var e=jstz.determine();return e.name()}function x(){return window.pageUserData}function N(e){this.options=$.extend({},this.defaults,e);this.$el=$('<div class="zd-radial-item-filter"></div>');this.$donut=$('<div class="zd-radial-item-donut"></div>').appendTo(this.$el);this.$filler=$('<div class="zd-radial-item-filler"></div>').appendTo(this.$el);this.$center=$('<div class="zd-radial-item-center"></div>').appendTo(this.$donut);this.positionElements()}var n={},r=_.template('            <div class="fsWrapper">                <div class="well well-small fsHeader">                    <div class="fsHead pull-left"></div>                    <div class="filters"></div>                    <div class="exitFullscreen"><i class="zd icon exit-fullscreen"></i></div>                    <div class="clearfix"></div>                </div>                <div class="well-small well fsBody">                    <div class="fullScreenContainer"></div>                    <div class="fullScreenContainerFooter"></div>                </div>                <div class="bottomPane">                        <div class="paneContent"></div>                 </div>             </div>            <div class="fsExpander"></div>            '),i=t.MVC.View.extend({className:"fullScreenView",template:r,events:{"click .exitFullscreen":"close"},initialize:function(){t.MVC.View.prototype.initialize.apply(this,arguments);this.$el.appendTo("body");this.$el.hide(0);this.$el.append(this.template());this.$wraper=this.$(".fsWrapper");this.$header=this.$(".fsHeader");this.$head=this.$(".fsHead");this.$body=this.$(".fullScreenContainer");this.$labels=this.$(".widgetLabel");this.$styles=this.$("style");this.$filters=this.$(".filters");this.$footer=this.$(".fullScreenContainerFooter");this.$expander=this.$(".fsExpander");this.listenTo(t.eventDispatcher,"switch:section",this.close)},render:function(e){var n=this,r=$(".dashboard > .leftPane"),i=$(".dashboard > .bottomPane"),s=e.header,o=e.content,u=e.toolbar,a=e.filters,f=e.labels,l=e.styles,c=e.styleId,h=e.time;this.options=$.extend({},this.options,e);this.$body.empty();this.$head.empty();this.$filters.empty();this.$footer.empty();this._runAnimationShowUp(function(){n.$el.fadeIn(function(){n.$head.append(s);a&&n.$filters.append(a.clone(true));u&&n.$body.append(u);f&&n.$body.append(f);l&&n.$body.append(l)&&n.$body.attr("id",c)&&l.scopedPolyFill();n.$body.append(o);n.$footer.append(h);r.addClass("fullScreen");i.addClass("fullScreen");n.delegateEvents();n.adjustBodySizes();n._applyClickEvents(true);n.trigger("open")});n.$wraper.css({opacity:0});n.$body.css({opacity:0})});this.listenTo(t.eventDispatcher,"filters:validate",function(e){n.$filters.empty();n.$filters.append(a.clone(true));n._applyClickEvents(false);n._applyClickEvents(true)})},_applyClickEvents:function(e){function i(){t.eventDispatcher.trigger("filtersPalette:show")}var n=this,r=this.$filters.find(".expbtn");e?r.on("click",i):r.off("click")},_runAnimationShowUp:function(e){e();var t=this,n=this.options.widget.$el,r=n.offset(),i=n.width(),s=n.height(),o=300;this.$expander.css({position:"absolute",top:r.top,left:r.left,width:i,height:s}).show();$('<style id="transferEffect" type="text/css">'+".zoomin-transfer {                     background-color: #FFF;                     z-index: 1029;                    margin-top: 25px;                }"+"</style>").appendTo("body");this.$expander.effect("transfer",{to:$(".midPane"),className:"zoomin-transfer"},o,function(){$("#transferEffect").remove();t.$expander.hide()});setTimeout(function(){t.$wraper.css({opacity:1});t.$body.css({opacity:1})},o-100)},_closeAnimation:function(e,t){if(!this.options.widget)return;if(t==="click"){var n=this,r=this.$body.offset(),i=this.$body.width(),s=this.$body.height(),o=this.$body.find("svg"),u=300;this.$expander.css({position:"absolute",top:r.top-60,left:0,width:i+70,height:s+120}).show();$('<style id="transferEffect" type="text/css">'+".zoomin-transfer {                         background-color: #FFF;                         z-index: 1029;                        margin-top: 25px;                        opacity: 0.8;                    }"+"</style>").appendTo("body");this.$expander.effect("transfer",{to:this.options.widget.$el,className:"zoomin-transfer"},u,function(){$("#transferEffect").remove();n.$expander.hide()});setTimeout(function(){n.$wraper.css({opacity:0});n.$body.css({opacity:0});e()},u-100)}else e()},close:function(e){var n=this,r=$(".dashboard > .leftPane"),i=$(".dashboard > .bottomPane"),s=e.type;r.removeClass("fullScreen");i.removeClass("fullScreen");if(this.filtersIndicator)delete this.filtersIndicator.options.rootFullscreen;this._closeAnimation(function(){n.$el.fadeOut("fast",function(){n.trigger("close")})},s);n._applyClickEvents(false);this.stopListening(t.eventDispatcher,"visualization:start");this.stopListening(t.eventDispatcher,"filters:validate")},adjustBodySizes:function(){var e=this.$body.parent().prev(),t=e.offset().top+e.outerHeight()+parseFloat(e.css("margin-bottom"));this.$body.parent().css("top",t)}});n.FullScreenView=new i;var s=_.template('        <div class="modal hide fade">            <div class="modal-header">                <button title="Close" value="dialog-reject" class="close">&times;</button>                <h3 class="dialog-head pull-left"></h3>                <div class="clearfix"></div>            </div>            <div class="modal-body dialog-body">            </div>            <div class="modal-footer dialog-controls">                <button title="<%= rejectButtonTitle %>" value="dialog-reject" class="btn btnNo"><%= rejectButtonLabel %></button>                <button title="<%= acceptButtonTitle %>" value="dialog-accept" class="btn btn-primary btnYes"><%= acceptButtonLabel %></button>            </div>        </div>    ');n.Dialog=t.MVC.View.extend({defaults:{template:s,mode:"dialog",draggable:false,wide:false,modal:"static",rejectButtonLabel:"Close",acceptButtonLabel:"Accept",rejectButtonTitle:"Close",acceptButtonTitle:"Accept"},events:{'click button[value="dialog-reject"]':"hide",'click button[value="dialog-accept"]':"accept"},initialize:function(e){var t=this;this.settings=$.extend({},this.defaults,e);this.setElement(this.settings.template({rejectButtonLabel:this.settings.rejectButtonLabel,acceptButtonLabel:this.settings.acceptButtonLabel,rejectButtonTitle:this.settings.rejectButtonTitle,acceptButtonTitle:this.settings.acceptButtonTitle}));this.$el.appendTo("body");this.$el.modal({show:false,backdrop:this.settings.modal,keyboard:false});switch(this.settings.mode){case"alert":this.$('button[value="dialog-accept"]').hide();break}this.$head=this.$(".dialog-head");this.$body=this.$(".dialog-body");if(this.settings.draggable)this.$el.draggable({start:function(){t.$el.removeClass("fade")},stop:function(){t.$el.addClass("fade")},cursor:"move"});if(this.settings.wide)this.$el.addClass("wide")},render:function(e,t){this.$body.empty();this.$head.empty();this.$body.append(e);if(t!==undefined){this.$head.append(t);this.$head.show()}else this.$head.hide();this.$el.modal("show");this.delegateEvents()},onBeforeHide:$.noop,hide:function(){var e=this;if(this.onBeforeHide()!==false){this.$el.one("hidden",function(){e.trigger("dialog:rejected");e.remove();e.onReject()});this.$el.modal("hide")}},onReject:$.noop,onBeforeAccept:$.noop,accept:function(){var e=this;if(this.onBeforeAccept()!==false){this.$el.one("hidden",function(){e.trigger("dialog:accepted");e.remove();e.onAccept()});this.$el.modal("hide")}},onAccept:$.noop});var o=_.template('        <span><%= message %></span>        <i title="<%= acceptTitle%>" class="icon-ok icon-white"></i>        <i title="<%= cancelTitle%>" class="icon-remove icon-white"></i>    ');n.ConfirmMessage=t.MVC.View.extend({tagName:"span",className:"label label-warning pull-right confirmMessage",defaults:{template:o,message:"Warning",acceptTitle:"Accept",cancelTitle:"Cancel"},events:{"click .icon-ok":"accept","click .icon-remove":"cancel"},initialize:function(e){this.settings=$.extend({},this.defaults,e);this._deferred=$.Deferred();this.result=this._deferred.promise()},accept:function(){this.remove();this._deferred.resolve()},cancel:function(){this.remove();this._deferred.reject()},render:function(){this.$el.html(this.settings.template({message:this.settings.message,acceptTitle:this.settings.acceptTitle,cancelTitle:this.settings.cancelTitle}));this.delegateEvents();return this}});n.getTimestamp=function(e){var t=e.split(" ")[0];var n=t.replace(/-/g,"/");e=e.replace(t,n);var r=(new Date(e)).getTime();return!isNaN(r)?r:parseInt(e,10)};n.isNotUndefinedOrNull=function(t){return t!==undefined&&t!==null};n.isFirstTime=function(e){var t="zd_first_enter_ts-"+e,r=n.getCookie(t),i=(new Date).getTime(),s=1e3*60*60*24;if($.isNumeric(r))if(i- +r<s)return true;else return false;else{n.setCookie(t,(new Date).getTime());return true}};n.setCookie=function(t,n,r){var i=new Date;i.setDate(i.getDate()+r);var s=escape(n)+(r===null?"":"; expires="+i.toUTCString());document.cookie=t+"="+s};n.getCookie=function(t){var r=window.sessionStorage.sessionId;if(!n.isNotUndefinedOrNull(r)){var i=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));r=i?decodeURIComponent(i[1]):undefined}return r};n.namespace=function(e,t){var n=[],r=t||window;if(e)n=e.split(".");$.each(n,function(e,t){if(!r.hasOwnProperty(t))r[t]={};r=r[t]});return r};n.preventUnsavedGestures=function(){if(!navigator.userAgent.match(/Macintosh/))return;if(navigator.userAgent.match(/Chrome/)){var e=$(window);t.Utilities.turnOnPrompt("Are you sure you want to leave the page unsaved?");e.mousewheel(function(e,t,n,r){var i,s;i=n<0&&!_($(e.target).parents()).detect(function(e){return $(e).scrollLeft()>0});s=n>0&&!_($(e.target).parents()).detect(function(e){return $(e).scrollLeft()<0});if(i||s){console.log(i,s);e.preventDefault()}})}};n.turnOnPrompt=function(e){var t=$(window),n=e?e:null;t.unbind("beforeunload");t.bind("beforeunload",function(){return n})};n.turnOffPrompt=function(){$(window).unbind("beforeunload")};var T=Math.sqrt(2);N.prototype={defaults:{start:-30,angle:120,gap:8,radius:200,width:60,color:"rgba(0, 0, 0, 0.7)"},maxAngle:160,positionElements:function(){var e=this,t=this.options.gap,n=this.options.radius,r=Math.max(this.options.angle,1),i=90-this.options.start,s=90-r,o=n*(1+(s<0?Math.sin(-s/180*Math.PI):0)),u=this.options.radius,a=this.options.width,f=parseInt(this.$center.width())||20,l=parseInt(this.$center.height())||20,c=u-a;var h=/(iPhone|iPod|iPad)/i.test(navigator.userAgent);var p=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);e.$el.css({width:o,height:o,borderWidth:t/2+"px",transform:h||p?i===1?"rotate("+i+"deg)":"rotate("+i+"deg) "+"skew(0deg, "+s+"deg)":"rotate("+i+"deg) "+"skew(0deg, "+s+"deg)",transformOrigin:"100% 100%"});e.$donut.css({left:o-u,top:o-u,width:2*u,height:2*u,borderWidth:a,transform:h||p?i===1?"rotate("+ -(r-90)/2+"deg)":"skew(0deg, "+ -s+"deg) rotate("+ -(r-90)/2+"deg)":"skew(0deg, "+ -s+"deg) rotate("+ -(r-90)/2+"deg)"});if(h||p){e.$el.css({transition:"0.1s ease-in","-ms-transition":"0.1s ease-in","-moz-transition":"0.1s ease-in","-webkit-transition":"0.1s ease-in"});e.$donut.css({transition:"0.1s ease-in","-ms-transition":"0.1s ease-in","-moz-transition":"0.1s ease-in","-webkit-transition":"0.1s ease-in"})}e.$filler.css({left:o-c,top:o-c,width:2*c,height:2*c,transform:"skew(0deg, "+ -s+"deg)"});e.$center.css({left:-(c*(T/2-1)+a*(T/4)+f/2),top:-(c*(T/2-1)+a*(T/4)+l/2),transform:"rotate("+((r-90)/2-i)+"deg)"})},get:function(){var e=[];if(arguments.length==0)e=this.options;else if(arguments.length==1)e=this.options[arguments[0]]||null;else for(var t=0;t<arguments.length;t++)e[arguments[t]]=this.options[arguments[t]]||null;return e},set:function(e){typeof e.start=="number"&&(this.options.start=e.start);typeof e.angle=="number"&&(this.options.angle=Math.min(e.angle,this.maxAngle));typeof e.gap=="number"&&(this.options.gap=e.gap);typeof e.radius=="number"&&(this.options.radius=e.radius);typeof e.width=="number"&&(this.options.width=e.width);typeof e.color=="number"&&(this.options.color=e.color);this.positionElements()},close:function(){var e=this.options;this.set({start:e.start+e.angle/2,angle:0})},remove:function(){this.$el.remove()}};n.Arc=N;n.getURLParameter=a;n.getHashParameter=f;n.parseUrlParams=l;n.getVisualizationDetails=c;n.getSourceDetails=v;n.pad=u;n.hoursToAMPM=m;n.formattedTimeOnly=g;n.formattedDateOnly=y;n.formattedDate=w;n.timeZoneFromTime=E;n.determineTimeZone=S;n.formattedDateMonth=b;n.getPageUserData=x;n.getFunctionsForMetric=h;n.hasLastValue=p;n.isNumericAttributeType=d;n.time={};n.time.getPreviousHour=function(e){return e-n.time.millisecondsIn.hour};n.time.getMaxStepLimit=function(){return 62},n.time.getLowerStep=function(e){var t="",n=["MINUTE","HOUR","DAY","WEEK","MONTH","YEAR"],r=n.indexOf(e),i=r-1;if(i<0)t="MINUTE";else t=n[i];return t};n.time.getMaxStep=function(e,t){var n=null,r=["MINUTE","HOUR","DAY","WEEK","MONTH","YEAR"],i=r.indexOf(e),s=r.indexOf(t);if(i===-1)throw"Step 1 is wrong";if(s===-1)throw"Step 2 is wrong";if(i>s)n=e;else n=t;return n};n.time.getDaysInMonth=function(e){var t=new Date(e);t.setDate(15);t.setMonth(t.getMonth()+1);t.setDate(0);return t.getDate()};n.time.formatAMPM=function(e){var t=e.getHours();var n=e.getMinutes();var r=t>=12?"pm":"am";t=t%12;t=t?t:12;n=n<10?"0"+n:n;var i=t+":"+n+" "+r;return i};n.time.formatAMPMForHours=function(e){var t=e.getHours();var n=e.getMinutes();var r=t>=12?"pm":"am";t=t%12;t=t?t:12;n=n<10?"0"+n:n;var i=t+" "+r;return i};n.time.getWeekNumber=function(e){e=new Date(e);e.setHours(0,0,0);e.setDate(e.getDate()+4-(e.getDay()||7));var t=new Date(e.getFullYear(),0,1);var n=Math.ceil(((e-t)/864e5+1)/7);return[e.getFullYear(),n]};n.time.getRangeForStep=function(e,t,n,r){function o(e){e.setMilliseconds(0);e.setSeconds(0);e.setMinutes(0);return e}function u(e){e.setDate(e.getDate()-e.getDay());return e}var i=new Date(e),s=new Date(t);switch(n){case"MINUTE":break;case"HOUR":if(!r){o(i);o(s)}s.setHours(s.getHours());break;case"DAY":if(!r){o(i);i.setHours(0);o(s);s.setHours(0)}s.setDate(s.getDate());break;case"WEEK":if(!r){o(i);i.setHours(0);u(i);o(s);s.setHours(0);u(s)}s.setDate(s.getDate()+7);break;case"MONTH":if(!r){o(i);i.setHours(0)}i.setDate(1);if(!r){o(s);s.setHours(0)}s.setDate(1);s.setMonth(s.getMonth());break;case"YEAR":if(!r){o(i);i.setHours(0);i.setDate(0);i.setMonth(0);o(s);s.setHours(0);s.setDate(0);s.setMonth(0)}break}return{min:i,max:s}};n.time.recalculateLimit=function(e,t,r){var i=1,s=1,o=n.time.getMaxStepLimit();switch(e){case"MINUTE":s=t;break;case"HOUR":s=t*60;break;case"DAY":s=t*60*24;break;case"WEEK":s=t*60*24*7;break;case"MONTH":s=t*60*24*31;break;case"YEAR":s=t*60*24*365;break}switch(r){case"MINUTE":i=s;break;case"HOUR":i=s/60;break;case"DAY":i=s/60/24;break;case"WEEK":i=s/60/24/7;break;case"MONTH":i=s/60/24/31;break;case"YEAR":i=s/60/24/365;break}i=Math.ceil(i);return i>o?o:i};n.time.getRoundedDateRange=function(e,n,r,i){var s="MINUTE",o=0,u=60,a=n.getTime()-e.getTime();if(a<=t.Utilities.time.millisecondsIn.hour&&!r){s="MINUTE";o=n.getMinutes()-e.getMinutes();u=o<=0?o+61:o+1}else if(a<=t.Utilities.time.millisecondsIn.day&&!r){s="HOUR";o=n.getHours()-e.getHours();u=o<=0?o+25:o+1}else if(a<=t.Utilities.time.millisecondsIn.day*29&&!r){s="DAY";o=n.getDate()-e.getDate()+(n.getMonth()-e.getMonth())*t.Utilities.time.getDaysInMonth(e);u=o<=0?o+t.Utilities.time.getDaysInMonth(e):o+1}else if(a<=t.Utilities.time.millisecondsIn.day*60&&!r){s="WEEK";o=t.Utilities.time.getWeekNumber(n)[1]-t.Utilities.time.getWeekNumber(e)[1];var f=new Date(e.getFullYear(),11,31);u=o<=0?o+t.Utilities.time.getWeekNumber(f)[1]:o+1}else if(a<=t.Utilities.time.millisecondsIn.day*365&&!r){s="MONTH";o=n.getMonth()-e.getMonth();u=o<=0?o+13:o+1}else if(a>t.Utilities.time.millisecondsIn.day*365&&!r){s="YEAR";o=n.getFullYear()-e.getFullYear();u=o+1}u=u-1;if(r){switch(r){case"MINUTE":u=a/1e3/60;break;case"HOUR":u=a/1e3/60/60;break;case"DAY":u=a/1e3/60/60/24;break;case"WEEK":u=a/1e3/60/60/24/7;break;case"MONTH":u=a/1e3/60/60/24/30;break;case"YEAR":u=a/1e3/60/60/24/365;break}s=r;u=Math.ceil(u)+(i?1:0)}return{step:s,amount:u}};n.time.days=[{acr:"Sun",full:"Sunday"},{acr:"Mon",full:"Monday"},{acr:"Tue",full:"Tuesday"},{acr:"Wed",full:"Wednesday"},{acr:"Thu",full:"Thursday"},{acr:"Fri",full:"Friday"},{acr:"Sat",full:"Saturday"}];n.time.months=[{acr:"Jan",full:"January",days:31},{acr:"Feb",full:"February",days:28},{acr:"Mar",full:"March",days:31},{acr:"Apr",full:"April",days:30},{acr:"May",full:"May",days:31},{acr:"Jun",full:"June",days:30},{acr:"Jul",full:"July",days:31},{acr:"Aug",full:"August",days:31},{acr:"Sep",full:"September",days:30},{acr:"Oct",full:"October",days:31},{acr:"Nov",full:"November",days:30},{acr:"Dec",full:"December",days:31}];n.time.millisecondsIn={};n.time.millisecondsIn.sec=1e3;n.time.millisecondsIn.min=n.time.millisecondsIn.sec*60;n.time.millisecondsIn.hour=n.time.millisecondsIn.min*60;n.time.millisecondsIn.day=n.time.millisecondsIn.hour*24;n.time.millisecondsIn.week=n.time.millisecondsIn.day*7;n.time.millisecondsIn.month=n.time.millisecondsIn.day*31;n.time.getEndTimeWithinStep=function(e,t){var n=new Date(e);switch(t){case"MINUTE":n.setMilliseconds(0);n.setSeconds(0);n.setMinutes(n.getMinutes()+1);break;case"HOUR":n.setMilliseconds(0);n.setSeconds(0);n.setMinutes(0);n.setHours(n.getHours()+1);break;case"DAY":n.setMilliseconds(0);n.setSeconds(0);n.setMinutes(0);n.setHours(0);n.setDate(n.getDate()+1);break;case"WEEK":n.setMilliseconds(0);n.setSeconds(0);n.setMinutes(0);n.setHours(0);n.setDate(n.getDate()+7);break;case"MONTH":n.setMilliseconds(0);n.setSeconds(0);n.setMinutes(0);n.setHours(0);n.setDate(1);n.setMonth(n.getMonth()+1);break;case"YEAR":n.setMilliseconds(0);n.setSeconds(0);n.setMinutes(0);n.setHours(0);n.setDate(1);n.setMonth(0);n.setFullYear(n.getFullYear()+1);break}return n.getTime()};n.log10=function(e){return Math.log(e)/Math.log(10)};n.isRetina=function(){return window.devicePixelRatio>1};n.toTitleCase=function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})};n.MODE={NORMAL:0,WIDGET:1,EMBEDDED:2,NATIVE:3};var C=-1;n.mode=function(){if(C!==-1)return C;C=n.MODE.NORMAL;var e=a("__target");if(e==="widget")C=n.MODE.WIDGET;else if(e==="embedded")C=n.MODE.EMBEDDED;else{var t=/(iPhone|iPod|iPad)/i.test(navigator.userAgent);var r=/(Safari)/i.test(navigator.userAgent);if(t&&!r)C=n.MODE.NATIVE}return C};n.getHiddenControls=function(){var e=a("hidecontrol");if(e)e=e.split(",");else e=[];console.log("hiddenControls",e);return e};n.visualizationStartedUnique={_counter:0};n.visualizationStarted=function(e){var r={WORD_CLOUD:1e3,ZOOMABLE_MAP:2e3,VERTICAL_BARS:100,HEAT_MAP:1e3,MULTI_METRIC_TREND:100,SIDE_BY_SIDE_BARS:900,STACKED_BARS:900,TRENDS:100,PIE:600,PIVOT_TABLE:100,DEFAULT:100},i=r.DEFAULT,s=t.main?t.main.currentSection.widgetGrid.collection.length:null;if(e){if(n.visualizationStartedUnique[e.UUID])return false;else n.visualizationStartedUnique[e.UUID]=true;i=e.customReadyStatusDelay?e.customReadyStatusDelay:r[e.config.type]||r.DEFAULT;i+=1002}var o="screenshot_status_ready",u=$("body");setTimeout(function(){n.visualizationStartedUnique._counter++;if(s===n.visualizationStartedUnique._counter){u.addClass(o);console.log(e.UUID+" started with delay "+i+"ms.")}},i);return true};n.isSingleVizualization=function(){return t.main.currentSection.widgetGrid.childViews.length<2};n.isSmallWidget=function(e,t){var n=500,r=380;return e<=n||t<=r};n.getWidgetSizeClass=function(e,t){var n=500,r=380,i=1e3,s=700,o=["small","medium","large"],u=o[1];if(e>i||t>s)u=o[2];if((e<=i||t<=s)&&(e>=n||t>=r))u=o[1];if(e<n||t<r)u=o[0];return u};n.generateUUID=function(){return"xxxxxxxxxxxxxxxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})};if(typeof Hammer!=="undefined"){Hammer.plugins.fakeMultitouch();$(function(){$("body").hammer()})}n.getVersion=function(){var e=$.Deferred();$.ajax({url:"service/version/",success:function(t){e.resolve(t)},fail:function(){e.reject()}});return e.promise()};n.sourceExists=function(e,t,n){var r=false;admin.sources.each(function(e){if(t.toLowerCase()===e.get("name").toLowerCase()&&e.get("id")!==n)r=true});return r};n.isIOS=function(){return/(iPhone|iPod|iPad)/i.test(navigator.userAgent)};n.scopedPolyFill=function(e,t){function a(e,t){if(t)e=t;if(!e.nodeName)if(!e.jquery)return;else return e.each(a);if("STYLE"!==e.nodeName)return;var r=e[n.sheet],i=r[n.rules],o=e.parentNode,u=o.id||(o.id="scopedByScopedPolyfill_"+ ++s),f="",l=i.length||0,c,h,p;while(o){if(o.id)f="#"+o.id+" "+f;o=o.parentNode}while(l--){c=i[l];h=f+" "+c.selectorText.split(",").join(", "+f);h=h.replace(/[\ ]+:root/gi,"");if(n.changeSelectorTextAllowed)c.selectorText=h;else if(!c.type||1===c.type){p=c.style.cssText;r.removeRule?r.removeRule(l):r.deleteRule(l);r.addRule&&p.length>0?r.addRule(h,p):r.insertRule(h+"{"+p+"}",l)}}}var n=function(){var n=e.createElement("style"),r="undefined"!==typeof n.sheet?"sheet":"undefined"!==typeof n.getSheet?"getSheet":"styleSheet",i=t!==n.scoped,s,o,u;e.body.appendChild(n);s=n[r];s.addRule?s.addRule("c","blink"):s.insertRule("c{}",0);o=s.rules?"rules":"cssRules";u=s[o][0];try{u.selectorText="d"}catch(a){}var f="d"===u.selectorText.toLowerCase();n.parentNode.removeChild(n);return{scopeSupported:i,rules:o,sheet:r,changeSelectorTextAllowed:f}}();var r,i,s=0;if(e.querySelectorAll)r=e.querySelectorAll("style[scoped]");else{var o=[],u;r=e.getElementsByTagName("style");i=r.length;while(i--){u=r[i].getAttribute("scoped");if("scoped"===u||""===u)o.push(r[i])}r=o}i=r.length;while(i--)a(r[i]);if(typeof jQuery==="function"&&typeof jQuery.fn==="object")jQuery.fn.scopedPolyFill=function(){return this.each(a)};return a}(document);t.Utilities=n})(window,Zoomdata);(function(e,t){t.Models=t.Models||{};t.Models.Visualization=t.MVC.Model.extend({urlRoot:"service/visualizations",initialize:function(){t.MVC.Model.prototype.initialize.apply(this,arguments);this.on("change sync",this.setIconUrl);this.setIconUrl()},setIconUrl:function(){var e=this.get("thumbnailId"),t=this.get("type"),n="";if(e)n=this.urlRoot+"/"+this.get("visId")+"/thumbnail/"+e+".svg?v=06221707";else switch(t){case"VERTICAL_BARS":n="images/Template_Bars_Button_sm.png?v=06221707";break;case"BUBBLES":n="images/Template_Bubbles_Button_sm.png?v=06221707";break;case"PIE":n="images/Template_Pie_Button_sm.png?v=06221707";break;case"WORD_CLOUD":n="images/Template_WordCloud_Button_sm.png?v=06221707";break;case"MAP":n="images/Template_ZoomableMap_Button_sm.png?v=06221707";break;case"TRENDS":n="images/Template_TimeTrend_Button_alt_sm.png?v=06221707";break;case"ZOOMABLE_MAP":n="images/Template_ZoomableMap_Button_sm.png?v=06221707";break;case"PIVOT_TABLE":n="images/Template_GridView_Button_sm.png?v=06221707";break;case"HEAT_MAP":n="images/Template_HeatMap_Button_sm.png?v=06221707";break;case"HORIZONTAL_BARS":n="images/Template_HorizBar_Button_sm.png?v=06221707";break;case"SIDE_BY_SIDE_BARS":n="images/Template_MultiBar_Button_sm.png?v=06221707";break;case"MULTI_METRIC_BARS":n="images/Template_MultiBar_Button_sm.png?v=06221707";break;case"STACKED_BARS":n="images/Template_MultiGroup_Bar_Button_sm.png?v=06221707";break;case"MULTI_LINE":n="images/Template_MultiLine_Button_sm.png?v=06221707";break;case"MULTI_METRIC_TREND":n="images/Template_LineAndBar_Button_sm.png?v=06221707";break;case"FINGERPAINT":n="images/Template_Fingerpaint_Button_sm.png?v=06221707";break;default:n="images/Template_Custom_Button_sm.png?v=06221707"}this.set("thumbnailUrl",n,{silent:true})},saveEnabled:function(e){this.save({enabled:e})}})})(window,Zoomdata);(function(e,t){var n=t.Models.Visualization;t.Models=t.Models||{};t.Models.SourceVisualization=n.extend({idAttribute:"visId",initialize:function(e,n){t.Models.Visualization.prototype.initialize.apply(this,arguments);n=n||{};if(n.sourceId){this.setSource(n.sourceId);delete n.sourceId}else if(this.attributes.source&&this.attributes.source.sourceId)this.setSource(this.attributes.source.sourceId);return this},setSource:function(e){this.sourceId=e;return this},getSourceId:function(){return this.sourceId||this.collection.sourceId},url:function(){if(this.getSourceId())return"service/sources/"+this.getSourceId()+"/visualizations/"+this.get("visId");else throw new Error("sourceId must be defined")}})})(window,Zoomdata);(function(e,t){var n=t.Models.SourceVisualization;"use strict";t.Models=t.Models||{};t.Models.VisualizationConfig=n.extend({idAttribute:"id",fetch:function(){var e=this,n=_.clone(this.attributes),r=$.Deferred();t.Models.SourceVisualization.prototype.fetch.apply(this,arguments).done(function(){$.extend(true,e.attributes,n);r.resolve(arguments)}).fail(function(){r.reject(arguments)});return r.promise()}})})(window,Zoomdata);(function(e,t){t.Models=t.Models||{};t.Models.Filter=t.MVC.Model.extend({defaults:{path:null,operation:"IN",value:[],editable:false},idAttribute:"path",initialize:function(){_.bindAll(this,"hasAttribute","addAttribute","removeAttribute","hasValue","isEqualToFilter")},hasAttribute:function(e){return this.attributes.value&&this.attributes.value.indexOf(e.toString())>=0},hasValue:function(){var e=this.attributes.value;return null!==e&&(typeof e==="number"||e.length>0)},addAttribute:function(e,t){var n=_.clone(this.get("value"))||[];if(n.indexOf(e)==-1){n.push(e);this.set("value",n,t)}return this},removeAttribute:function(e,t){var n=_.clone(this.get("value")),r=n&&n.indexOf(e);if(n&&r!==-1){n.splice(r,1);this.set("value",n,t);if(n.length)return this;else{this.collection&&this.collection.remove(this,t);return null}}return this},isEqualToFilter:function(e){if(!e)return false;var t=e.get("operation")===this.get("operation")&&e.get("path")===this.get("path");if(t){var n=this.get("value");var r=e.get("value");t=n===r||2===n.length&&2===r.length&&n[0]===r[0]&&n[1]===r[1]}return t},toRequest:function(){return{path:this.get("path"),value:this.get("value"),operation:this.get("operation")}}})})(window,Zoomdata);(function(e,t){t.Models=t.Models||{};t.Models.ObjectField=t.MVC.Model.extend({initialize:function(){t.MVC.Model.prototype.initialize.apply(this,arguments);this.on("change:name change:type",this._setComposedId);this._setComposedId()},_setComposedId:function(){this.id=this._composedId()},_composedId:function(){return this.get("name")+this.get("type")},updateFacetValues:function(e,t,n,r){var i=this,s=this.get("name"),o="service/stream/"+this.collection.sourceId+"/facet/"+s+"?from="+n+"&to="+r+(e?"&query="+e:""),u=$.ajax({type:"POST",url:o,data:JSON.stringify(t),contentType:"application/json"}).done(function(e){}).fail(function(){console.warn("Couldn't get values for ObjectField ",i.get("name"))});return u.promise()},updateValues:function(e){var t=this,n=this.get("name"),r=this.collection.url()+n+"/values"+(e?"?query="+e:"/"),i=$.ajax({type:"GET",url:r,contentType:"application/json"}).done(function(e){t.values=e}).fail(function(){console.warn("Couldn't get values for ObjectField ",t.get("name"))});return i.promise()}})})(window,Zoomdata);(function(e,t){t.Collections=t.Collections||{};t.Collections.Filters=t.MVC.Collection.extend({model:t.Models.Filter,toRequest:function(){return this.map(function(e){return{path:e.get("path"),value:e.get("value"),operation:e.get("operation")}})}})})(window,Zoomdata);(function(e,t){var n=t.MVC.Model.extend({idAttribute:"name"});t.Collections=t.Collections||{};t.Collections.Formulas=t.MVC.Collection.extend({model:n,initialize:function(e,n){n=n||{};if(n.sourceId){this.sourceId=n.sourceId;delete n.sourceId}t.MVC.Collection.prototype.initialize.apply(this,arguments);return this},setSource:function(e){this.sourceId=e;return this},url:function(){if(this.sourceId)return"service/sources/"+this.sourceId+"/formulas/";else throw new Error("sourceId must be defined")}})})(window,Zoomdata);(function(e,t){function s(e){var t=typeof e.get("visible")=="boolean"?e.visible:true;return new n({name:e.get("name"),label:e.get("label"),type:"FORMULA",func:"mvel",visible:t})}var n=t.Models.ObjectField,r=t.Collections.Formulas,i=["ATTRIBUTE","TEXT","NUMBER","MONEY","INTEGER","COUNT OF","FORMULA"];t.Collections=t.Collections||{};t.Collections.ObjectFields=t.MVC.Collection.extend({model:n,volumeField:new n({label:"Volume",name:"count",type:"NUMBER"}),noneField:new n({label:"None",name:"none",type:"NONE"}),defaults:{},initialize:function(e,n){var i;n=n||{};if(n.sourceId){this.sourceId=n.sourceId;delete n.sourceId}t.MVC.Collection.prototype.initialize.apply(this,arguments);i=this.where({type:"FORMULA"});this.formulas=new r(i,{secure:this.secure,remote:this.remote,apiKey:this.apiKey,sourceId:this.sourceId});this.listenTo(this.formulas,"add",this._onFormulaAdd);this.listenTo(this.formulas,"remove",this._onFormulaRemove);this.listenTo(this.formulas,"change",this._onFormulaChange);this.listenTo(this.formulas,"reset",this._onFormulasReset);this.listenTo(this.formulas,"sync",this._syncFormulas)},constructor:function(e,n){t.MVC.Collection.prototype.constructor.apply(this,arguments);this._ensureVolumeField();this._ensureNoneField();this.on("all",this._ensureVolumeField);this.on("all",this._ensureNoneField)},_syncFormulas:function(){var e=this.formulas,t=e.map(s),n=this.where({type:"FORMULA"}),r=_.filter(n,function(e){var n=_.find(t,function(t){return t.id!==e.id});return typeof n=="undefined"});this.set(t,{remove:false});this.remove(r)},_onFormulaAdd:function(e){var t=s(e);this.add(t,{merge:true})},_onFormulaRemove:function(e){var t=s(e);this.remove(t,{merge:true})},_onFormulaChange:function(e){var t=s(e),n=this.get(t.id);n&&n.set(t.toJSON())},_onFormulasReset:function(e){var t=e.map(s);this.add(t)},_ensureVolumeField:function(e){var t=this.volumeField,n=this.get(t.id);!n?this.add(t,e):null},_ensureNoneField:function(e){var t=this.noneField,n=this.get(t.id);!n?this.add(t,e):null},setSource:function(e){this.sourceId=e;this.formulas.setSource(e);return this},url:function(){if(this.sourceId)return"service/sources/"+this.sourceId+"/attributes/";else throw new Error("sourceId must be defined")},fetch:function(e){function u(){r++;if(r==2){n._ensureVolumeField();n._syncFormulas();i.resolve(n.toJSON())}}function a(e){_.each(e,function(e){if(e.distinctCount){var t={name:e.name,label:e.label,type:"COUNT OF",func:"distinct_count",visible:true};n.add(t)}})}e=e||{};e.reset=true;var n=this,r=0,i=$.Deferred(),s=this.formulas.fetch(),o=t.MVC.Collection.prototype.fetch.call(this,e);o.done(function(e){a(e);u()}).fail(i.reject);s.done(u).fail(i.reject);return i.promise()},filterByTypes:function(e){this.remove(this.filter(function(t){return e.indexOf(t.get("type"))==-1&&t.get("type")!="COUNT OF"}));return this},removeBlueAttributes:function(){this.remove(this.filter(function(e){return e.get("type")!="ATTRIBUTE"}));return this},filterHidden:function(){this.remove(this.filter(function(e){return!e.get("visible")}));return this},comparator:function(e){return i.indexOf(e.get("type"))}})})(window,Zoomdata);(function(e,t){var n=t.Models.SourceVisualization;t.Collections=t.Collections||{};t.Collections.SourceVisualizations=t.MVC.Collection.extend({defaults:{},initialize:function(e,n){n=n||{};if(n.sourceId){this.sourceId=n.sourceId;delete n.sourceId}t.MVC.Collection.prototype.initialize.apply(this,arguments);return this},setSource:function(e){this.sourceId=e;return this},model:n,url:function(){if(this.sourceId)return"service/sources/"+this.sourceId+"/visualizations";else throw new Error("sourceId must be defined")}})})(window,Zoomdata);(function(e,t){var n=t.Collections.SourceVisualizations,r=t.Collections.ObjectFields,i=t.Collections.Formulas,s=t.Collections.Attributes;t.Models=t.Models||{};t.Models.Source=t.MVC.Model.extend({urlRoot:"service/sources",initialize:function(){t.MVC.Model.prototype.initialize.apply(this,arguments);this.visualizations=new n(this.attributes.visualizations,{secure:this.secure,remote:this.remote,apiKey:this.apiKey});this.objectFields=new r(this.attributes.objectFields,{secure:this.secure,remote:this.remote,apiKey:this.apiKey});this.formulaList=this.objectFields.formulas;this.on("sync",this._onSync);this._onSync()},_onSync:function(){this.updateVisualizations();this.updateObjectFields()},updateVisualizations:function(){var e=this.get("id");this.visualizations.setSource(e);this.visualizations.set(this.attributes.visualizations)},updateObjectFields:function(){var e=this.get("id"),t=new r(this.attributes.objectFields),n=new i(this.attributes.formulas);this.objectFields.setSource(e);this.objectFields.set(t.toArray());this.formulaList.set(n.toArray())},validate:function(){this.attributes.visualizations=this.visualizations.toJSON()},saveViewCount:$.noop()})})(window,Zoomdata);(function(e,t){var n=t.Models.Source,r=["name","description","type","streamType","lastModified","viewsCount","storageConfiguration","enabled"].join(",");t.Collections=t.Collections||{};t.Collections.Sources=t.MVC.Collection.extend({url:"service/sources",model:n,initialize:function(e,n){n=n||{};if(typeof n.lightweight=="boolean"){this.lightweight=n.lightweight;delete n.lightweight}return t.MVC.Collection.prototype.initialize.apply(this,arguments)},filterByVisualizations:function(e){var t=[];this.each(function(n){if(n.visualizations.where(e).length)t.push(n)});return t},filterDisabled:function(){this.remove(this.filter(function(e){return!e.get("enabled")}));return this},fetch:function(e){var n=_.clone(e)||{};if(typeof n.lightweight=="boolean"?n.lightweight:this.lightweight)n.data=$.extend({},n.data,{fields:r});return t.MVC.Collection.prototype.fetch.call(this,n)}})})(window,Zoomdata);(function(e,t){t.Models=t.Models||{};t.Models.Metric=t.MVC.Model.extend({defaults:{label:"",name:"",func:""},initialize:function(e){t.MVC.Model.prototype.initialize.apply(this,arguments);e=e||{};this.options=$.extend({},this.defaults,e);return this},isCount:function(){return this.get("name")=="count"},isNone:function(){var e=this.get("name");return e=="none"}})})(window,Zoomdata);(function(e,t){var n=t.Models.Metric;t.Collections=t.Collections||{};t.Collections.Metrics=t.MVC.Collection.extend({model:n,initialize:function(e){e=e||{};t.MVC.Collection.prototype.initialize.apply(this,arguments);this.options=$.extend({},this.defaults,e);return this}})})(window,Zoomdata);(function(e,t){function n(e){return e.substring(0,e.lastIndexOf("."))}t.Models=t.Models||{};t.Models.ComponentSource=t.MVC.Model.extend({defaults:{},getConstructorName:function(){return n(this.get("name"))},url:function(){var e=typeof this.remote=="string"?this.remote+"/":"",n=typeof this.remote=="string"&&typeof this.secure=="boolean"?this.secure?"https://":"http://":"",r=t.MVC.Model.prototype.url.apply(this,arguments);r+="/"+this.get("uploadDate");return n+e+r},load:function(e){var n=this,r=this.get("type"),i=$.Deferred(),s=this.url(),o=$("head"),u=e,a=t.Utilities.getURLParameter("key")||this.apiKey;switch(r){case"text/template":if(a)s+="?unwrapped=true&key="+a;else s+="?unwrapped=true";$.ajax({cache:true,dataType:"text",url:s}).done(function(e){$("<script type='text/template'>"+e+"</script>").appendTo($("head"));i.resolve()}).fail(function(e,t,r){console.error("Failed to load: "+n.get("name")+" with exception: "+r);i.reject(e)});break;case"text/css":if(a)s+="?key="+a;$.ajax({cache:true,dataType:"text",url:s}).done(function(e){var t=n.get("visualizationId")||n.collection.visId,r=n.get("id");$(".widgetContent[data-visid="+t+"]").each(function(n,i){var s=$(i).parent();if(s.children('[data-componentid="'+r+'"]').length>0);else{var o=$('<style data-visid="'+t+'" data-componentid="'+r+'" scoped>'+e+"</style>").appendTo(s);o.scopedPolyFill&&o.scopedPolyFill()}});var s=$("body style").length+$("body link").length;i.resolve()}).fail(function(e,t,r){console.error("Failed to load: "+n.get("name")+" with exception: "+r);i.reject(e)});break;default:s+="?namespace="+u+"&function="+this.getConstructorName();$.ajax({cache:true,dataType:"script",url:s}).done(function(){i.resolve()}).fail(function(e,t,r){console.error("Failed to load: "+n.get("name")+" with exception: "+r);i.reject(e)});break}return i.promise()}})})(window,Zoomdata);(function(e,t){function r(e){return e.replace(/(\.| )/g,"_")}var n=t.Models.ComponentSource;t.Collections=t.Collections||{};t.Collections.ComponentSources=t.MVC.Collection.extend({model:n,initialize:function(e,n){n=n||{};if(n.visId){this.setVisId(n.visId);delete n.visId}if(n.name){this.setVisName(n.name);delete n.name}t.MVC.Collection.prototype.initialize.apply(this,arguments);return this},getComponentsNamespace:function(){return this.getVisName().replace(/[^\w]/g,"_")},load:function(e){var n=$.Deferred(),r=t.Utilities.getURLParameter("key")||this.apiKey,i=typeof this.remote=="string"?this.remote+"/":"",s=typeof this.remote=="string"&&typeof this.secure=="boolean"?this.secure?"https://":"http://":"";e=e||this.getComponentsNamespace();requirejs.config({urlArgs:r?"key="+r:null,paths:{noext:s+i+"js/libs/require/noext"}});var o=[],u=[],a=[];if(e)this.forEach(function(e){var t=e.url();if("text/javascript"===e.get("type")){o.push("noext!"+t);u.push(e.getConstructorName())}else a.push(e)});else{console.error("Namespace is not defined");n.reject({message:"Namespace is not defined"})}var f=function(r){var i=0;console.log("Loading scripts:");console.log(r);u.forEach(function(n){typeof t.Visualizations[e][n]=="function"?i++:null});i==r.length?(console.log("Already Loaded: ",e),n.resolve()):require(r,function(){for(var r=0;r<arguments.length;r++){var i=arguments[r],s=u[r];t.Visualizations[e][s]=i}n.resolve()},function(e){n.reject(e)})};var l=a.length;var c=o.slice(0);if(l>0){var h=0;console.log("Loading resources:");console.log(a);a.forEach(function(t){t.load(e).done(function(){h++;if(h==l)f(c)}).fail(function(e){n.reject(e)})})}else f(c);return n.promise()},execute:function(e){this.each(function(e){})},url:function(){if(this.visId)return"service/visualizations/"+this.visId+"/source/";else throw new Error("Visualization id for the component is not defined")},setVisName:function(e){this.name=e},getVisName:function(){return this.name},setVisId:function(e){this.visId=e}})})(window,Zoomdata);(function(e,t){function n(e){return e.substring(0,e.lastIndexOf("."))}t.Models=t.Models||{};t.Models.LibrarySource=t.Models.ComponentSource.extend({defaults:{},initialize:function(e){t.Models.ComponentSource.prototype.initialize.apply(this,arguments);if(typeof e=="string")this.set("name",e)},idAttribute:"id",url:function(){var e=typeof this.remote=="string"?this.remote+"/":"",t=typeof this.remote=="string"&&typeof this.secure=="boolean"?this.secure?"https://":"http://":"";return t+e+"service/visualizations/libs/"+this.id+"/"+(this.get("uploadDate")||"")},load:function(){var e=this,n=this.get("type"),r=$.Deferred(),i=this.url(),s=$("head"),o=t.Utilities.getURLParameter("key");switch(n){case"text/template":if(o)i+="?unwrapped=true&key="+o;else i+="?unwrapped=true";$.ajax({cache:true,dataType:"text",url:i}).done(function(e){$("<script type='text/template'>"+e+"</script>").appendTo($("head"));r.resolve()}).fail(function(t,n,i){console.error("Failed to load: "+e.get("name")+" with exception: "+i);r.reject(t)});break;case"text/css":if(o)i+="?key="+o;$.ajax({cache:true,dataType:"text",url:i}).done(function(e){$("<style>"+e+"</style>").appendTo($("head"));r.resolve()}).fail(function(t,n,i){console.error("Failed to load: "+e.get("name")+" with exception: "+i);r.reject(t)});break;default:$.ajax({cache:true,dataType:"script",url:i+"/"}).done(function(){r.resolve()}).fail(function(t,n,i){console.error("Failed to load: "+e.get("name")+" with exception: "+i);r.reject(t)});break}return r.promise()}})})(window,Zoomdata);(function(e,t){var n=t.Models.LibrarySource;t.Collections=t.Collections||{};t.Collections.LibrariesSources=t.Collections.ComponentSources.extend({model:n,load:function(){var e=$.Deferred(),n=t.Utilities.getURLParameter("key")||this.apiKey,r=[],i=false;var s=[];this.forEach(function(e){var t=e.url();if(t.indexOf("d3.v3.min.js")!==-1){i=true;r.push(t)}s.push(t)});requirejs.config({urlArgs:n?"key="+n:null});console.log("Loading libraries:");console.log(s);if(i)requirejs(r,function(t){window.d3=t;requirejs(s,function(){e.resolve()},function(t){console.error(s," failed to load.");e.reject(t)})},function(t){console.error(r," failed to load.");e.reject(t)});else requirejs(s,function(){e.resolve()},function(t){console.error(t.message);e.reject(t)});return e.promise()},url:function(){return"service/visualizations/libs/"}})})(window,Zoomdata);(function(e,t){t.Components=t.Components||{};t.Components.MetricFormatter=function(e,t){t=t==="NONE"?false:t;var n=e;var r=false;var i=t;var s=function(e){if(!r)r=new Date(e*1);return r};this.format=function(e){var t=null;r=false;switch(n){case"MONEY":t=$.formatNumber(e,{format:"$#,##0.00",locale:"us"});break;case"TIME":t=(new Date(e)).toLocaleString();break;case"DATE":t=s(e).getDay();break;case"MINUTE":if(isNaN(e*1))return"";var o=s(e).getHours();var u=s(e).getMinutes();var a=o>12?o-12:o||12;t=(a<10?"0":"")+a+":"+(u<10?"0"+u:u)+(o>=12?" pm":" am");break;case"HOUR":if(isNaN(e*1))return"";var o=s(e).getHours();var a=o>12?o-12:o||12;t=(a<10?"0":"")+a+(o>=12?" pm":" am");break;case"DAY":if(isNaN(e*1))return"";var f="DAY"==i?s(e).getUTCDate():s(e).getDate();var l="DAY"==i?s(e).getUTCMonth()+1:s(e).getMonth()+1;t=(l<10?"0"+l:l)+" / "+(f<10?"0"+f:f);break;case"WEEK":if(isNaN(e*1))return"";var f="DAY"==i?s(e).getUTCDate():s(e).getDate();var l="DAY"==i?s(e).getUTCMonth()+1:s(e).getMonth()+1;t=(l<10?"0"+l:l)+" / "+(f<10?"0"+f:f);break;case"MONTH":if(isNaN(e*1))return"";var l="DAY"==i?s(e).getUTCMonth()+1:s(e).getMonth()+1;var c="DAY"==i?s(e).getUTCFullYear():s(e).getFullYear();t=c+" / "+(l<10?"0"+l:l);break;case"YEAR":if(isNaN(e*1))return"";t="DAY"==i?s(e).getUTCFullYear():s(e).getFullYear();break;default:if(Math.abs(e)>=1e-4&&Math.abs(e)<=1)t=$.formatNumber(e,{format:"0.####",locale:"us"});else if(Math.abs(e)>1)t=$.formatNumber(e,{format:"#,##0.##",locale:"us"});else{if(e===null)e=0;t=e?e.toExponential(4).toString():e.toString()}break}return t}}})(window,Zoomdata);(function(e,t){function r(e,t){this.setAccessTo(e,t);this.setColorRangeType("gradient")}var n=t.Components.MetricFormatter;t.Components=t.Components||{};t.Components.MetricAccessor=r;r.prototype.setAccessTo=function(t,n){this.metric=t;this.objectField=n;this._updateFormatter();return this};r.prototype._updateDomain=function(t,n){var r=this,i,s,o,u=n;i=d3.extent(t,function(e,t){return r.raw(e)});if(this.colorRangeType!=="gradient")u+=1;o=(i[1]-i[0])/u;if(o===0){this.domainValue=i.slice(0);return}s=i[0];this.domainValue=[];do{this.domainValue.push(s);s+=o}while(this.domainValue.length<u);this.domainValue[this.domainValue.length-1]=i[1]};r.prototype._recountDomain=function(){this._formatter=new n(this.objectField.type)};r.prototype._updateFormatter=function(){this._formatter=new n(this.objectField.type)};r.prototype.isCount=function(){return this.metric.name==="count"};r.prototype.isNone=function(){return this.metric.name=="none"};r.prototype.raw=function(t){var n=this.isCount(),r=this.isNone(),i,s;if(r)return 0;i=this.metric.name;s=!n?this.metric.func:null;if(n&&t.hasOwnProperty("current")&&t.current.hasOwnProperty("count"))return t.current.count;else if(t.hasOwnProperty("current")&&t.current.hasOwnProperty("metrics")&&t.current.metrics.hasOwnProperty(i)&&t.current.metrics[i].hasOwnProperty(s))return t.current.metrics?t.current.metrics[i][s]:null;else return null};r.prototype.formatted=function(t,n){var r=isNaN(t)?this.raw(t):t,i=this.objectField.type;return i==="count"?r:this._formatter.format(r,n)};r.prototype.get=function(t){return this.objectField[t]};r.prototype._updateFormatter=function(){this._formatter=new n(this.objectField.type)};r.prototype.get=function(t){return this.objectField[t]};r.prototype.colorRange=function(){var t=this,n=[];if(this.metric.name==="none")_.each(this.metric.colors,function(){n.push(t.metric.colors[0])});else n=this.metric.colors;return n};r.prototype.minimum=function(){if(this.domainValue)return this.domainValue[0];return 0};r.prototype.maximum=function(){if(this.domainValue)return this.domainValue[this.domainValue.length-1];return 0};r.prototype.domain=function(){return _.clone(this.domainValue)};r.prototype.setColorRangeType=function(t){this.colorRangeType=t}})(window,Zoomdata);(function(e,t){t.Components=t.Components||{};t.Components.NiceScale=function(n,r,i){function h(){f=p(o-s,false);a=p(f/(u-1),true);l=Math.floor(s/a)*a;c=Math.ceil(o/a)*a}function p(e,n){var r;var i;var s;r=Math.floor(t.Utilities.log10(e));i=e/Math.pow(10,r);if(n)if(i<1.5)s=1;else if(i<3)s=2;else if(i<7)s=5;else s=10;else if(i<=1)s=1;else if(i<=2)s=2;else if(i<=5)s=5;else s=10;return s*Math.pow(10,r)}var s=n;var o=r;var u=i;var a;var f;var l;var c;this.setMinMaxPoints=function(e,t){s=e;o=t;h()};this.setMaxTicks=function(e){u=e;h()};this.getTickSpacing=function(){return a||0};this.getNiceMin=function(){return l||0};this.getNiceMax=function(){return c||0};h()}})(window,Zoomdata);(function(e,t){t.Models=t.Models||{};t.TIME_WINDOW_SCALE={HOUR:"HOUR",ROLLING_HOUR:"ROLLING_HOUR",DAY:"DAY",WEEK:"WEEK",MONTH:"MONTH",QUARTER:"QUARTER",YEAR:"YEAR",CUSTOM:"CUSTOM",ALL:"ALL"};t.Models.TimeWindowScale=t.MVC.Model.extend({idAttribute:"value"})})(window,Zoomdata);(function(e,t){var n=t.Utilities,r=n.time.millisecondsIn,i=t.Collections.Metrics,s=t.Components;t.Models=t.Models||{};t.Models.Time=t.MVC.Model.extend({defaults:{paused:false,speed:1,minSpeed:1,timeWindow:"ROLLING_HOUR",time:null,tz:n.determineTimeZone(),min:0,max:(new Date).getTime(),speedValues:[1,10,60,3600,86400],speedNames:["1x","10x","60x","1h/sec","1d/sec"],live:false},startTimeFunctions:{},initialize:function(e,t){_.bindAll(this,"firstMinuteTime","firstHourTime","rollingTime","getStartTime","getEndTime");if(e.time=="LIVE")this.set({time:(new Date).getTime(),live:true});else if(typeof e.time!=="number")this.set({time:n.getTimestamp(e.time),paused:true});else this.set({time:e.time,paused:true});this.on("change:timeWindow",this._updateLimits)},firstMinuteTime:function(e){var t=new Date(e);t.setMinutes(0,0,0);return t.getTime()},firstHourTime:function(e){var t=new Date(e);t.setHours(0,0,0,0);return t.getTime()},rollingTime:function(e){return e-r.hour},getStartTimeStamp:function(){return this.get("fromTime")},getEndTimeStamp:function(){var e=this.get("time");return e},getStartTime:function(e,t,r){var i=this.get("timeWindow")=="ALL"?this.get("min"):this.get("fromTime");if(e)return n.formattedDate(i,t)+" "+n.timeZoneFromTime(i);if("DAY"===r)return n.formattedDateOnly(i,t,true);return n.formattedDate(i,t)},getEndTime:function(e,t,r){var i=this.get("time");return e?n.formattedDate(i,t)+" "+n.timeZoneFromTime(i):"DAY"===r?n.formattedDateOnly(i,t):n.formattedDate(i,t)},formattedCustomDate:function(e,t,r){t=t*1;return e?n.formattedDate(t,r)+" "+n.timeZoneFromTime(t):n.formattedDate(t,r)},getStartTimeForComparisonPeriod:function(e){var t=this.get("fromTime");var r=new Date(t);if("YESTERDAY"===e)r.setDate(r.getDate()-1);else if("WEEK_AGO"===e)r.setDate(r.getDate()-7);else{var i=e.split("-");var s=new Date(i[0]*1,i[1]*1-1,i[2]*1);s.setHours(r.getHours());s.setMinutes(r.getMinutes());s.setSeconds(r.getSeconds());r=s}t=r&&r.getTime()||t;return n.formattedDate(t,true)+" "+n.timeZoneFromTime(t)},getEndTimeForComparisonPeriod:function(e){var t=this.get("time");var r=new Date(t);if("YESTERDAY"===e)r.setDate(r.getDate()-1);else if("WEEK_AGO"===e)r.setDate(r.getDate()-7);else{var i=e.split("-");var s=new Date(i[0]*1,i[1]*1-1,i[2]*1);s.setHours(r.getHours());s.setMinutes(r.getMinutes());s.setSeconds(r.getSeconds());r=s}t=r&&r.getTime()||t;return n.formattedDate(t,true)+" "+n.timeZoneFromTime(t)},getStartTimeForTimeWindowScaleAndComparisonPeriod:function(e,t){var r=this.get("fromTime");var i=new Date(r);if("YESTERDAY"===t)i.setDate(i.getDate()-1);else if("WEEK_AGO"===t)i.setDate(i.getDate()-7);else{var s=t.split("-");var o=new Date(s[0]*1,s[1]*1-1,s[2]*1);o.setHours(i.getHours());o.setMinutes(i.getMinutes());o.setSeconds(i.getSeconds());i=o}if("HOUR"===e){i.setMinutes(0);i.setSeconds(0)}else if("DAY"===e){i.setHours(0);i.setMinutes(0);i.setSeconds(0)}r=i&&i.getTime()||r;return n.formattedDate(r,true)+" "+n.timeZoneFromTime(r)},getEndTimeForTimeWindowScaleAndComparisonPeriod:function(e,t){var r=this.get("time");var i=new Date(r);if("YESTERDAY"===t)i.setDate(i.getDate()-1);else if("WEEK_AGO"===t)i.setDate(i.getDate()-7);else{var s=t.split("-");var o=new Date(s[0]*1,s[1]*1-1,s[2]*1);o.setHours(i.getHours());o.setMinutes(i.getMinutes());o.setSeconds(i.getSeconds());i=o}if("HOUR"===e){i.setMinutes(59);i.setSeconds(59)}else if("DAY"===e){i.setDate(i.getDate()+1);i.setHours(0);i.setMinutes(59);i.setSeconds(59);i.setHours(-1)}r=i&&i.getTime()||r;return n.formattedDate(r,true)+" "+n.timeZoneFromTime(r)}});t.Models.Datum=t.MVC.Model.extend({idAttribute:"group"});var o={"Descending Value":"valueDescending","Ascending Value":"valueAscending",Alphabetical:"alphabetical","Reverse Alphabetical":"reverseAlphabetical"};var u={valueDescending:"Descending Value",valueAscending:"Ascending Value",alphabetical:"Alphabetical",reverseAlphabetical:"Reverse Alphabetical"};var a=t.Models.Filter;var f=t.Collections.Filters;t.Models.State=t.MVC.Model.extend({defaults:{groupBy:null,timeWindowScale:"ROLLING_HOUR",comparison:false,comparisonPeriod:"YESTERDAY",sort:{dir:"DESC",name:"count"},limit:1e3,clientSort:"valueDescending"},initialize:function(e,n){n||(n={});var r=this,s=this.defaults,u={},a=n.config,l=n.config&&n.config.get("source"),c=l.variables,h=l.filters||[],p=l.minSpeed?l.minSpeed:1,d=p>1?p:1;if(n.config){this.config=n.config;delete n.config}this.metrics=new i(this._retrieveMetrics());switch(p){case 86400:s.timeWindowScale="WEEK";break;case 3600:s.timeWindowScale="DAY";break;default:s.timeWindowScale="ROLLING_HOUR"}this.time=new t.Models.Time({time:l.startFrom,speed:d,minSpeed:p,timeWindow:l.timeWindowScale});this.on("change:timeWindowScale",function(e,t){r.time.set("timeWindow",t)});u.limit=c["Limit"];if(this.metrics.size()>0)if(c["Limit Results by Rank"]=="Bottom")u.sort={name:this.metrics.at(0).get("name")||"count",dir:"asc"};else u.sort={name:this.metrics.at(0).get("name")||"count",dir:"desc"};else u.sort={name:"count",dir:"desc"};this.queryBuilderSource=l.variables["queryBuilderSource"];this.filters=new f(h);u.groupBy=l.groupBy||s.groupBy;if(a.get("type")==="TRENDS"||a.get("type")==="MULTI_METRIC_TREND"){u.groupBy=l.date||"_ts";u.timeTrendStep=l.timeTrendStep}u.timeWindowScale=l.timeWindowScale||s.timeWindowScale;u.comparison=c["Comparison"]==="On";u.comparisonPeriod=c["_comparisonPeriod"]||l.comparisonPeriod||"YESTERDAY";u.sort=u.sort||s.sort;u.limit=u.limit||s.limit;u.clientSort=o[c["Sort"]]||s.clientSort;u.delay=l.delay;u.delayUnit=l.delayUnit;u.timestampField=l.date;this.set(u)},_retrieveMetrics:function(){function r(e){var r=e.name,i=t[r]||"none",s=i.split(":"),o=s[0],u=s[1]||(o!=="count"&&o!="none"?"sum":null),a={};if(s[2]){a=JSON.parse(s[2].replace(/\|/g,":"));$.extend(e,a)}n.push($.extend(a,{label:r,name:o,func:u,id:r}))}function i(e){var r=e.name,i=t[r].split(" ");i.forEach(function(e){var t=e.split(":")[0],i=e.split(":")[1];n.push({label:r,name:t,func:i,id:r+"-"+n.length})})}var e=this.config.get("variables"),t=this.config.get("source").variables,n=[];e.forEach(function(e){e.type=="metric"?r(e):e.type=="multi-metric"?i(e):null});return n},addFilter:function(e,t){var n=this.filters,r,i,s,o;t=t||{};!(e instanceof a)?e=new a(e):null;i=e.get("path");o=e.get("operation");s=e.get("value");r=n.findWhere({path:i});if(r){t.silent=true;_.each(s,function(e){if(!r.hasAttribute(e,t))r.addAttribute(e,t)});_.each(r.get("value"),function(n){if(!e.hasAttribute(n,t))r.removeAttribute(n,t)});if(r.get("operation")!==o)r.set("operation",o,{silent:true});r.trigger("change")}else this.filters.add(e,t);return this},addFilters:function(e){var t=this;e.forEach(function(n,r){t.addFilter(n,{silent:r!==e.length-1})})},removeFilter:function(e,t){function i(e){var r=n.filters,i,s,o;!(e instanceof a)?e=new a(e):null;s=e.get("path");o=e.get("value");i=r.findWhere({path:s});if(i&&o.length===1&&i.hasAttribute(o[0],t)){i.removeAttribute(o[0],t);return n}if(typeof o[0]==="undefined"||o.length>1){n.filters.remove(i);return n}}var n=this;if($.isArray(e))for(var r=0;r<e.length;r++)i(e[r]);else i(e);return this},setFilter:function(e,t){var n=this.filters,r,i,s;!(e instanceof a)?e=new a(e):null;i=e.get("path");r=n.findWhere({path:i});if(r)r.set(e.attributes,t);else this.addFilter(e,t)},toRequest:function(e){var n=this.time.get("live"),r=this.config.get("source"),i=this.queryBuilderSource||r.variables["queryBuilderSource"],s=r.variables["_limitPeriod"];if(s){r.variables["_TempLimitPeriod"]=s;delete r.variables["_limitPeriod"]}var o=$.extend({},this.attributes),u=this.config.get("source").startFrom,a={};if(!n){var f=this.config.options;o.time=this.time.get("time");if(!e&&(!f.previousModels||!u)&&o.timeWindowScale===t.TIME_WINDOW_SCALE.ROLLING_HOUR)o.time+=36e5}else o.time=null;if(this.time.get("minSpeed")==86400||"DAY"===r.dataResolution)o.tz="GMT";else o.tz=this.time.get("tz");o.speed=this.time.get("speed");a.pauseAfterRead=this.time.get("paused");if(this.get("sort")){delete o.sort;a=a||{};var l;if(this.metrics.size()===0)l="count";else l=this.metrics.at(0).get("name");a.sort={name:l,dir:this.get("sort").dir}}if(this.get("groupBy")){delete o.groupBy;a=a||{};a.group={};var c=this.get("groupBy"),h=this.get("groupByLimits"),p=this.get("groupBySort")?this.get("groupBySort"):false;if(this.get("limit")){delete o.limit;a.group.limit=s?s:this.get("limit")}a.group.fields=Array.isArray(c)?c.map(function(e,t){return{name:e,limit:h[t],sort:p?p[t]:a.sort}}):[{name:c,limit:a.group.limit,sort:a.sort}];if(a.group.fields.length>1)delete o.groupByLimits;else if(a.group.fields.length===1)a.group.limit&&delete a.group.limit;a.group.metrics=a.group.metrics||[];this.metrics.each(function(e){if(!e.isCount()&&!e.isNone())a.group.metrics.push({name:e.get("name"),func:e.get("func").toUpperCase()})});if(this.get("timeTrendStep")){delete o.timeTrendStep;a.group.timeTrendStep=this.get("timeTrendStep")}}if(this.filters.length>0){delete a.filters;a=a||{};a.filters=this.filters.toRequest()}if(this.get("sort")){delete o.sort;delete a.sort}if(p){delete a.groupBySort;delete o.groupBySort}if(i){a=a||{};a.queryBuilderSource=i}var d=this.get("comparisonPeriod");o.comparisonPeriod=this.dataToFormatString(this.getTimeByType(o.time,d));if(a)o.cfg=a;o.volume?delete o.volume:null;o.color?delete o.color:null;o.timestampField=this.get("timestampField");return o},getTimeByType:function(e,t){var n=t;var r=e&&e<=new Date?new Date(e):new Date;var i=new Date(r);i.setDate(r.getDate()-1);var s=new Date(r);s.setDate(r.getDate()-7);var o=new Date(r);o.setDate(r.getDate()-30);var u=new Date(r);u.setDate(r.getDate()-365);var a=new Date(r);a.setDate(r.getDate()-365);switch(t){case"YESTERDAY":n=i;break;case"WEEK_AGO":n=s;break;case"LAST_MONTH":n=o;break;case"MONTH_YEAR_AGO":n=u;break;case"LAST_YEAR":n=a;break}return n},dataToFormatString:function(e){var t="";if(e.getFullYear)t=e.getFullYear()+"-"+(e.getMonth()+1<10?"0":"")+(e.getMonth()+1)+"-"+(e.getDate()<10?"0":"")+e.getDate();else t=e;return t},convertToBookmark:function(){var e=this,t=this.config.get("source"),n=this.metrics.pluck("label"),r=$.extend({},t,{groupBy:this.get("groupBy"),filters:this.filters.toJSON(),timeWindowScale:this.get("timeWindowScale"),timeTrendStep:this.get("timeTrendStep"),startFrom:this.time.getEndTime(),sourceId:t.sourceId,sourceName:t.sourceName});r.variables=r.variables||{};r.variables["Sort"]=u[this.attributes.clientSort];r.variables["Comparison"]=this.get("comparison")?"On":"Off";r.variables._comparisonPeriod=this.get("comparisonPeriod");n.forEach(function(e){r.variables[e]=""});this.metrics.map(function(t,n,i){var s=t.get("label"),o=t.get("name"),u=t.get("func"),a;r.variables.hasOwnProperty(s)?r.variables[s]+=(r.variables[s].length>0?" ":"")+(o=="count"?o:o+":"+u):null;if(e.colorMetric&&e.colorMetric.id===t.id){if(r.variables[s].split(":").length===1)r.variables[s]+=":";a=e.colorMetric.get("colors")||e.colorMetric.get("savedColors");if(typeof a!=="string")a=JSON.stringify(a);r.variables[s]+=":"+JSON.stringify({colorNumb:e.colorNumb,legendType:e.legendType,divergingColorRange:e.divergingColorRange,savedColors:a}).replace(/:/g,"|")}});return r},isTimeTrends:function(){return"TRENDS"===this.config.get("type")||"MULTI_METRIC_TREND"===this.config.get("type")||"TRENDS"===this.config.get("templateType")||"MULTI_METRIC_TREND"===this.config.get("templateType")}})})(window,Zoomdata);(function(e,t){var n=t.Utilities;t.Collections=t.Collections||{};t.Collections.Graph=Backbone.Collection.extend({model:t.Models.Datum,metric:null,initialize:function(e,t){_.bindAll(this,"setSortOrder");this.metric=t.metric},setSortOrder:function(e){if("valueAscending"===e)this.comparator=function(e){return this.metric.raw(e.attributes)};else if("valueDescending"===e)this.comparator=function(e){return-this.metric.raw(e.attributes)};else if("alphabetical"===e)this.comparator=function(e){return e.get("group")};else if("reverseAlphabetical"===e)this.comparator=function(e,t){if(e.get("group")>t.get("group"))return-1;if(e.get("group")<t.get("group"))return 1;return 0};else if("date"===e)this.comparator=function(e){return e.get("group")*1};else this.comparator=null;if(this.comparator)this.sort()}})})(window,Zoomdata);(function(e,t){var n={},r=t.Utilities;n.Slider=t.MVC.View.extend({defaults:{orientation:"vertical",range:false,value:50,min:0,max:100},initialize:function(e){var n=this,r={start:function(e,t){n.trigger("slide:start",t.value,n);n.data.set("value",t.value,{silent:true})},stop:function(e,t){n.trigger("slide:stop",t.value,n);n.data.set("value",t.value,{silent:true})},change:function(e,t){n.trigger("slide:change",t.value,n);n.data.set("value",t.value,{silent:true})}};this.options=$.extend({},this.defaults,e);this.data=new t.MVC.Model({min:this.options.min,max:this.options.max,value:this.options.value});this.$el.slider($.extend({},r,this.options));this.listenTo(this.data,"change",this.render)},render:function(){this.$el.slider(this.data.attributes);return this},value:function(e){function n(){return t.data.get("value")}function r(e){t.data.set("value",e)}var t=this;if(typeof e==="number"){r(e);return this}else return n()},min:function(e){function n(){return t.data.get("min")}function r(e){t.data.set("min",e)}var t=this;if(typeof e==="number"){r(e);return this}else return n()},max:function(e){function n(){return t.data.get("max")}function r(e){t.data.set("max",e)}var t=this;if(typeof e==="number"){r(e);return this}else return n()}});var i=_.template('            <button class="arrow-left btn" title="left" value="left"><i class="icon-arrow-left"></i></button>            <button class="arrow-right btn" title="right" value="right"><i class="icon-arrow-right"></i></button>        '),s=_.template('            <div class="btn-group-vertical">                <button class="arrow-up btn" title="up" value="up"><i class="icon-arrow-up"></i></button>                <button class="arrow-down btn" title="down" value="down"><i class="icon-arrow-down"></i></button>            </div>        '),o=_.template('            <button class="arrow-left btn" title="left" value="left"><i class="icon-arrow-left"></i></button>            <div class="btn-group-vertical">                <button class="arrow-up btn" title="up" value="up"><i class="icon-arrow-up"></i></button>                <button class="arrow-down btn" title="down" value="down"><i class="icon-arrow-down"></i></button>            </div>            <button class="arrow-right btn" title="right" value="right"><i class="icon-arrow-right"></i></button>        ');n.Arrows=t.MVC.View.extend({_horizontalTemplate:i,_verticalTemplate:s,_allTemplate:o,defaults:{direction:"all"},events:{'click button[value="up"]':"_onUpClick",'click button[value="down"]':"_onDownClick",'click button[value="left"]':"_onLeftClick",'click button[value="right"]':"_onRightClick"},initialize:function(e){this.childViews=[];this.options=$.extend({},this.defaults,e);switch(this.options.direction){case"vertical":this.template=this._verticalTemplate;break;case"horizontal":this.template=this._horizontalTemplate;break;case"all":default:this.template=this._allTemplate;break}},render:function(){this.$el.html(this.template());return this},_onUpClick:function(){this.trigger("translate:up")},_onDownClick:function(){this.trigger("translate:down")},_onLeftClick:function(){this.trigger("translate:left")},_onRightClick:function(){this.trigger("translate:right")}});n.Zoomable=t.MVC.View.extend({className:"zoomable",defaults:{snapToEdges:true,maxScale:false,minScale:false,eventNamespace:"zoomable:",mouseWheel:false},initialize:function(e){var n=this;this._enabled=true;this.childViews=[];this.options=$.extend({},this.defaults,e);this.$content=$('<div class="zoomable-content"></div>').appendTo(this.$el);if(t.Utilities.MODE.NATIVE!==t.Utilities.mode()){this._zoomHammer=this.$content.zoomHammer(this.options).data("zoomHammer");this.$el.on("zoomable:transformstart",function(){n.trigger("transform:start",n)});this.$el.on("zoomable:transformend",function(){n.trigger("transform:end",n)});this.$el.on("zoomable:transform",function(){n.trigger("transform:transition",n)})}},disable:function(e){var t=e?e.resizeStart:null;this._zoomHammer&&this._zoomHammer.disable();!this.$el.hasClass("zoomable-disabled")&&!t?this.$el.addClass("zoomable-disabled"):null;this._enabled=false},enable:function(e){var t=e?e.resizeStop:null;this._zoomHammer&&this._zoomHammer.enable();this.$el.hasClass("zoomable-disabled")&&!t?this.$el.removeClass("zoomable-disabled"):null;this._enabled=true},isEnabled:function(){return this._enabled},getMinScale:function(){return this._zoomHammer&&this._zoomHammer.parsedScale().min||1},setMinScale:function(e){e||(e=this._zoomHammer.options.minScale);this._zoomHammer.options.minScale=e;return this},getMaxScale:function(){return this._zoomHammer&&this._zoomHammer.parsedScale().max||1},setMaxScale:function(e){e||(e=this._zoomHammer.options.maxScale);this._zoomHammer.options.maxScale=e;return this},getScale:function(){return this._zoomHammer&&this._zoomHammer.scale()||1},getTranslation:function(){return this._zoomHammer&&this._zoomHammer.translate()||null},zoom:function(e,t,n){this._zoomHammer&&this._zoomHammer.move({scale:e},t,n);return this},translate:function(e,t){e=e||{};typeof e.x==="number"?e.left=e.x:null;typeof e.y==="number"?e.top=e.y:null;delete e.x;delete e.y;this._zoomHammer&&this._zoomHammer.move(e,t);return this},refresh:function(e,t){this._zoomHammer&&this._zoomHammer.adjust(e,t)},render:function(e){this.$content.html(e);return this}});var u=_.template('        <div class="modal hide fade <%= customClass %>" >            <div class="modal-header">                <button title="Close" value="dialog-reject" class="close">&times;</button>                <h3 class="dialog-head pull-left"></h3>                <div class="clearfix"></div>            </div>            <div class="modal-body dialog-body">            </div>            <div class="modal-footer dialog-controls">                <button title="<%= rejectButtonTitle %>" value="dialog-reject" class="btn btnNo" aria-hidden="true"><%= rejectButtonLabel %></button>                <button title="<%= acceptButtonTitle %>" value="dialog-accept" class="btn btn-primary btnYes"><%= acceptButtonLabel %></button>            </div>        </div>    ');n.Dialog=t.MVC.View.extend({template:u,defaults:{mode:"dialog",draggable:false,wide:false,modal:"static",rejectButtonLabel:"Close",acceptButtonLabel:"Accept",rejectButtonTitle:"Close",acceptButtonTitle:"Accept",containment:"body",docked:true,customClass:""},events:{'click button[value="dialog-reject"]':"hide",'click button[value="dialog-accept"]':"accept",'click button[value="dialog-back"]':"back","click .functionItem":"closeModal","click .metricItem":"closeModal"},initialize:function(e){t.MVC.View.prototype.initialize.apply(this,arguments);_.bindAll(this,"back");var n=this;e=e||{};if(e.actions){this.actions=e.actions;delete e.actions}if(e.template){this.template=e.template;delete e.template}this.settings=$.extend({},this.defaults,e);this.removeOtherDocked();$(".modal-backdrop.zd-overlay").remove();this.setElement(this.template({rejectButtonLabel:this.settings.rejectButtonLabel,acceptButtonLabel:this.settings.acceptButtonLabel,rejectButtonTitle:this.settings.rejectButtonTitle,acceptButtonTitle:this.settings.acceptButtonTitle,customClass:this.settings.customClass}));this.$el.appendTo("body");this.$el.modal({show:false,backdrop:this.settings.modal,keyboard:false});switch(this.settings.mode){case"palette":this.$(".dialog-controls").hide();break;case"alert":this.$('button[value="dialog-accept"]').hide();break}this.$head=this.$(".dialog-head");this.$body=this.$(".dialog-body");this.$actions=$('<div class="zd-dialog-actions btn-group btn-block"></div>');this.setActions(e.actions);if(this.settings.draggable)this.$el.draggable({handle:this.$(".dialog-head, .header"),start:function(){n.$el.removeClass("fade");if(typeof n.settings.draggable.onDragStart=="function")n.settings.draggable.onDragStart.apply(this,arguments)},stop:function(){n.$el.addClass("fade");if(typeof n.settings.draggable.onDragStop=="function")n.settings.draggable.onDragStop.apply(this,arguments)},cursor:"move",containment:this.settings.containment});if(this.settings.wide)this.goWide();this.$el.one("hidden",function(){n.trigger("dialog:rejected");n.remove();n.onReject();n.onHide()});this.listenTo(t.eventDispatcher,"visualization:add",function(){this.hide()});this.listenTo(t.eventDispatcher,"admin-control:clicked",this.removeOtherDocked)},removeOtherDocked:function(){var e=$(".modal.zd-palette.docked");var t=$(".modal.zd-infopopup.docked");$(".control-rounded").removeClass("active");$(".control-button").removeClass("active");$(".header-control").removeClass("active");e.remove();t.remove()},setActions:function(e){var t=this;e?this.actions=e:e=this.actions;this.$actions.empty();_.each(this.actions,function(e){var n=$(f({type:e.type,label:e.label,title:e.title||e.label}));t.$actions.append(n);n.on("click",e.callback);n.css({width:100/t.actions.length+"%"})});return this},clearActions:function(){this.actions=null;this.$actions.empty();return this},render:function(e,n){this.$el.attr("data-name",n);this.$body.empty();this.$head.empty();this.$body.append(e);if(n!==undefined){this.$head.append(n);this.$head.show()}else this.$head.hide();this.$el.modal("show");if(this._onFullScreenMode()){this.zIndex=this.zIndex||this.$el.zIndex();this.$el.zIndex(this.zIndex+10);this.listenToOnce(t.eventDispatcher,"widget:fullOff",this.hide)}this.$el.find('button[value="dialog-back"]').on("click",this.back);this.actions&&this.$(this.$actions).length==0?this.$body.after(this.$actions):null;this.delegateEvents();t.eventDispatcher.trigger("dialog:show");return this},closeModal:function(e){var t=$(e.currentTarget).hasClass("functionItem"),n=$(e.currentTarget).data().label;if(n=="Volume"||t==true)$(".modal").fadeOut(300)},goWide:function(){!this.$el.hasClass("wide")?this.$el.addClass("wide"):null;this.resetSizes();return this},goNormal:function(){this.$el.hasClass("wide")?this.$el.removeClass("wide"):null;this.resetSizes();return this},resetSizes:function(){this.$el.css({width:"",height:""});this.$body.css({width:"",height:""});this.adjustBodySizes();return this},adjustBodySizes:function(){var e=this.$el,t=$(this.settings.containment),n=t.offset(),r=this.$el.offset(),i=r,s={};r.left+=44;r.top+=44;i.left=r.left-n.left;i.top=r.top-n.top;i.right=t.width()-i.left-e.width();i.bottom=t.height()-i.top-e.height();i.left<0?(s.maxWidth+=i.left,s.marginLeft=parseInt(this.$el.css("margin-left"))-i.left):null;i.right<0?(s.maxWidth+=i.right,s.marginRight=parseInt(this.$el.css("margin-right"))-i.right):null;s.maxHeight=t.height()-i.top-r;this.$el.css(s);this.$body.css({maxHeight:s.maxHeight})},position:function(e){e=e||{};this.$el.data().modal.$element.css({left:e.left||"auto",top:e.top||"auto",right:e.right||"auto",bottom:e.bottom||"auto"});if(e.of||e.my||e.at||e.collision){this.$el.position({of:e.of,my:e.my,at:e.at,collision:e.collision,within:$(this.settings.containment),using:e.using});this.adjustBodySizes()}return this},positionInToolbar:function(e){this.position({of:e,my:"right+40px bottom-20px",at:"center top",collision:"flip flip"});var t=this.$el,n=$(this.settings.containment),r=e.getBoundingClientRect(),i=document.body.offsetWidth,s=document.body.offsetHeight,o=i-(r.width+r.left),u=r.left,a={left:0,top:r.top,width:0,height:0},f=parseInt(t.css("maxWidth"),10),l={left:10,top:-35};if(u>o)a.width=u-120;else a.width=o-40;a.left=r.width+r.left-40;t.css({margin:0,left:a.left+"px",top:a.top+50+"px",width:a.width+"px"});this.$pointer.css({left:l.left+"px","-webkit-transform":"scale(1, -1)","-moz-transform":"scale(1, -1)","-ms-transform":"scale(1, -1)"})},onBeforeHide:$.noop,hide:function(){if(this.onBeforeHide()!==false){var e=this;if(this.$el.hasClass("rail-control"))this.$el.animate({left:this.$el.width()*-1},300,function(){e.$el.modal("hide")});else this.$el.fadeOut(200,function(){e.$el.modal("hide")})}},onReject:$.noop,onBeforeAccept:$.noop,accept:function(){var e=this;if(this.onBeforeAccept()!==false){this.$el.off("hidden");this.$el.one("hidden",function(){e.trigger("dialog:accepted");e.remove();e.onAccept();e.onHide()});this.$el.modal("hide")}},back:function(){this.onBack()},_onFullScreenMode:function(){return $(".fullScreenView").is(":visible")},onAccept:$.noop,onHide:$.noop,onBack:$.noop});var a=_.template('        <div class="modal hide zd-palette <%= customClass %>">            <div class="modal-header zd-palette-titlebar">                <button title="Close" value="dialog-reject" class="zd icon close" />                 <button title="" value="dialog-back" class="zd icon back" style="display:none;" />                 <div class="zd icon header"/>                 <h3 class="dialog-head zd-palette-header"></h3>                <div class="clearfix"></div>            </div>            <div class="modal-body dialog-body zd-palette-body">            </div>            <div class="zd-palette-background">            </div>            <div class="zd-palette-background small">            </div>        </div>    '),f=_.template('            <button title="<%=title%>" class="zd btn btn-<%=type%>"><%=label%></button>        ');n.Palette=n.Dialog.extend({template:a,events:{"mousedown .modal-header":"moveToFront",'click button[value="dialog-reject"]':"hide","click .zd-palette-background":"hideDocked","keypress input":"keyEnterPressed"},defaults:{template:u,mode:"palette",draggable:true,docked:false,modal:true,containment:"body",minWidth:250,minHeight:100,defaultWidth:264},keyEnterPressed:function(e){t.Views.SearchBox.prototype.keyEnterPressed.apply(e,arguments)},initialize:function(e){t.MVC.View.prototype.initialize.apply(this,arguments);var r=this;e=e||{};_.bindAll(this,"showBackButton","hideBackButton");n.Dialog.prototype.initialize.apply(this,arguments);this.$body.css({maxHeight:"none"});if($(this.settings.containment).length)this.$body.css({height:$(this.settings.containment).height()-this.$el.offset().top-79});this.$el.on("dragstop",function(){r.adjustBodySizes()});if(this.options.draggable)this.setDragEvents()},render:function(){n.Dialog.prototype.render.apply(this,arguments);this.$el.resizable({containment:".zd-main",alsoResize:this.$body,minWidth:this.settings.minWidth,minHeight:this.settings.minHeight}).data().modal.$backdrop.addClass("zd-overlay");!this.isDocked()?this.undock():null;this.actions?this.$body.append(this.$actions):null;return this},setDragEvents:function(){var e=this,n={left:t.main.$section.find(".leftPane").width()+2,top:t.main.$header.height()};this.palettePosition=n;this.settings.draggable={onDragStart:function(t){e.$el.removeClass("docked");e.$el.addClass("undocked");e.settings.docked=false;e.$("div.zd-palette-background").remove()}}},isDocked:function(){return this.settings.docked},undock:function(){this.$el.removeClass("docked");!this.$el.hasClass("undocked")?this.$el.addClass("undocked"):null;this.$("div.zd-palette-background").hide();this.settings.docked=false;return this},dock:function(e){function n(){var e=!t.$("div.zd-palette-background").length>0;if(e){t.$el.css({width:t.settings.defaultWidth,height:$(t.settings.containment).height()});t.$body.css({width:t.settings.defaultWidth-24,height:$(t.settings.containment).height()-t.$head.parent().height()-24})}}var t=this;this.position(e);this.$el.removeClass("undocked");!this.$el.hasClass("docked")?this.$el.addClass("docked"):null;this.$("div.zd-palette-background").show();this.settings.docked=true;n();return this},hide:function(){this.$el.removeClass("active");this.$el.removeClass("fade");n.Dialog.prototype.hide.apply(this,arguments)},hideDocked:function(){if(this.settings.docked)this.hide()},moveToFront:function(){if(this._onFullScreenMode()){$(".zd-palette").zIndex($(".leftPane").zIndex()-2);this.$el.zIndex($(".leftPane").zIndex()-1)}else{$(".zd-palette").zIndex(1018);this.$el.zIndex(1019)}},showBackButton:function(){this.$('button[value="dialog-back"]').show()},hideBackButton:function(){this.$('button[value="dialog-back"]').hide()},remove:function(){this.clearActions();t.Controls.Dialog.prototype.remove.apply(this,arguments)}});var l=_.template('        <div class="modal hide zd-infopopup <%= customClass %>" >            <div class="modal-header zd-infopopup-titlebar">                <button title="Close" value="dialog-reject" class="zd icon close" />                <button title="" value="dialog-back" class="zd icon back" style="display:none;" />                  <h3 class="dialog-head zd-infopopup-header"></h3>                <div class="clearfix"></div>            </div>            <div class="modal-body dialog-body zd-infopopup-body">            </div>            <div class="zd-infopopup-background">            </div>            <div class="zd-infopopup-background small">            </div>        </div>    ');n.InfoPopup=n.Dialog.extend({template:l,events:{"click .zd-infopopup-background":"hide","keypress input":"keyEnterPressed"},defaults:{autohide:true,mode:"palette",draggable:false,resizable:false,modal:false,containment:"body"},keyEnterPressed:function(e){n.Palette.prototype.keyEnterPressed.apply(e,arguments)},initialize:function(e){function i(){r._lastPostiton?r.position():null}var r=this;this.options=$.extend({},this.options,e);this._lastPostiton=null;this._repostionCallback=_.debounce(i,300);$.extend(this.events,n.Dialog.prototype.events);n.Dialog.prototype.initialize.apply(this,arguments);this.$pointer=$('<div class="zd-infopopup-pointer"><div class="zd-infopopup-pointer-arrow"></div> </div>');$("body").one("dragstart",function(){r.hide()});this.$el.on("dragstart",false);$(window).on("resize",this._repostionCallback);if(this.options.autohide==true||typeof this.options.autohide=="string"&&this.options.autohide.search("onStop")!==-1)this.listenTo(t.eventDispatcher,"visualization:stop",this.hide)},render:function(){n.Dialog.prototype.render.apply(this,arguments);this.$(".zd-infopopup-background").show();this.$el.addClass("docked");this.$el.on("mousewheel","textarea",function(e,t,n,r){e.preventDefault();var i=$(this).scrollTop();$(this).scrollTop(i+r)});return this},position:function(e){function r(e,n){t.$el.css(e);t._showPointer(n)}var t=this;e=e||this._lastPostiton||{};this._lastPostiton=e;e.using=e.using||r;return n.Dialog.prototype.position.call(this,e)},_showPointer:function(e){var t=this.options.pointerWidth?this.options.pointerWidth:14,n=e.element,r=e.target,i={},s="behind",o=t+"px solid transparent",u=t+"px solid rgba(50, 50, 50, 0.9)",a=parseInt(this.$el.css("border-radius"));r.center={left:r.left+r.width/2,top:r.top+r.height/2};n.center={left:n.left+n.width/2,top:n.top+n.height/2};i.vertical=r.center.top-n.center.top;i.vertical<0?i.vertical=i.vertical+"px":i.vertical="+"+i.vertical+"px";i.horizontal=r.center.left-n.center.left;i.horizontal<0?i.horizontal=i.horizontal+"px":i.horizontal="+"+i.horizontal+"px";if(n.left+n.width<=r.center.left)s+=" right";if(n.left>=r.center.left)s+=" left";if(n.top+n.height<=r.center.top)s+=" bottom";if(n.top>=r.center.top)s+=" top";s=s.split(" ").splice(1);if(s.length==1){this.$pointer.appendTo(this.$el);switch(s[0]){case"left":this.$pointer.css({"border-top":o,"border-bottom":o,"border-right":u}).position({my:"right center",at:"left center"+i.vertical,of:this.el});if(r.width===0)e.element.element.css({left:"+=20"});break;case"right":this.$pointer.css({"border-top":o,"border-bottom":o,"border-left":u}).position({my:"left center",at:"right center"+i.vertical,of:this.el});if(r.width===0)e.element.element.css({left:"-=20"});break;case"top":this.$pointer.css({"border-top":u,"border-right":o,"border-left":o}).position({my:"center bottom",at:"center"+i.horizontal+" top",of:this.el});break;case"bottom":this.$pointer.css({"border-right":o,"border-top":u,"border-left":o}).position({my:"center top",at:"center"+i.horizontal+" bottom",of:this.el});break}var f={};f.top=parseInt(this.$pointer.css("top"));f.left=parseInt(this.$pointer.css("left"));f.offset=this.$pointer.offset();switch(s[0]){case"left":break;case"right":if(n.top+a>f.offset.top)this.$pointer.css("top",f.top+a);break;case"top":break;case"bottom":if(n.left+a>f.offset.left)this.$pointer.css("left",f.left+a);break}}},remove:function(){$(window).off("resize",this._repostionCallback);n.Dialog.prototype.remove.apply(this,arguments)}});var c=_.template('        <div class="modal hide zd-smallpopup <%= customClass %>" >            <div class="modal-body dialog-body zd-smallpopup-body">            </div>            <div class="zd-smallpopup-background">            </div>            <div class="zd-smallpopup-background small">            </div>        </div>    ');n.SmallPopup=n.Dialog.extend({template:c,events:{"click .zd-smallpopup-background":"hide","keypress input":"keyEnterPressed"},defaults:{mode:"palette",draggable:false,resizable:false,modal:false,containment:"body"},keyEnterPressed:function(e){n.Palette.prototype.keyEnterPressed.apply(e,arguments)},initialize:function(){function r(){e._lastPostiton?e.position():null}var e=this;this._lastPostiton=null;this._repostionCallback=_.debounce(r,300);$.extend(this.events,n.Dialog.prototype.events);n.Dialog.prototype.initialize.apply(this,arguments);this.$pointer=$('<div class="zd-smallpopup-pointer"><div class="zd-smallpopup-pointer-arrow"></div></div>');$("body").one("dragstart",function(){e.hide()});this.$el.on("dragstart",false);$(window).on("resize",this._repostionCallback);this.listenTo(t.eventDispatcher,"visualization:stop",this.hide)},render:function(){n.Dialog.prototype.render.apply(this,arguments);this.$(".zd-smallpopup-background").show();this.$el.on("mousewheel","textarea",function(e,t,n,r){e.preventDefault();var i=$(this).scrollTop();$(this).scrollTop(i+r)});return this},position:function(e){function r(n,r){n.top-=e.pointerTop||0;t.$el.css(n);t._showPointer(r)}var t=this;e=e||this._lastPostiton||{};this._lastPostiton=e;e.using=e.using||r;return n.Dialog.prototype.position.call(this,e)},_showPointer:function(e){var t=e.element,n=e.target,r={},i="behind",s="10px solid transparent",o="10px solid rgb(230, 230, 230)";n.center={left:n.left+n.width/2,top:n.top+n.height/2};t.center={left:t.left+t.width/2,top:t.top+t.height/2};r.vertical=n.center.top-t.center.top;r.vertical<0?r.vertical=r.vertical+"px":r.vertical="+"+r.vertical+"px";r.horizontal=n.center.left-t.center.left;r.horizontal<0?r.horizontal=r.horizontal+"px":r.horizontal="+"+r.horizontal+"px";if(t.left+t.width<n.center.left)i+=" right";if(t.left>n.center.left)i+=" left";if(t.top+t.height<n.center.top)i+=" bottom";if(t.top>n.center.top)i+=" top";i=i.split(" ").splice(1);if(i.length==1){this.$pointer.appendTo(this.$el);switch(i[0]){case"left":this.$pointer.css({"border-top":s,"border-bottom":s,"border-right":o}).position({my:"right center",at:"left center"+r.vertical,of:this.el});break;case"right":this.$pointer.css({"border-top":s,"border-bottom":s,"border-left":o}).position({my:"left center",at:"right center"+r.vertical,of:this.el});break;case"top":this.$pointer.css({"border-top":o,"border-right":s,"border-left":s}).position({my:"center bottom",at:"center"+r.horizontal+" top",of:this.el});break;case"bottom":this.$pointer.css({"border-right":s,"border-top":o,"border-left":s}).position({my:"center top",at:"center"+r.horizontal+" bottom",of:this.el});break}}},remove:function(){$(window).off("resize",this._repostionCallback);n.Dialog.prototype.remove.apply(this,arguments)}});n.PalettePopup=n.InfoPopup.extend({initialize:function(e){t.MVC.View.prototype.initialize.apply(this,arguments);_.bindAll(this,"showBackButton","hideBackButton");n.InfoPopup.prototype.initialize.apply(this,arguments);this.$el.on("dragstart",false);return this},render:function(){var e={top:12,bottom:66};n.InfoPopup.prototype.render.apply(this,arguments);this.$el.addClass("zd-palettepopup");if(this.settings.handlers)this.showHandlers();this.$body.css("max-height",this.options.containment.height()-e.top-e.bottom-(this.$el.outerHeight()-this.$body.height()));return this},showHandlers:function(){var e=this;this.handlers=this.options.handlers;this.$footer=$('<div class="zd-infopopup-footer"></div>');this.$el.append(this.$footer);_.each(this.handlers,function(t){var n=$('<div class="btn-remove"><i class="zd icon '+t.icon+'"></i>'+t.title+"</div>").click(function(){t.callback()});e.$footer.append(n)})},showBackButton:function(){t.Controls.Palette.prototype.showBackButton.apply(this,arguments);return this},hideBackButton:function(){t.Controls.Palette.prototype.hideBackButton.apply(this,arguments);return this}});n.DetailsPopup=n.Dialog.extend({template:l,events:{"click .zd-infopopup-background":"hide"},defaults:{mode:"palette",draggable:false,resizable:false,modal:false,containment:"body"},initialize:function(){$.extend(this.events,n.Dialog.prototype.events);n.Dialog.prototype.initialize.apply(this,arguments)}});var h=_.template('        <div>             <div class="zd-side-pane">                <div class="zd-side-pane-header"/>                <button value="closeSidePane" class="close">&times;</button>                <div class="zd-side-pane-body"/>            </div>        </div>     ');var p=_.template('        <div class="zd-modal sidepane">             <div class="zd-side-pane">                <div class="zd-side-pane-loading"/>                <div class="zd-side-pane-header"/>                <div class="zd-side-pane-body"/>            </div>        </div>     ');n.SidePane=t.MVC.View.extend({initialize:function(){function n(){var n=t.user||new t.Models.User;n.bootstrap().done(function(){var e=n.get("name");window.localStorage["sidePaneHasBeenClosedBy"+e]="true"});e.$el.hide();t.eventDispatcher.trigger("sidepane:manualhide")}t.MVC.View.prototype.initialize.apply(this,arguments);_.bindAll(this,"render","hide","show","close","getHeader","visible");var e=this;this.hasCloseButton=this.options.hasCloseButton;this.template=this.hasCloseButton?h:p;this.setElement(this.template());this.$el.appendTo("body");this.hide();this.$loading=this.$(".zd-side-pane-loading");this.$body=this.$(".zd-side-pane-body");this.$header=this.$(".zd-side-pane-header");this.$closeButton=this.$(".close");if(!this.hasCloseButton){this.$(".zd-side-pane").on("click",function(e){e.stopPropagation()});this.$el.on("click",n)}},events:{"click .close":"hide"},render:function(e){this.$body.empty();this.$body.append(e);this.delegateEvents();return this},hide:function(){this.$el.hide()},show:function(){$(".zd-side-pane").parent("div").hide();this.$el.show();this.$el.find("input").blur()},close:function(){this.$el.remove()},getHeader:function(){return this.$header},visible:function(){return this.$el&&this.$el.is(":visible")}});var d=_.template('        <span><%= message %></span>        <i title="<%= acceptTitle%>" class="icon-ok icon-white"></i>        <i title="<%= cancelTitle%>" class="icon-remove icon-white"></i>    ');n.ConfirmMessage=t.MVC.View.extend({tagName:"span",className:"label label-warning pull-right confirmMessage",defaults:{template:d,message:"Warning",acceptTitle:"Accept",cancelTitle:"Cancel"},events:{"click .icon-ok":"accept","click .icon-remove":"cancel"},initialize:function(e){this.settings=$.extend({},this.defaults,e);this._deferred=$.Deferred();this.result=this._deferred.promise()},accept:function(){var e=this;this.$el.fadeOut(function(){e.remove();e._deferred.resolve()});return false},cancel:function(){var e=this;this.$el.fadeOut(function(){e.remove();e._deferred.reject()});return false},render:function(){this.$el.html(this.settings.template({message:this.settings.message,acceptTitle:this.settings.acceptTitle,cancelTitle:this.settings.cancelTitle}));this.$el.hide().fadeIn();this.delegateEvents();return this}});n.Notification=t.MVC.View.extend({defaults:{delay:3e3,type:"info"},events:{click:"remove"},initialize:function(e){e=e||{};if(e.template){this.template=e.template;delete e.template}this.options=$.extend({},this.defaults,e);this.$el.addClass("zd notification alert alert-"+this.options.type).appendTo("body").hide()},render:function(e){var t=this;this.empty();this.$el.append(e);if(this.options.type!="error")setTimeout(function(){t.remove()},this.options.delay);else this.$el.append('<div class="closeError zd icon remove"></div>');this.$el.slideDown();return this},remove:function(){var e=this,n=arguments;this.$el.slideUp(function(){t.MVC.View.prototype.remove.apply(e,n)})}});n.Popover=function(){var e=t.MVC.View.extend({contentView:null,_data:false,_container:false,_stopHide:false,_setEvents:false,_setHeadEvents:false,_buttons:{},_headTemplate:'<span style="overflow: hidden;display: block;"><%=name%></span>',_bodyTemplate:'<div class="span4" style="margin-left:0">                     <div class="row-fluid">                           <div class="popoverWindow" id="popowerWindow_1" style="min-height:<%=height%>px;">                        <div style="height: <%=height-40%>px; overflow: auto;">                         <% _.each(data, function(period) { %>                            <div class="span12 popoverSmallHeader">                                <%=period.name%>                             </div>                              <div class="span12 popoverDataInfo">                                Time Window                                 <div><%=period.time%></div>                             </div>                              <% _.each(period.values, function(val) { %>                                <div class="span12 popoverDataInfo">                                    <%=val.name%>                                     <div><%=val.value%></div>                                 </div>                              <%});%>                        <%});%>                        </div>                             <div class="span12 popoverFooter">                                <span></span>                                <div class="btn-group">                                    <button class="btn<% if (buttons.zoom == false) {%> dis<%}%>" data-type="zoom">Zoom In</button>                                    <button class="btn<% if (buttons.details == false) {%> dis<%}%>" data-type="details">Details</button>                                    <button class="btn<% if (buttons.trend == false) {%> dis<%}%>" data-type="trend" data-name="_ts">Trend</button>                                    <% if (buttons.twitter) {%><button class="btn" data-type="twitter" data-name="_ts">Twitter</button><%}%>                                </div>                            </div>                        </div>                        <div class="popoverWindow" id="popowerWindow_2" style="display:none;min-height:<%=height%>px;">                            <div style="height: <%=height%>px; overflow: auto;">                                 <% _.each(zoomInFields, function(val) { %>                                    <div class="span12 popoverDataInfo">                                        <div class="popoverZoomTo" data-name="<%=val.name%>"><%=val.label%></div>                                     </div>                                  <%});%>                            </div>                        </div>                                            </div>                </div>',initialize:function(e){t.MVC.View.prototype.initialize.apply(this,arguments);_.bindAll(this,"render","buildPopoverHeader","buildPopoverBody","show","hide","setTemplate","data","stopHide");e=$.extend({setEvents:false,setHeadEvents:false,body:false,head:false,container:$("body"),buttons:false},e);this._buttons={zoom:true,details:false,trend:false,twitter:false};var n=this;if(typeof e.setEvents==="function")this._setEvents=e.setEvents;if(typeof e.setHeadEvents==="function")this._setHeadEvents=e.setHeadEvents;if(e.body)this._bodyTemplate=e.body;if(e.buttons)this._buttons=$.extend(this._buttons,e.buttons);if(e.head)this._headTemplate=e.head;if(e.container)this._container=e.container;$("#popoverElement").remove();$("body").append($("<div>").attr("id","popoverElement").css({position:"absolute",width:1,height:1,display:"none","z-index":1010}).append("<div>"));return this.render()},render:function(){var e=this;$("#popoverElement>div").popover({html:true,title:function(){return e.buildPopoverHeader()},content:function(){return e.buildPopoverBody()}}).on("show",function(){console.log("popover shown");$(".zd-main-section").off("click").on("click",function(t){e.hide(t)});t.eventDispatcher.trigger("freezeTime")}).on("hide",function(){console.log("popover hidden");$(".zd-main-section").off("click");t.eventDispatcher.trigger("unfreezeTime")});t.eventDispatcher.trigger("rendered");this.listenToOnce(t.eventDispatcher,"visualization:stop",function(){$("#popoverElement").remove()});return this},buildPopoverHeader:function(){var e=$(_.template(this._headTemplate,this._data));if(typeof this._setHeadEvents=="function")this._setHeadEvents(e,this._data);return e},buildPopoverBody:function(){this._data.buttons=this._buttons;this._data.height=Math.max(250,Math.min(500,$("body").height()/2));var e=$(_.template(this._bodyTemplate,this._data));if(typeof this._setEvents=="function")this._setEvents(e,this._data);return e},hideDelay:false,show:function(e,n){var r=n.x,i=n.y;this._data=e;var s=this;$("#popContainer").attr("class",t.main.$section.width()<500?"span3":"span4");$("#popoverElement .popoverFooter .btn-group").css("paddingLeft",t.main.$section.width()<500?"6%":"15%");var o=$("body").height(),u=null,a=null,f=null,l=0,c=0;var h=t.Utilities.MODE.WIDGET!==t.Utilities.mode()&&o>=450?300:10;var p=t.Utilities.MODE.WIDGET!==t.Utilities.mode()&&o>=450?50:10;c=Math.max(200,Math.min(Math.max(i,h),o-p));u=$("#popoverElement");u.css({top:c,left:r}).show().find("div").popover("show");a=$("#popoverElement .popover");f=$("#popoverElement .arrow");if(r+a.width()*1>t.main.$section.width()+$("#popContainer").width()/2)u.css("left",Math.max(10,r-a.width()-10)).find(".popover").removeClass("right").addClass("left");var d=$("#popoverElement>.popover").height();if(c+d/2>o-p){c=o-p-d/2;u.css("top",c)}l=i-(c+a.position().top);var v=d,m=2,g=f[0].offsetHeight;l=Math.min(v-g/2-m,l);l=Math.max(g/2+m*2,l);f.css("top",l);this.hideDelay=true;setTimeout(function(){s.hideDelay=false},200)},hide:function(e){if(this._stopHide){this._stopHide=false;return}if(undefined!==e)if($(e.target).parents(".popover").length||$(e.target).parent(".bar").length||this.hideDelay)return;$("#popoverElement>div:first").popover("hide")},setTemplate:function(e,t){if(undefined!==t&&t)this._headTemplate=e;else this._bodyTemplate=e},data:function(){return this._data},stopHide:function(){this._stopHide=true}});return e}();n.TwittViewer=t.MVC.View.extend({contentView:null,_data:false,_stopHide:false,_setEvents:false,_bodyTemplate:"<div></div>",initialize:function(e){t.MVC.View.prototype.initialize.apply(this,arguments);e=$.extend({setEvents:false,body:false},e);var n=this;if(typeof e.setEvents=="function")this._setEvents=e.setEvents;if(e.body)this._bodyTemplate=e.body;$("#twittViewerElement").remove();$("body").append($("<div>").attr("id","twittViewerElement").attr("class","modal hide fade").attr("tabindex","-1").attr("role","dialog").attr("aria-labelledby","myModalLabel").attr("aria-hidden","true"));return this.render()},render:function(){$("#twittViewerElement").html(this.buildTwittViewerBody());$("#twittViewerElement").modal({show:false});return this},buildTwittViewerBody:function(){console.log(this._data);var e=$(_.template(this._bodyTemplate,this._data)());if(typeof this._setEvents=="function")this._setEvents(e,this._data);return e},show:function(e,t){this._data=e;var n=this;var r=function(e){n.hide(e)};$("#twittViewerElement").modal("show")},hide:function(e){$("#twittViewerElement").modal("hide");t.eventDispatcher.trigger("twittViewerHide")},data:function(){return this._data}});var v=_.template('        <span class="zd-radial-item-label"><%=label%></span>    ');n.RadialMenu=t.MVC.View.extend({className:"zd-radial-menu",defaults:{template:v,arc:{start:-40,end:220,gap:4,radius:66,width:44,color:"rgba(0, 0, 0, 0.7)"},arcClosed:{radius:66,width:44,start:89,angle:2}},events:{},initialize:function(e){var n,r=this;e=e||{};this.items=[];this.icons=[];this.closed=[];this.position={left:"50%",top:"50%"};t.MVC.View.prototype.initialize.apply(this,arguments);n={start:90,end:90,gap:0,radius:this.options.arc.radius,width:this.options.arc.width};this.start=$('<div class="zd-radial-start"></div>');this._renderStart(n);this.end=$('<div class="zd-radial-end"></div>');this._renderEnd(n);if(e.items){this.reset(e.items);delete this.options.items}return this},render:function(e){var t=this;e=e||{};this.empty();if(e.group==="")this.$el.addClass("zd-empty-group");else this.$el.removeClass("zd-empty-group");this.$el.append(this.start.show());this.$el.append(this.end.show());this.start.off("transitionend");this.end.off("transitionend");this.start.on("click",function(){t.items[0].arc.$donut.click()}).on("mouseenter",function(){!t.items[0].arc.$donut.hasClass("active")?t.items[0].arc.$donut.addClass("active"):null}).on("mouseleave",function(){t.items[0].arc.$donut.hasClass("active")?t.items[0].arc.$donut.removeClass("active"):null});this.end.on("click",function(){var e=t.items.length-1;t.items[e].arc.$donut.click()}).on("mouseenter",function(){var e=t.items.length-1;!t.items[e].arc.$donut.hasClass("active")?t.items[e].arc.$donut.addClass("active"):null}).on("mouseleave",function(){var e=t.items.length-1;t.items[e].arc.$donut.hasClass("active")?t.items[e].arc.$donut.removeClass("active"):null});requestAnimationFrame(function(){t._renderStart();t._renderEnd()});this.setPosition(e);this.renderItems();this.renderIcons();return this},renderIcons:function(){var e=this;_.each(this.icons,function(t,n){e.renderIcon(n)});return this},renderIcon:function(e){var t=this,n=this.icons;if(e<0||e>=n.length)return this;!this.$el.children().has(n[e].$icon).length?this.$el.append(n[e].$icon):null;requestAnimationFrame(function(){e%2?n[e].$icon.css({top:20,right:t.options.arc.radius,opacity:1}):n[e].$icon.css({top:20,left:t.options.arc.radius,opacity:1})});return this},setPosition:function(e){this.position.left=e.left||this.position.left;this.position.top=e.top||this.position.top;this.$el.css({left:this.position.left,top:this.position.top});return this},renderItems:function(){var e=this,t=this.items.length;_.each(this.items,function(t,n){e.renderItem(n)});return this},renderItem:function(e){var t=this.items;if(this.isClosed(e))return this;if(e<0||e>=t.length)return this;this._renderArc(e);t[e].arc.$el.show(200);return this},reset:function(e){var t=this;this.clear();_.each(e,function(e){t.add(e)});return this},clear:function(){this.clearItems();this.clearIcons();return this},clearItems:function(){while(this.items.length!==0)this.removeItem(0);this.closed=[];return this},clearIcons:function(){while(this.icons.length!==0)this.removeIcon(0);return this},add:function(e){switch(e.type){case"icon":this.addIcon(e);break;case"arc":default:this.addItem(e);break}return this},addIcon:function(e){var t=this;e.$icon=$('<div class="zd-radial-icon" title="'+e.label+'"></div>');e.$icon.append('<i class="zd-icon zd-icon-'+e.label.toLowerCase()+'"/>');e.$icon.on("click",function(n){if(typeof e.action=="function")return e.action.call(this,n,t.$el);else return null});this.icons.push(e);return this},addItem:function(e){var t=this,n=this.items,i=n[0],s=n[n.length-1];e.arc=new r.Arc(this.options.arcClosed);e.arc.$donut.on("click",function(n){if(e.group.group!==""&&typeof e.action=="function")return e.action.call(this,n,t.$el);else{if(e.group.group==="")n.stopPropagation();return null}});e.arc.$center.html(this.options.template(e));s&&s.arc.$donut.off("mouseenter");s&&s.arc.$donut.off("mouseleave");e.arc.$donut.on("mouseenter",function(){!t.end.hasClass("active")?t.end.addClass("active"):null}).on("mouseleave",function(){t.end.hasClass("active")?t.end.removeClass("active"):null});i&&i.arc.$donut.on("mouseenter",function(){!t.start.hasClass("active")?t.start.addClass("active"):null}).on("mouseleave",function(){t.start.hasClass("active")?t.start.removeClass("active"):null});var o=this.allOrUnFilterAll(e);if(e.disabled!==undefined&&$.isFunction(e.disabled)&&e.disabled()===true)return this;if(o!==e.name)this.items.push(e);return this},allOrUnFilterAll:function(e){var n=t.main.currentSection.widgetGrid.childViews;var r="un_filter_all";if(e.name==="un_filter_all"||e.name==="filter_all")_.each(n,function(t){if(t.controller.filtersIndicator){var n=t.controller.filtersIndicator.collection.models;_.each(n,function(t){t.get("value").indexOf(e.group.group)>=0?r="filter_all":null})}});return r},removeItem:function(e){var t=this.items[e];if(this.isClosed(e))this.closed.splice(this.closed.indexOf(e),1);t.arc.$donut.off("click");t.arc.$donut.off("mouseenter");t.arc.$donut.off("mouseleave");t.arc.remove();this.items.splice(e,1);return this},removeIcon:function(e){var t=this.icons[e];t.$icon.off("click");t.$icon.remove();this.icons.splice(e,2);return this},close:function(){var e=this,t={start:90,end:90,gap:0,radius:this.options.arc.radius,width:this.options.arc.width};_.each(this.items,function(t,n){e.closeItem(n)});_.each(this.icons,function(t,n){e.closeIcon(n)});if(this.start){this._renderStart(t);this.start.one("transitionend",function(){e.start.hide();e.empty()})}if(this.end){this._renderEnd(t);this.end.one("transitionend",function(){e.end.hide();e.empty()})}return this},open:function(){this.closed=[];this.renderItems();this.renderIcons();return this},closeItem:function(e){var t=this.items;if(this.isClosed(e))return this;if(e<0||e>=t.length)return this;t[e].arc.set(this.options.arcClosed);t[e].arc.$el.fadeOut(200);this.closed.push(e);return this},closeIcon:function(e){var t=this.icons;t[e].$icon.css({width:0,height:0,opacity:0});return this},openItem:function(e){var t=this.items;if(!this.isClosed(e))return this;if(e<0||e>=t.length)return this;this.closed.splice(this.closed.indexOf(e),1);this.renderItem(e);return this},isClosed:function(e){return this.closed.indexOf(e)!==-1},_renderArc:function(e){var t=e,n=this.items.length-this.closed.length,r=this.items[e].arc,i={};_.each(this.closed,function(n){e>n?t--:null});i.gap=this.options.arc.gap;i.radius=this.options.arc.radius;i.angle=(this.options.arc.end-this.options.arc.start)/n;i.start=this.options.arc.start+i.angle*t;!this.$el.children().has(r.$el).length?this.$el.append(r.$el):null;requestAnimationFrame(function(){r.set(i)});return this},_renderStart:function(e){var t=this.start,e=e||this.options.arc,n=e.end+90,r=e.width,i=e.radius-e.width,s=-e.width/2+e.gap/2;t.css({transform:"rotate("+n+"deg)",transformOrigin:-s+"px "+ -i+"px",width:r/2,height:r,borderBottomLeftRadius:r/2,borderTopLeftRadius:r/2,top:i,left:s})},_renderEnd:function(e){var t=this.end,e=e||this.options.arc,n=e.start+90,r=e.width,i=e.radius-e.width,s=-e.gap/2;t.css({transform:"rotate("+n+"deg)",transformOrigin:-s+"px "+ -i+"px",width:r/2,height:r,borderBottomRightRadius:r/2,borderTopRightRadius:r/2,top:i,left:s})}});var m='        <div class="color-picker-button" style="background: <%=color%>;"></div>     ';n.ColorPicker=t.MVC.View.extend({initialize:function(e){t.MVC.View.prototype.initialize.apply(this,arguments);this.color=e.color;return this.render()},render:function(){this.button=$(_.template(m,{color:this.color}));this.$el.append(this.button);this.renderPopup();return this},setColor:function(e){this.color=e;this.button.css("background",this.color);this.button.spectrum("set",this.color)},renderPopup:function(){var e=this,n,r;this.button.spectrum({color:this.color,preferredFormat:"hex",showInput:true,showInitial:true,chooseText:"Apply",cancelText:"Cancel",change:function(t){e.color=t.toHexString();e.button.css("background",e.color);e.trigger("change",e.color)},beforeShow:function(){e.trigger("beforeShow")},show:function(){if(!r){r=$(".sp-container:visible");r.find(".sp-choose").addClass("zd btn btn-success btn-block");r.find(".sp-cancel").addClass("zd btn btn-cancel btn-block").insertAfter(r.find(".sp-choose"))}n=new t.Controls.SmallPopup({containment:t.main.$section,customClass:"colorPickerPalette",pointerWidth:14});n.render(r).position({of:e.button,my:"left+10 center+10",at:"right center",collision:"flipfit flipfit"})},hide:function(){r.appendTo("body");n.hide()}})}});t.Controls=n})(window,Zoomdata);(function(e,t){var n='        <table class="table table-striped">            <%_.each(_.keys(attributes), function (key) {%>                <tr>                    <td><%=key%></td>                    <td><%=attributes[key]%></td>                </tr>            <%});%>        </table>         ';t.Views=t.Views||{};t.Views.ListItem=t.MVC.View.extend({tagName:"li",className:"zd-list-item",model:new t.MVC.Model,events:{click:"_onClick"},defaults:{template:_.template(n),selectedClass:"zd-item-selected",selectable:false},initialize:function(e){this.childViews=[];this.settings=$.extend({},this.defaults,e);this.$el.data("itemView",this);this.listenTo(this.model,"change",this.render);return this},render:function(){if(this.settings.icon){this.detectIconType();this.$el.html(this.settings.template({attributes:this.model.attributes,type_image:this.model.type_image}))}else this.$el.html(this.settings.template({model:this.model,attributes:this.model.attributes}));this.delegateEvents();return this},_onClick:function(){if(this.settings.selectable){this.toggle();return false}else{var e=$(".widgetBody").has(".configure-palette");if(e.length!=0)t.eventDispatcher.trigger("close:configurePalette")}},toggle:function(){this.$el.toggleClass(this.settings.selectedClass);this.trigger("toggle",this.model)}})})(window,Zoomdata);(function(e,t){var n=t.Views.ListItem,r=t.Views.SearchBox,i=t.MVC.Collection,s=_.template('            <span class="zd-loader">Loading...</span>         ');t.Views=t.Views||{};t.Views.ListView=t.MVC.View.extend({tagName:"ul",className:"unstyled",defaults:{loaderTemplate:s,search:false,sortable:false,selectable:false,sortOptions:{tolerance:"pointer"},sortbyOptions:null,sortOpened:false,filter:function(){return true},ItemView:n},events:{sortstop:"onSortstop",sortreceive:"onSortreceive",sortremove:"onSortremove"},initialize:function(e){var t=this;this.childViews=[];this.options=$.extend({},this.defaults,e);this.collection=this.collection||new i;this.applyListeners();if(this.options.sortable)this.$el.sortable(this.options.sortOptions);if(this.options.search!==false){this.searchBox=new r;this.listenTo(this.searchBox,"search",this._renderItems)}if(this.options.selectable){this.selected=[];this.listenTo(this.collection,"toggle",function(e){var n=t.selected.indexOf(e),r=t.childViews,i=t.selected;if(t.options.selectable!=="checkbox"){_.each(r,function(t){t.model!==e&&i.indexOf(t.model)!==-1?t.toggle():null});n=t.selected.indexOf(e)}n==-1?i.push(e):i.splice(n,1)})}return this},applyListeners:function(){this.listenTo(this.collection,"request:collection",this._showLoader);this.listenTo(this.collection,"remove reset sync:collection",this.render);this.listenTo(this.collection,"add",this._onAddItem)},removeListeners:function(){this.stopListening(this.collection,"request:collection");this.stopListening(this.collection,"remove reset sync:collection");this.stopListening(this.collection,"add")},getItemByModel:function(e){var t=this.childViews,n=null;_.each(t,function(t){t.model==e?n=t:null});return n},getSelectedItems:function(){return this.selected},sortCollection:function(e){function u(e,n){_.each(e.models,function(r,i){var s=r.get("name");if(n&&n.indexOf(s)>=0){var o=e.models.splice(i,1);e.models.unshift(o[0])}else if(s===t.options.sortOpened){var o=e.models.splice(i,1);e.models.unshift(o[0])}})}var t=this,n=this.collection.comparator,r=e&&e.sortby,i=e&&e.ascending,s=e&&e.limitShowCount?e.limitShowCount:null;if(!e||r==="Name"){var o=_.sortBy(this.collection.models,function(t){if(e&&!e.ascending){var r=t.get("name").toLowerCase();r=r.split("");r=_.map(r,function(e){return String.fromCharCode(-e.charCodeAt(0))});return r}else if(n);else return t.get("name")?t.get("name").toLowerCase():""});this.collection.models=o}else if(r==="Last Used"){var o=_.sortBy(this.collection.models,function(e){return i?-e.get("lastModified"):e.get("lastModified")});this.collection.models=o}else if(r==="Popularity"){var o=_.sortBy(this.collection.models,function(e){return i?-e.get("viewsCount"):e.get("viewsCount")});this.collection.models=o}else if(r==="Type"){var o=_.sortBy(this.collection.models,function(e){return e.get("type")});this.collection.models=i?o:o.reverse()}if(this.options.sortOpened)typeof this.options.sortOpened==="string"?u(this.collection):u(this.collection,this.options.openedSources)},onSortstop:function(){this.sortCollection()},onSortreceive:function(e,t){var n=t.item,r=n.data("itemView"),i=r.model;this.collection.add(i,{silent:true});this.sortCollection();this.collection.trigger("add")},onSortremove:function(e,t){var n=t.item,r=n.data("itemView"),i=r.model;this.collection.remove(i,{silent:true});this.childViews.splice(this.childViews.indexOf(r),1)},_onAddItem:function(e){if(!e||this.searchBox&&!e.matchesSearch(this.options.search,this.searchBox.model.toJSON()))return false;this._renderItem(e);return false},_renderItem:function(e){var t=this,n={model:e,template:this.options.template,selectable:this.options.selectable};if(this.options.itemOption)n=$.extend({},this.options.itemOption,n);var r=new this.options.ItemView(n);if(this.sources)r.model.set("sources",this.sources);this.$el.append(r.render().el);this.childViews.push(r);this.listenTo(r,"select",function(e,n){t.trigger("select",e,n)});this.listenTo(r,"toggle",function(e){t.trigger("toggle",e)})},_renderItems:function(){var e=this,t=this.collection.models,n=e.options.sortbyOptions,r=n&&n.limitShowCount?n.limitShowCount:null;this._removeItems();if(this.searchBox)t=this.collection.search(this.options.search,this.searchBox.model.toJSON());_.each(_.filter(t,this.options.filter),function(t,n){if(r&&n>=r)return;e._renderItem(t)});if(this.options.sortable)this.$el.sortable("refresh")},_removeItems:function(){this._removeChildViews()},render:function(e){e=$.extend({},this.options.sortbyOptions,e);var t=this.options.sortbyOptions||e&&e.sortby?e:null;this.empty();t?this.sortCollection(t):this.sortCollection();this.searchBox?this.$el.prepend(this.searchBox.render().el):null;this._renderItems();return this},_showLoader:function(){this.empty();this.$el.html(this.options.loaderTemplate())},remove:function(){t.MVC.View.prototype.remove.apply(this,arguments);this.searchBox?this.searchBox.remove():null}})})(window,Zoomdata);(function(e,t){var n=t.Views.ListItem,r=t.Views.ListView,i=t.MVC.Collection;var s='          <legend class="subhead"><%= label %></legend>    ';t.Views=t.Views||{};t.Views.GroupedListView=t.MVC.View.extend({className:"unstyled",defaults:{ItemView:n,ListView:r,groupClassName:"nav nav-tabs nav-stacked",selectable:false,filter:function(e){return true}},events:{},initialize:function(e){var n=this;t.MVC.View.prototype.initialize.apply(this,arguments);this.childViews=[];this.groups={};this.collection=this.collection||new i;this.listenTo(this.collection,"add",function(e){var t=n.options.groupBy,r=e.get(t);typeof r!=="undefined"?this._addToGroup(e.get(t),e):null});this.listenTo(this.collection,"remove",function(e){var t=e.get(n.options.groupBy);typeof t!=="undefined"?this._removeFromGroup(e.get(n.options.groupBy),e):null});this.listenTo(this.collection,"reset",function(e){this._resetGroups()});this._resetGroups();return this},_createGroup:function(e,t){var n=this;if(typeof this.groups[e]!=="undefined")this._removeGroup(e);var r=new i(t);if(this.options.comparator){r.comparator=this.options.comparator;r.sort()}this.groups[e]=new this.options.ListView({className:this.options.groupClassName,ItemView:this.options.ItemView,itemOption:this.options.itemOption||null,selectable:this.options.selectable,template:this.options.template,collection:r,filter:this.options.filter});this._renderGroup(e);this.childViews.push(this.groups[e]);this.listenTo(this.groups[e],"select",function(e){n.trigger("select",e)})},_removeGroup:function(e){if(typeof this.groups[e]!=="undefined"){this.groups[e].$el.prev().remove();this.groups[e].remove();this.childViews.splice(this.childViews.indexOf(this.groups[e]),1);delete this.groups[e]}},_clearGroups:function(){var e=this;_.each(this.groups,function(t,n){e._removeGroup(n)})},_removeFromGroup:function(e,t){var n;if(typeof this.groups[e]!=="undefined"){n=this.groups[e].collection.findWhere(t.attributes);n?this.groups[e].collection.remove(n):null;this.groups[e].collection.length==0?this._removeGroup(e):null}},_addToGroup:function(e,t){if(typeof this.groups[e]==="undefined")this._createGroup(e);this.groups[e].collection.add(t,{merge:true})},_resetGroups:function(){var e=this;this._clearGroups();var t=this.collection.groupBy(function(t){return t.get(e.options.groupBy)});_.each(t,function(t,n){e._createGroup(n,t)})},_renderGroup:function(e){var n=this.groups[e].render().el;if(n.childNodes.length){this.$el.append(_.template(s,{label:t.Utilities.toTitleCase(e)}));this.$el.append(this.groups[e].el)}},_sortGroups:function(){var e=this.groups;var t={};var n=Object.keys(e).sort(function(t,n){return e[t]-e[n]});n.sort();for(var r in e)_.each(n,function(r,i){t[n[i]]=e[r]});this.groups=t},_sortGroupModels:function(e){var t=e.groups;var n={};_.each(t,function(e,t){var r=[];var i=[];_.each(e.collection.models,function(t,n){var t=e.collection.models[n].get("label");r.push([t,n,e.collection.models[n]])});r.sort();_.each(r,function(t,n){var s=r[n][2];e.collection.model[n]=s;i.push(s)});n[t]=i;e.collection.models=i})},setFilter:function(e){this.options.filter=e;_.each(this.groups,function(t,n){n.options.filter=e})},render:function(){var e=this;this.empty();this._sortGroups();_.each(this.groups,function(t,n){e._renderGroup(n)});return this},remove:function(){this._clearGroups();t.MVC.View.prototype.remove.apply(this,arguments)}})})(window,Zoomdata);(function(e,t){var n=t.Models.Source,r=_.template('            <div class="object-field-container ">                <div title="<%= attributes.type.toLowerCase()%>" class="zd icon drag-icon <%= attributes.type.toLowerCase()%>"></div>                <div class="text"><%= attributes.label%></div>                <i class="zd icon right-chevron" style="display: none"></i>            </div>        '),i=_.template('            <div class="attributeItem">                <div class="text"><%= attributes.label%></div>            </div>        ');t.Views=t.Views||{};t.Views.ObjectFieldItem=t.Views.ListItem.extend({model:new n,className:"object-field",events:{click:"select"},defaults:{template:r},select:function(){this.model.collection.trigger("select",this.model);this.trigger("select",this.model)}});t.Views.SmallObjectFieldItem=t.Views.ObjectFieldItem.extend({className:"",selectTemplate:'<span class="zd icon checkbox radio"><span class="zd checked <%=selected %>"></span></span>',defaults:{template:i,checkbox:true},initialize:function(e){t.Views.ObjectFieldItem.prototype.initialize.apply(this,arguments);this.options=$.extend({},this.defaults,e);return this},render:function(){t.Views.ObjectFieldItem.prototype.render.apply(this,arguments);if(this.settings.checkbox){var e=this.model.get("selected"),n=this.model.get("disabled"),r=_.template(this.selectTemplate,{selected:e?" selected":""});this.$el.prepend(r);e?this.$el.addClass("selected"):null;n?this.$el.addClass("disabled"):null}else this.$el.addClass("minimal");return this}})})(window,Zoomdata);(function(e,t){var n=function(e){return new t.Components.MetricFormatter(e)},r=_.template('            <dt title="<%= label==="Count"?"Volume":label%> <%=func ? "("+func+")": ""%>"><%= label==="Count"?"Volume":label%> <%=func ? "("+func+")": ""%>:</dt>            <dd><%=value%></dd>        '),i=_.template('            <dt title="<%= label%>"><%= label%>:</dt>            <dd><%= from%></dd>            <dd><%= to%></dd>        '),s=_.template("            <legend><%= label%></legend>        "),o=_.template('            <button title="Show Details" value="button-details" class="zd btn btn-success btn-block">Details</button>         '),u=t.Utilities.time.getEndTimeWithinStep;t.Views=t.Views||{};t.Views.DataItem=t.MVC.View.extend({className:"zd-data-item",defaults:{dataItemTemplate:r,timeItemTemplate:i,groupDelimiter:s,detailsButton:o},events:{},initialize:function(e){e=e||{};if(e.state){this.state=e.state;delete e.state}if(e.fields){this.fields=e.fields;delete e.fields}if(e.data){this.data=e.data;delete e.data}else this.data={};t.MVC.View.prototype.initialize.apply(this,arguments);this.options=$.extend({},this.defaults,e);return this},render:function(e){var t=this.state.get("timeTrendStep");e?this.data=e:e=this.data;var n=this.getCurrentTime(e);this.$el.empty();this.renderGroup("Current",e.current,n);if(e["historical"])this.renderGroup("Historical",e.historical,this.getHistoricalTime(e));this.delegateEvents();return this},update:function(e){var t=this.data,n=t.group,r=_.where(e,{group:n})[0];r&&this.render(r);return this},isTrends:function(){var e=this;return function(){return e.state.isTimeTrends()}()},getCurrentTime:function(e){var t=this.isTrends();var n=this.state.config.get("source");var r=this.state.get("timeTrendStep");if(typeof n.date!=="undefined"&&!t){if("DAY"===this.state.config.get("source").dataResolution){var i=new Date(this.state.time.get("fromTime")),s=new Date(this.state.time.get("time"));return{from:i.getUTCMonth()+1+"/"+i.getUTCDate()+"/"+i.getUTCFullYear(),to:s.getUTCMonth()+1+"/"+s.getUTCDate()+"/"+s.getUTCFullYear()}}return{from:(new Date(this.state.time.get("fromTime"))).toLocaleString(),to:(new Date(this.state.time.get("time"))).toLocaleString()}}else if(t){if("DAY"===this.state.config.get("source").dataResolution){var i=new Date(e.group),s=new Date(u(e.group,r));return{from:i.getUTCMonth()+1+"/"+i.getUTCDate()+"/"+i.getUTCFullYear(),to:s.getUTCMonth()+1+"/"+s.getUTCDate()+"/"+s.getUTCFullYear()}}return{from:(new Date(e.group)).toLocaleString(),to:(new Date(u(e.group,r))).toLocaleString()}}else return null},getHistoricalTime:function(e){var t=this.isTrends();var n=this.state.config.get("source");var r=this.state.get("timeTrendStep");if(typeof n.date!=="undefined"&&!t)return{from:(new Date(this.state.time.get("historicalFrom"))).toLocaleString(),to:(new Date(this.state.time.get("historicalTo"))).toLocaleString()};else if(t)return{from:(new Date(e["historical"].group)).toLocaleString(),to:(new Date(u(e["historical"].group,r))).toLocaleString()};else return null},renderGroup:function(e,t,i){var s=$("<dl></dl>"),o=this.state.get("volume"),u=this.state.get("color"),a=this.fields;this.$el.append(this.options.groupDelimiter({label:e})).append(s);i!==null?s.append(this.options.timeItemTemplate({label:"Time Window",from:i.from||null,to:i.to||null})):null;s.append(this.options.dataItemTemplate({label:"Count",value:n("NUMBER").format(t.count),func:null}));if(t.metrics)_.each(t.metrics,function(e,t){var i="";for(var o in e){i=o;var u=_.filter(a.models,function(e){return t===e.get("name")||e.distinctCount});var f=_.find(u,function(e){if(e.get("func")&&i==="distinct_count")return e.get("distinctCount");else if(e.get("func")&&i!=="distinct_count")return i===e.get("func").toLowerCase();else return i==="avg"||i==="distinct_count"});if(!f)f=_.find(u,function(e){return e.get("name")===t});var l=f.get("label"),c=f.get("type");s.append(r({label:l,value:i!=="distinct_count"?n(c).format(e[i]):e[i],func:i}))}})},_onShowDetails:function(){this.renderDetails()}})})(window,Zoomdata);(function(e,t){function h(e){var t=this.state.get("streamSourceId"),n=e.data("itemid"),r="service/stream/"+t+"/"+n,i=e.find("blockquote");e.show();i.html(this.$progressBar.clone());$.get(r,function(e){if(e.htmlVerbatim)i.html(e.htmlVerbatim);else i.html("<div>No chat available</div>")});return this}function p(e){e.hide();return this}var n=t.Views.ListView,r=t.MVC.Model.extend({idAttribute:"_id",initialize:function(){var e=this;t.MVC.Model.prototype.initialize.apply(this,arguments);this.fields=this.collection.fields;this.setFields();this.on("change",function(){e.setFields()});return this},setFields:function(e){var t=this;this.fields=e||this.fields;_.each(_.keys(this.attributes),function(e){if(e!=="_zdFields"){var n=t.fields.findWhere({name:e});t.attributes["_zdFields"]=t.attributes["_zdFields"]||{};t.attributes["_zdFields"][e]=n&&n.toJSON()||{label:e}}})}}),i=t.MVC.Collection.extend({model:r,initialize:function(e,n){if(n.fields){this.fields=n.fields;delete n.fields}t.MVC.Collection.prototype.initialize.apply(this,arguments);return this}}),s=function(e){return new t.Components.MetricFormatter(e)},o=_.template('            <button title="Get More Details" value="button-more" class="zd btn btn-success btn-block">                More            </button>         '),u=_.template('            <div class="progress progress-striped active">                <div class="bar" style="width: <%=value%>%"></div>             </div>        '),a=_.template('            <legend>                <h4 class="pull-left"><%=title%></h4>                <div class="clearfix"></div>             </legend>        '),f=_.template('            <div class="media minimized" data-role="item-holder">                <div class="media-body">                    <h4 class="media-heading">                        <%= attributes.time != null ? new Date(attributes.time).toLocaleString(): ("Item " + model.index) %>                    </h4>                    <div class="media">                        <blockquote data-role="item-holder">                            <div class="zd-data-item-details-holder" data-role="details-holder">                                <table class="table table-striped">                                    <%_.each(_.keys(attributes), function (key, index) {%>                                        <% if (key !== "_id" && key !== "time" && key !== "_zdFields" && attributes._zdFields[key]) {%>                                            <tr>                                                <td><%=attributes._zdFields[key].label%></td>                                                <td><%=attributes[key]%></td>                                            </tr>                                        <%}%>                                    <%});%>                                </table>                             </div>                            <button value="button-item-details" class="zd btn-link">                                Expand <i class="icon-chevron-down"></i>                            </button>                         </blockquote>                    </div>                 </div>             </div>         '),l=_.template('            <div class="media minimized" data-role="item-holder">                <div class="media-body">                    <h4 class="media-heading">                        <span><%=attributes.rep_dn%></span>                        <small class="pull-right"><%=new Date(attributes._ts).toLocaleString()%></small>                        <div class="clearfix"></div>                     </h4>                    <div class="media">                        <blockquote>                            <%=attributes.text%>                            <br>                            <div data-role="details-holder" data-itemid="<%=attributes._id%>" style="display: none;" class="media">                                <div class="media-body">                                    <blockquote>                                    </blockquote>                                 </div>                             </div>                             <button value="button-item-details" class="zd btn-link">Expand <i class="icon-chevron-down"></i></button>                         </blockquote>                    </div>                 </div>             </div>         '),c=_.template('            <div data-role="item-holder" class="media">                <a class="zd pull-left thumbnail" target="_blank" href="https://twitter.com/<%=attributes.user_screen_name%>" class="pull-left">                    <img title="<%=attributes.user_name%>" class="media-object" src="<%=attributes.profile_image_url%>">                </a>                <div class="media-body">                    <h4 class="media-heading">                        <a title="<%=attributes.user_name%>" target="_blank" href="https://twitter.com/<%=attributes.user_screen_name%>">                        <%=attributes.user_name%>                        </a>                        <small class="pull-right"><%=new Date(attributes.created).toLocaleString()%></small>                        <div class="clearfix"></div>                     </h4>                    <blockquote>                        <a                             title="<%=attributes.user_name%>"                            target="_blank"                            href="https://twitter.com/<%=attributes.user_screen_name%>/status/<%=attributes.id%>"                        >                        <%=attributes.text%>                        </a>                         <small>                            <a title="<%=attributes.user_name%>" target="_blank" href="https://twitter.com/<%=attributes.user_screen_name%>">                                @<%=attributes.user_screen_name%>                            </a>                        </small>                    </blockquote>                </div>            </div>        ');t.Views=t.Views||{};t.Views.DataDetails=t.MVC.View.extend({className:"zd-data-item-details",defaults:{template:a,itemTemplate:f,filter:function(){return true},search:false,count:15,offset:0},events:{"click button[value='button-more']":"_onMoreClick","click button[value='button-item-details']":"_onItemDetailsClick"},initialize:function(e){if(e.state){this.state=e.state;delete e.state}if(e.fields){this.fields=e.fields;delete e.fields}if(e.data){this.data=e.data;delete e.data}else this.data={};t.MVC.View.prototype.initialize.apply(this,arguments);this.collection=this.collection||new i([],{fields:this.fields});this.list=new n({collection:this.collection,filter:this.options.filter,search:this.options.search,template:this.options.itemTemplate});this.childViews.push(this.list);this.$progressBar=$(u({value:100}));this.$moreButton=$(o());var r=this.state.config.get("streamType"),s=this.state.get("streamSourceId"),a=this.state.get("groupBy"),d=this.data.group,v=this.data.key,m=this.data.current.count,g=this.state.filters,y=e.fromTime,b=e.toTime,w=g.toJSON(),E={streamSourceId:s,fromTime:y,toTime:b,restrictions:w,itemTemplate:f,title:m+" Total Record"+(m>1?"s":"")};if(a!==this.state.get("timestampField"))if(["SIDE_BY_SIDE_BARS","STACKED_BARS"].indexOf(this.state.config.get("type"))!=-1&&$.isArray(a)){w.push({path:a[1],operation:"EQUALS",value:d});w.push({path:a[0],operation:"EQUALS",value:v})}else w.push({path:a,operation:"EQUALS",value:d});switch(r){case"TWEET":E.itemTemplate=c;E.title=m+" Total Tweet"+(m>1?"s":"");break;case"LIVE_PERSON":E.itemTemplate=l;this.showDetails=h;this.hideDetails=p;break}this.setOptions(E);this.fields=t.sources.get(s).objectFields;return this},setOptions:function(e){e=e||{};this.options=$.extend({},this.options,e);this.options.itemTemplate?this.list.options.template=this.options.itemTemplate:null;return this},render:function(){this.$el.html(this.options.template({title:this.options.title}));this.$el.append(this.list.render().el);this.renderDetails();this.delegateEvents();return this},renderDetails:function(e){var t=this;this.setOptions(e);this.forbidMore();this.showLoader();this.getDetails().done(function(e){var n=e.documents;_.each(n,function(e,n){var r,i,o;for(i in e){r=t.fields.findWhere({name:i});o=r&&r.get("type");if(r&&(o==="MONEY"||o==="TIME"||o==="NUMBER"))e[i]=s(r.get("type")).format(e[i])}});t.hideLoader();t.allowMore();t.collection.add(n,{silent:true});t.collection.forEach(function(e,t){e.index=t+1});t.list.render();e.hasNext?t.allowMore():t.forbidMore()}).fail(function(e){t.$el.append($('<div class="alert alert-error">'+"Failed to fetch documents: "+e.statusText+"</div> "))})},getDetails:function(){var e=$.Deferred(),t={},n=0;this.fields.bootstrap().done(function(){n++;n==2?e.resolve(t):null}).fail(function(t){e.reject(t)});var r={count:this.options.count,offset:this.options.offset,streamSourceId:this.options.streamSourceId,restrictions:this.options.restrictions,toTime:this.options.toTime};this.options.fromTime?r.fromTime=this.options.fromTime:null;this.state.get("timestampField")?r.timestampField=this.state.get("timestampField"):null;$.ajax({type:"POST",url:"service/stream/preview",data:JSON.stringify(r),contentType:"application/json"}).done(function(r){t=r;n++;n==2?e.resolve(t):null}).fail(function(t){e.reject(t)});return e.promise()},allowMore:function(){var e=this;this.$el.on("scroll",function(){var t=e.$el.prop("scrollHeight"),n=e.$el.scrollTop(),r=e.$el.height();if(t-n<=r)e.renderDetails({offset:e.collection.length})});return this},forbidMore:function(){this.$el.off("scroll");return this},showLoader:function(){this.$el.append(this.$progressBar)},hideLoader:function(){this.$progressBar.remove()},toggleItemDetails:function(e){var t=this;e=e||this.$('[data-role="item-holder"]');e.each(function(){var e=$(this),n=e.find('button[value="button-item-details"]'),r=e.find('[data-role="details-holder"]');if(e.hasClass("open")){e.removeClass("open");e.addClass("minimized");n.html('Expand <i class="icon-chevron-down"></i>');t.hideDetails(r)}else{e.addClass("open");e.removeClass("minimized");n.html('Collapse <i class="icon-chevron-up"></i> ');t.showDetails(r)}})},showDetails:function(e){return this},hideDetails:function(e){return this},_onItemDetailsClick:function(e){var t=$(e.currentTarget),n=t.parents('[data-role="item-holder"]');this.toggleItemDetails(n,t)}})})(window,Zoomdata);(function(e,t){function s(){var e=window.getComputedStyle(document.documentElement,""),t=(Array.prototype.slice.call(e).join("").match(/-(moz|webkit|ms)-/)||e.OLink===""&&["","o"])[1];return"-"+t+"-"}var n='            <div class="color-key">                 <div class="color-key-content">                     <div class="color-key-metric-label"><b><%= metricLabel %></b></div>                     <div class="color-key-linear-view">                         <div class="color-key-scale"></div>                         <div class="color-key-labels"></div>                     </div>                     <ul class="color-key-list-view unstyled" style="display: none;"></ul>                 </div>	            </div>	        ',r='<div class="color-item" style="background: <%= color %>;"></div>',i='<li class="color-list-item"><div class="color-item" style="background: <%= color %>;"></div></li>';t.Views=t.Views||{};t.Views.ColorKey=t.MVC.View.extend({defaults:{isDraggable:true},initialize:function(e){_.bindAll(this,"render","remove");if(e.controller){this.controller=e.controller;delete e.controller;if(this.controller.state.colorMetric)this.colorMetricLabel=this.controller.state.colorMetric.get("label")}else throw new Error("controller must be defined");if(e.type){this.type=e.type;delete e.type}else this.type="gradient";t.MVC.View.prototype.initialize.apply(this,arguments);if(this.options.isDraggable){this.$el.draggable({start:function(){$(this).css({bottom:"auto",right:"auto"})},cursor:"move",containment:this.$el.parent()});this.$el.on("drag",function(e){e.stopPropagation()})}},render:function(){var e,t;if(!this.colorMetricLabel)return this;this.colorMetric=this.controller._controller.metrics[this.colorMetricLabel];if(!this.colorMetric){this.hide();return this}e=this.colorMetric.get("label");t=this.colorMetric.metric.func;if(t&&this.colorMetric.metric.name!=="none")e+=" ("+t+")";this.$el.empty().append(_.template(n,{metricLabel:e}));this.initScale();this.initLabels();this.delegateEvents();return this},fixPosition:function(){var e=this.$el.parent().width()-this.$el.width()-5,t=this.$el.parent().height()-this.$el.height()-5,n=this.$el.position();if(n.top>t)this.$el.css("top",t);if(n.left>e)this.$el.css("left",e)},cloneTo:function(e){var t=this.$el.find(".color-key").clone().show();e.append(t)},initScale:function(){var e=s(),t=this.$el.find(".color-key-scale").empty(),n=this.$el.find(".color-key-list-view").empty(),o=this.colorMetric.colorRange()||[];if(!o.length)return;if(this.colorMetric.metric.name==="none")o=[o[0],o[0]];if(this.controller.state.divergingColorRange==="gradient"||this.colorMetric.metric.name==="none"){this.$el.find(".color-key").css("width","");n.hide();t.show().css("width",null).css("background",e+"linear-gradient(left, "+o.join(",")+")").css("background","linear-gradient(to right, "+o.join(",")+")")}else if(o.length<=3){this.$el.find(".color-key").css("width","");n.hide();t.show().css("width","85%").css("background","transparent");$.each(o,function(e,n){t.append(_.template(r,{color:n}))});t.find(".color-item").css("width",100/o.length+"%")}else{this.$el.find(".color-key").css("width",135);t.hide();n.show();$.each(o,function(e,t){n.append(_.template(i,{color:t}))})}},initLabels:function(){var e=this.colorMetric.domain()||[],t=this.$el.find(".color-key-list-view li"),n=this.$el.find(".color-key-labels").empty();if(this.controller.state.divergingColorRange==="gradient")e=[e[0],e[e.length-1]];if(this.colorMetric.metric.name==="none")e=[];if(e&&typeof e[0]!=="undefined"){$.each(e,function(t,r){if(r>10)e[t]=r=r.toFixed(0);else if((r*100).toFixed(0)!==(r*100).toString())e[t]=r=r.toFixed(2);if(e.length<=4)n.append('<span class="color-key-label">'+r+"</span>")});if(e.length>4)t.each(function(t,n){var r=e[t];if(e[t+1])r+=" - "+e[t+1];else r+=" +";n.innerHTML+=r})}if(this.controller.state.divergingColorRange!=="gradient"&&e.length<=4)n.find(".color-key-label").css("width",100/e.length+"%")},show:function(){this.$el.show();this.fixPosition()},hide:function(){this.$el.hide()},isVisible:function(){return this.$el.is(":visible")}})})(window,Zoomdata);(function(e,t){t.Components=t.Components||{};var n=t.Views.SmallObjectFieldItem;var r=t.Views.GroupedListView;var i=t.Views.MetricPalette;var s=t.Views.TimeScaleControl;var o=t.Views.DataItem;var u=t.Views.DataDetails;var a=t.eventDispatcher;var f=t.Utilities.time.getEndTimeWithinStep;var l="$Metric";var c="$Groupby";var h="$Source";var p={VERTICAL_BARS:"Vertical Bars: "+h+" - "+l+" by "+c,PIE:"Pie Chart: "+h+" - "+l+" by "+c,HEAT_MAP:"Heatmap: "+h+" - "+l+" by "+c,PIVOT_TABLE:"Pivot Table: "+h+" - "+l+" by "+c,WORD_CLOUD:"Word Cloud: "+h+" - "+l+" by "+c,BUBBLES:"Bubbles: "+h,SIDE_BY_SIDE_BARS:"Side-by-side Bars: "+h,MULTI_LINE:"Multi Line: "+h,MULTI_METRIC_TREND:"Multi-Metric Trend: "+h,TRENDS:"Time Trends: "+h+" - Time Trends by "+l,ZOOMABLE_MAP:"Zoomable Map: "+h,STACKED_BARS:"Stacked Bars: "+h};t.Components.InteractiveElementsMethods=function(){this.registerInteractiveElements=function(e,l,c,h){function E(e){w.push({name:"info",group:v(),label:"Info",type:"icon",action:function(n,r){function w(){d.on("thread:message",S);d.on("thread:timeline",x);var e=new t.Controls.InfoPopup({containment:t.main.$section,customClass:b?"":"zd-infopopup-hide-details"});var n=null;if(b)n=[{label:"Details",type:"success",callback:function(){e.hide();E()}}];e.setActions(n).render(y.render().el,p.state.isTimeTrends()?g:(i.key?i.key+", ":"")+i.group).position({of:r,my:"left top-30",at:"center center",collision:"flipfit flipfit"});e.onHide=function(){d.off("thread:message",S);d.off("thread:timeline",x);y.remove()}}function E(){var e=new t.Controls.DetailsPopup({containment:t.main.$section,modal:true,wide:true});e.onHide=function(){b.remove()};if(["SIDE_BY_SIDE_BARS","STACKED_BARS"].indexOf(p.config.get("type"))!=-1&&$.isArray(s))s=s[1];e.render(b.render().el,p.state.isTimeTrends()?g:l.findWhere({name:s}).get("label")+": "+i.group).position({of:t.main.$section,my:"center top",at:"center top",collision:"flip flip"})}function S(e){y.update(e)}function x(){y.render()}var i=v(),s=p.state.get("groupBy"),a=p.state.get("volume"),l=p.fields,c=p.state.time.get("fromTime"),h=p.state.time.get("time"),m=p.state.get("timeTrendStep"),g="";if(p.state.isTimeTrends()){c=i.group;h=f(i.group,m);g=(new t.Components.MetricFormatter(m)).format(i.group)}var y=new o({state:p.state,fields:l,data:i});var b=null;if(!e.hideDetails)b=new u({state:p.state,fields:l,data:i,fromTime:c,toTime:h});w()}})}function S(){w.push({name:"trend",group:v(),label:"Trend",action:function(){var e=function(e){var n=v(),r=p.state.get("groupBy"),i=p.state.filters,s={editable:true,operation:"IN",path:r,value:[n.group]},o=i.findWhere({path:r});if(["SIDE_BY_SIDE_BARS","STACKED_BARS"].indexOf(p.config.get("type"))!=-1&&$.isArray(r))s=[{editable:true,operation:"IN",path:r[1],value:[n.group]},{editable:true,operation:"IN",path:r[0],value:[n.key]}];e.bootstrap().done(function(){if(o)o.hasAttribute(n.group)?o.set(s,{silent:true}):o.addAttribute(n.group,{silent:true});else $.isArray(s)?_.each(s,function(e){p.state.filters.add(e,{silent:true})}):p.state.filters.add(s,{silent:true});p.setVisualization(e)}).fail(function(){var e=new t.Controls.Notification({type:"error"});e.render("Couldn't configure Time Trends visualization.")})};y.visualizations.bootstrap().done(function(){if(p._controller.trends){var t=p._controller.trends(y.visualizations.toJSON());if(t)e(y.visualizations.findWhere({visId:t.visId}))}else e(y.visualizations.findWhere({type:"TRENDS"}))})}})}function x(){w.push({name:"filter_all",group:v(),disabled:function(){return t.Utilities.isSingleVizualization()},label:"Filter <br> all",action:function(){var e=v(),t=p.state.config.sourceId,n=p.state.get("groupBy"),r={editable:true,operation:"IN",path:e.attr||n,value:[e.group]};if(["SIDE_BY_SIDE_BARS","STACKED_BARS"].indexOf(p.config.get("type"))!=-1&&$.isArray(n))r=[{editable:true,operation:"IN",path:n[1],value:[e.group]},{editable:true,operation:"IN",path:n[0],value:[e.key]}];a.trigger("visualization:filterAll",t,p.UUID,r,{timestampField:p.state.get("timestampField"),timeTrendStep:p.state.get("timeTrendStep")})}})}function T(){w.push({name:"un_filter_all",group:v(),disabled:function(){return t.Utilities.isSingleVizualization()},label:"Un<br>Filter <br> all",action:function(){var e=v(),t=p.state.config.sourceId,n=p.state.get("groupBy"),r={editable:true,operation:"NOTIN",path:n,value:[e.group]};if(["SIDE_BY_SIDE_BARS","STACKED_BARS"].indexOf(p.config.get("type"))!=-1&&$.isArray(n))r=[{editable:true,operation:"IN",path:n[1],value:[e.group]},{editable:true,operation:"IN",path:n[0],value:[e.key]}];a.trigger("visualization:unfilterAll",t,p.UUID,r)}})}function N(){w.push({name:"filter",group:v(),label:"Filter",action:function(e,t){var n=v(),r=p.state.config.sourceId,i=p.state.get("groupBy"),s={editable:true,operation:"IN",path:n.attr||i,value:[n.group]};if(["SIDE_BY_SIDE_BARS","STACKED_BARS"].indexOf(p.config.get("type"))!=-1&&$.isArray(i))s=[{editable:true,operation:"IN",path:i[1],value:[n.group]},{editable:true,operation:"IN",path:i[0],value:[n.key]}];a.trigger("visualization:filter",r,p.UUID,s,t,{timestampField:p.state.get("timestampField"),timeTrendStep:p.state.get("timeTrendStep")})}})}function C(){w.push({name:"attribute",group:v(),label:"Attribute",action:function(i){var s=v();if(p.state.isTimeTrends()){var o=p.state.get("timeTrendStep"),u=new Date(s.group),a=new Date(t.Utilities.time.getEndTimeWithinStep(u,o)),f=t.Utilities.time.getRoundedDateRange(u,a),l=p.state.config.get("source").dataResolution;if(l&&o===l||o==="MINUTE")return;p.state.time.set({time:a.getTime()},{silent:true});p.state.set({timeTrendStep:f.step,limit:f.amount+1},{silent:true});p.state.trigger("change");return}var c=p.state.get("groupBy");if($.isArray(c))c=c[1];var d=new t.Controls.PalettePopup({containment:t.main.$section,customClass:"attributePalette",pointerWidth:14}),m=new r({className:"nav nav-tabs nav-stacked",ItemView:n,collection:p.fields,groupBy:"type",filter:function(t){var n=!!t.get("visible"),r=t.get("type")=="ATTRIBUTE",i=["SIDE_BY_SIDE_BARS","STACKED_BARS"],o=p.config.get("type");t.get("label")===s?t.set({selected:true},{silent:true}):t.set({selected:false},{silent:true});if(i.indexOf(o)!=-1){var u="";if(e.hasClass("groupBy1"))u=p._controller.variables["Second Group By"];else if(e.hasClass("groupBy2"))u=p._controller.variables["First Group By"];t.get("name")===u?t.set({disabled:true},{silent:true}):t.set({disabled:false},{silent:true})}return n&&r},comparator:function(e){return e.get("label")}});d.render(m.render().el,h);d.position({of:i,my:"left+20 top-30",at:"right center",collision:"flipfit flipfit"});p.listenToOnce(m,"select",function(t){if(t.get("disabled"))return;var n=p.config.get("type"),r=p.config.get("templateType"),i=["SIDE_BY_SIDE_BARS","STACKED_BARS"];if(i.indexOf(n)!=-1||i.indexOf(r)!=-1){if(e.hasClass("groupBy1"))p._controller.variables["First Group By"]=t.get("name");if(e.hasClass("groupBy2"))p._controller.variables["Second Group By"]=t.get("name");p.state.set({groupBy:[p._controller.variables["First Group By"],p._controller.variables["Second Group By"]]},{silent:false})}else p.state.set("groupBy",t.get("name"));d.remove();m.remove()})}})}function k(){var s=c.pivot();var o=c.callbacks();var u=v(),a=u.get&&u.get("type")==="ATTRIBUTE"||u.type==="ATTRIBUTE"?"attribute":"metric";if(a==="attribute")w.push({name:"attribute",group:v(),label:"Attribute",action:function(e){var i=new t.Controls.PalettePopup({containment:t.main.$section,customClass:"attributePalette",pointerWidth:14,handlers:o&&o.attribute&&o.attribute.onRemove?o.attribute.onRemove(u,"attributePalette"):null}),s=new r({className:"nav nav-tabs nav-stacked",ItemView:n,collection:p.fields,groupBy:"type",filter:o&&o.attribute&&o.attribute.filter?function(e){return o.attribute.filter(e,u)}:function(){return true},comparator:function(e){return e.get("label")}});i.render(s.render().el,h);i.position({of:e,my:"left+20 top-30",at:"right center",collision:"flipfit flipfit"});p.listenToOnce(s,"select",function(e){o&&o.attribute&&o.attribute.onClick?o.attribute.onClick(u,i,e):function(){return true}})}});else w.push({name:"metric",group:v(),label:"Metric",action:function(e,n){var r=new t.Controls.PalettePopup({containment:t.main.$section,customClass:"metricPalette",pointerWidth:14,handlers:o&&o.metric&&o.metric.onRemove?o.metric.onRemove(u,"attributePalette"):null}),s=new i({collection:p.fields,currentItem:u.attributes,filter:o&&o.metric&&o.metric.filter?function(e){return o.metric.filter(e,u)}:function(){return true}});r.render(s.render().el,h);r.position({of:n,my:"left+5 center",at:"center center",collision:"flipfit flipfit"});p.listenTo(s,"select:metric",function(e){o&&o.metric&&o.metric.onClick?o.metric.onClick(u,r,e):function(){return true}})}});p.elementsManager.register(e,{actions:w})}function L(){w.push({name:"timeScale",group:v(),label:"Time Scale",action:function(e){var n=v();var r=new t.Controls.PalettePopup({containment:t.main.$section,customClass:"timeScalePaletteContainer",pointerWidth:14}),i=new s({className:"timeScalePalette",currentItem:v()});r.render(i.render().el,h);r.position({of:e,my:"left+20 top-30",at:"right center",collision:"flipfit flipfit"});p.listenToOnce(i,"select",function(e){var n=[{name:"MINUTE",title:"Minutes",limit:60,time:60},{name:"HOUR",title:"Hours",limit:24,time:60*60},{name:"DAY",title:"Days",limit:7,time:60*60*24},{name:"WEEK",title:"Weeks",limit:5,time:60*60*24*7},{name:"MONTH",title:"Months",limit:12,time:60*60*24*31},{name:"YEAR",title:"Years",limit:4,time:60*60*24*365}];var s=n.filter(function(t){return e.toUpperCase()===t.name})[0],o=this._controller.state.get("timeTrendStep"),u=this._controller.state.get("limit"),a=new Date(this._controller.state.time.get("min")),f=new Date(this._controller.state.time.get("max")),l={MINUTE:t.Utilities.time.getRoundedDateRange(a,f,"MINUTE"),HOUR:t.Utilities.time.getRoundedDateRange(a,f,"HOUR"),DAY:t.Utilities.time.getRoundedDateRange(a,f,"DAY"),WEEK:t.Utilities.time.getRoundedDateRange(a,f,"WEEK"),MONTH:t.Utilities.time.getRoundedDateRange(a,f,"MONTH"),YEAR:t.Utilities.time.getRoundedDateRange(a,f,"YEAR")},c=l[s.name].amount+1;s.limit=t.Utilities.time.recalculateLimit(o,u,s.name);s.limit=s.limit>c?c:s.limit;this._controller.state.set({timeTrendStep:s.name,limit:s.limit},{silent:true});this._controller.state.trigger("change");r.remove();i.remove()})}})}function A(){w.push({name:"metric",group:v().label,label:"Metric",action:function(e,n){var r=v(),s=new t.Controls.PalettePopup({autohide:false,containment:t.main.$section,customClass:"metricPalette",pointerWidth:14}),o=new i({collection:p.visualizationController.fields,currentItem:$.extend({},p.field.toJSON(),p.metric.toJSON())});p.childViews.push(s);p.childViews.push(o);s.render(o.render().el,p.options.popoverTitle).position({of:n,my:"left+5 center",at:"center center",collision:"flipfit flipfit"});s.onHide=function(){o.trigger("hide");p.childViews.splice(p.childViews.indexOf(s),1);p.childViews.splice(p.childViews.indexOf(o),1)};p.listenTo(o,"select:metric",function(e){p.state.metrics.at(0).set(e)})}})}function O(){w.push({name:"radius",group:v().label,label:"Radius",action:function(e,n){var r=v(),s=new t.Controls.PalettePopup({containment:t.main.$section,customClass:"metricPalette",pointerWidth:14}),o=new i({collection:p.fields,currentItem:r});s.render(o.render().el,h);s.position({of:n,my:"left top-30",at:"center center",collision:"flipfit flipfit"});s.onHide=function(){o.trigger("hide")};p.listenTo(o,"select:metric",function(e){p.state.config.get("source").variables["_metric-radius"]=e.name+":"+e.func;p.state.trigger("change")})}})}function M(){w.push({name:"zoom",group:v(),label:"Zoom",action:function(e,i){function g(e){var t=p.state.get("groupBy"),n=p.state.filters,r=[{editable:true,operation:"IN",path:t[1],value:[s.group]},{editable:true,operation:"IN",path:t[0],value:[s.key]}];y.visualizations.bootstrap().done(function(){var t=y.visualizations.findWhere({type:"VERTICAL_BARS"});t.bootstrap().done(function(){_.each(r,function(e){p.state.filters.add(e,{silent:true})});t.get("source").variables["Comparison"]="Off";p.state.config.attributes.source.variables["First Group By"]=e.get("name");p.setVisualization(t)})})}var s=v();if(p.state.isTimeTrends()){var o=p.state.get("timeTrendStep"),u=new Date(s.group),a=new Date(t.Utilities.time.getEndTimeWithinStep(u,o)),f=t.Utilities.time.getRoundedDateRange(u,a),l=p.state.config.get("source").dataResolution;if(l&&o===l||o==="MINUTE")return;p.state.time.set({time:a.getTime()},{silent:true});p.state.set({timeTrendStep:f.step,limit:f.amount+1},{silent:true});p.state.trigger("change");return}var c=p.state.get("groupBy");if($.isArray(c))c=c[1];var h={editable:true,operation:"IN",path:c,value:[s.group]},d=new t.Controls.PalettePopup({containment:t.main.$section,customClass:"attributePalette"}),m=new r({className:"nav nav-tabs nav-stacked",ItemView:n,itemOption:{checkbox:false},collection:p.fields,groupBy:"type",filter:function(e){var t=!!e.get("visible"),n=e.get("type")=="ATTRIBUTE",r=e.get("name")==c;return t&&n&&!r},comparator:function(e){return e.get("label")}});d.render(m.render().el,"Zoom Into");d.position({of:i,my:"left+20 top-30",at:"center center",collision:"flipfit flipfit"});p.listenToOnce(m,"select",function(e){p.state.addFilter(h,{silent:true});if(p.config.get("type")==="SIDE_BY_SIDE_BARS"||p.config.get("type")==="STACKED_BARS")g(e);else p.state.set("groupBy",e.get("name"));d.remove();m.remove();t.eventDispatcher.trigger("zoomItem:select")})}})}function D(){w.push({name:"search_details",group:v(),label:"Details",action:function(e,n){function i(){var e=new t.Controls.InfoPopup({containment:t.main.$section,customClass:"searchResultsDetails"});var i=null,s=p.fields,o={};s.each(function(e){o[e.get("name")]=e.get("label")});var u=t.MVC.View.extend({itemTemplate:"<tr>\n                                        <td><%= name %></td>\n                                        <td><%= value %></td>\n                                    </tr>",tagName:"table",initialize:function(e){t.MVC.View.prototype.initialize.call(this,e);_.bindAll(this,"render");this.data=e.data||{};this.query=e.query||""},preg_quote:function(e){return(e+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1")},highlightMatchedWords:function(e){var t=e;if(typeof t=="string"&&this.query&&this.query!=="")t=e.replace(new RegExp("("+this.preg_quote(this.query).replace(" ","|")+")","gi"),"<span class='selected-result'>$1</span>");return t},render:function(){var e="";for(var t in this.data)if(this.data.hasOwnProperty(t)){var n=o[t],r=this.highlightMatchedWords(this.data[t]);e+=_.template(this.itemTemplate,{name:n,value:r})}this.$el.html(e);return this}});var a=new u({data:r.metadata,query:r.query});e.setActions(i).render(a.render().el,"Search Result Detail").position({of:n,my:"left top-30",at:"center center",collision:"flipfit flipfit"});e.onHide=function(){a.remove()}}var r=v();i()}})}function P(){w.push({name:"exclude",group:v(),label:"Exclude",type:"icon",action:function(){var e=v(),t=p.state.get("groupBy"),n=Array.isArray(t)?t[1]:t,r={editable:true,operation:"NOTIN",path:n,value:[e.group]};var i=p.state.filters.findWhere({path:n,operation:"NOTIN"});if(i){var s=i.get("value");if(s.indexOf(e.group)===-1)r.value=s.concat([e.group]);else return}p.state.addFilter(r)}})}function H(n){p.elementsManager.register(e,{actions:w,droppable:{scope:n,over:function(){},drop:function(n){var r=$(e),i=r.attr("data-zd-interactive-type"),s=v();if(i)switch(i){case"attribute":if(n.get("type")=="ATTRIBUTE"&&p.fields.findWhere({name:n.get("name")})!==null)p.state.set("groupBy",n.get("name"));break;case"metric":if(t.Utilities.isNumericAttributeType(n.get("type"))&&p.fields.findWhere({name:n.get("name")})!==null){var o=new t.Components.Metric({name:n.get("name"),func:n.get("func")?n.get("func").toLowerCase():"avg",type:n.get("type"),label:n.get("label")});p.state.set("volume",o)}break}else if(n.get("type")=="ATTRIBUTE"&&p.fields.findWhere({name:n.get("name")})!==null){if(p.config.get("type")==="TRENDS"){t.eventDispatcher.trigger("TimeTrendsZoomIn",s.group);return}var u=p.state.get("groupBy"),a={editable:true,operation:"IN",path:u,value:[s.group]};p.state.addFilter(a,{silent:true});p.state.set("groupBy",n.get("name"))}},out:function(){}}})}function B(){p.elementsManager.register(e,{actions:w,droppable:{scope:"objectField",over:function(){},drop:function(e){c.droppable.drop(e)},out:function(){}}})}if(this.isRemote)return null;if(typeof l=="object")c=l;else $(e).attr("data-zd-interactive-type",l);var p=this,d=this.thread,v=c.data,m=c.pivot,g=this.config.get("source"),y=t.sources.get(this.state.get("streamSourceId")),b=g.date!=="undefined",w=[];if(typeof v=="function")switch(l){case"searchDetails":D();H("search");break;case"search":D();x();T();N();H("search");break;case"timeScale":L();H("timeScale");break;case"attribute":C();H("objectField");break;case"metric":A();H("metric");break;case"groupBy1":C();H("objectField");break;case"groupBy2":C();H("objectField");break;case"radius":O();H("metric");break;case"objectFieldAcceptor":B();break;case"pivotLabel":k();B();break;default:E(c);if(b&&!this.state.isTimeTrends())S();x();T();N();M();if(!this.state.isTimeTrends())P();H("objectField");break}},this.releaseInteractiveElement=function(e,t){if(this.isRemote)return null;this.elementsManager.release(e,t)}}})(window,Zoomdata);(function(e,t){function r(){return false}function i(){return true}function s(e){var t=this._manager,n=this.options.droppable=$.extend({},this.defaults.droppable,e);n.over=function(r,i){var s=t.getElementInAction("drag");if(s&&n.scope&&n.scope==s.options.draggable.scope){console.log("hover options",n.scope);$(this).css({opacity:.7});typeof e.over=="function"?e.over.apply(this,s.$el.data(n.scope)):null}};n.drop=function(){var r=t.getElementInAction("drag");if(r&&n.scope&&n.scope==r.options.draggable.scope){$(this).css({opacity:1});typeof e.drop=="function"?e.drop.apply(this,r.$el.data(n.scope)):null}};n.out=function(r,i){var s=t.getElementInAction("drag");if(s&&n.scope&&n.scope==s.options.draggable.scope){$(this).css({opacity:1});typeof e.out=="function"?e.out.apply(this,s.$el.data(n.scope)):null}};this.$el.droppable(n);return this.$el.data("droppable")}function o(){this.droppable?this.droppable.destroy():null}function u(e){var t=this._manager,n=this.options.droppable=$.extend({},this.defaults.droppable,e);this.$el.on("mouseenter",function(){var r=t.getElementInAction("drag");if(r&&n.scope&&n.scope==r.options.draggable.scope){var i=this.getAttribute("data-zd-interactive-type");if(i==="attribute"||i==="metric")$(this).addClass("over");else $(this).css({opacity:.7});typeof e.over=="function"?e.over.apply(this,r.$el.data(n.scope)):null}});this.$el.on("mouseup",function(){var i=t.getElementInAction("drag"),s;if(i&&n.scope&&n.scope==i.options.draggable.scope){var o=this.getAttribute("data-zd-interactive-type");if(o==="attribute"||o==="metric")$(this).removeClass("over");else $(this).css({opacity:1});i.$el.draggable("option","revert",r);typeof e.drop=="function"?e.drop.call(this,i.$el.data(n.scope)):null}});this.$el.on("mouseleave",function(){var r=t.getElementInAction("drag");if(r&&n.scope&&n.scope==r.options.draggable.scope){var i=this.getAttribute("data-zd-interactive-type");if(i==="attribute"||i==="metric")$(this).removeClass("over");else $(this).css({opacity:1});typeof e.out=="function"?e.out.apply(this,r.$el.data(n.scope)):null}})}function a(){}function f(){var e;if(navigator.appVersion.indexOf("MSIE 10.")!=-1)e="MSPointerDown click";else e="click";return e}var n=t.eventDispatcher;t.Components=t.Components||{};t.Components.InteractiveElementController=function(e,t,n){var r=this,i=!!n.actions,s=!!n.draggable,o=!!n.droppable;_.bindAll(this,"_onInteractionStart","_onInteraction","_onInteractionEnd");if(typeof $(t).data("interactiveElement")!=="undefined"&&$(t).data("interactiveElement")!==null)throw new Error("An element already is an instance of interactiveElement");this._manager=e;this.element=t;this.$el=$(this.element);if(this.isSVG()){this._createDroppable=u;this._destroyDroppable=a}if(n.actionList){this.actionList=n.actionList;delete n.actionList}this.options={};this.options.interactions=$.extend({},this.defaults.interactions,n.interactions);i?this.options.actions=n.actions:null;o?this.droppable=this._createDroppable(n.droppable):this.droppable=null;s?this.draggable=this._createDraggable(n.draggable):this.draggable=null;this._allowed=[];this._prevented=[];this._allow(this.options.interactions.start);this._allow(this.options.interactions.action);this._allow(this.options.interactions.end);this.$el.data("interactiveElement",this)};t.Components.InteractiveElementController.prototype={defaults:{interactions:{start:"mousedown",action:f(),end:"mouseup"},draggable:{containment:"body",appendTo:"body",helper:"clone",revert:"invalid",addClasses:false,dragClass:"zd-interactive-draggable",cursor:"pointer",cursorAt:{left:25,top:25},zIndex:2e3,scope:"default"},droppable:{addClasses:false,tolerance:"pointer",activeClass:"zd-interactive-droppable-accepts",scope:"default"}},get:function(){var e=[];if(arguments.length==0)e=this.options;else if(arguments.length==1)e=this.options[arguments[0]]||null;else for(var t=0;t<arguments.length;t++)e[arguments[t]]=this.options[arguments[t]]||null;return e},set:function(e){},showActionsList:function(e){e=e||{};e.left=typeof e.left!=="number"?this.$el.offset().left+this.$el.width()/2:e.left;e.top=typeof e.top!=="number"?this.$el.offset().top+this.$el.height()/2:e.top;this.actionList.close().reset(this.options.actions).render(e);return this},isSVG:function(){return!!(this.element.tagName=="svg"||this.element.ownerSVGElement!==null)},_notify:function(e){this._manager._notify(e,this)},_createDroppable:s,_destroyDroppable:o,_createDraggable:function(e){var t=this,n=this.options.draggable=$.extend({},this.defaults.draggable,e);n.start=function(r,i){var s=i.helper;t._dragHelper=s;t._notify("drag:start");s.css("pointer-events","none");!s.hasClass(n.dragClass)?s.addClass(n.dragClass):null;typeof e.start=="function"?e.start.apply(this,arguments):null};n.drag=function(){typeof e.drag=="function"?e.drag.apply(this,arguments):null};n.stop=function(r,i){var s=i.helper;t._notify("drag:stop");t.$el.draggable("option","revert",n.revert);s.css("pointer-events","all");s.hasClass(n.dragClass)?s.removeClass(n.dragClass):null;typeof e.stop=="function"?e.stop.apply(this,arguments):null};this.$el.on("touchend",function(e){var t=document.elementFromPoint(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY);$(t).trigger("mouseup")});this.$el.draggable(n);return this.$el.data("draggable")},_destroyDraggable:function(){this.draggable?this.draggable.destroy():null;this._dragHelper instanceof jQuery?this._dragHelper.remove():null},_isAllowed:function(e){return this._allowed.indexOf(e)!==-1},_allow:function(e){function r(){n.$el.on(t.start,n._onInteractionStart)}function i(){n.$el.on(t.action,n._onInteraction)}function s(){n.$el.on(t.end,n._onInteractionEnd)}var t=this.options.interactions,n=this;if(!this._isAllowed(e)){this._allowed.push(e);switch(e){case t.start:r();break;case t.action:i();break;case t.end:s();break}}},_restrict:function(e){function r(){n.$el.off(t.start,n._onInteractionStart)}function i(){n.$el.off(t.action,n._onInteraction)}function s(){n.$el.off(t.end,n._onInteractionEnd)}var t=this.options.interactions,n=this;if(this._isAllowed(e)){this._allowed.splice(this._allowed.indexOf(e),1);switch(e){case t.start:r();break;case t.action:i();break;case t.end:s();break}}},_isPrevented:function(e){return this._prevented.indexOf(e)!==-1},_prevent:function(e){var t=this.options.interactions;if(!this._isPrevented(e)){this._prevented.push(e);switch(e){case t.start:this.$el.on(t.start,r);break;case t.action:this.$el.on(t.action,r);break;case t.end:this.$el.on(t.end,r);break}}},_release:function(e){var t=this.options.interactions;if(this._isPrevented(e)){this._prevented.splice(this._allowed.indexOf(e),1);switch(e){case t.start:this.$el.off(t.start,r);break;case t.action:this.$el.off(t.action,r);break;case t.end:this.$el.off(t.end,r);break}}},_onInteractionStart:function(e){var t=this.options,n=this.options.interactions;return null},_onInteraction:function(e){if($(e.target).hasClass("prevent-click-element")||$(e.target).closest(".prevent-click").get(0))return null;var t=this.options,n;if(t.actions&&t.actions.length)if(t.actions.length===1)t.actions[0].action($(e.target),e);else{n=d3.select(this.element).data()[0]||{};this.showActionsList({left:e.pageX,top:e.pageY,group:n.group});return false}return null},_onInteractionEnd:function(e){return null},destroy:function(){var e=this.options.interactions;this._destroyDroppable();this._destroyDraggable();this._restrict(e.action);this._restrict(e.start);this._restrict(e.end);this.$el.data("interactiveElement",null)}}})(window,Zoomdata);(function(e,t){var n=t.Components.InteractiveElementController;t.Components=t.Components||{};t.Components.InteractiveElementsManager=function(e){if(e.actionList){this.actionList=e.actionList;delete e.actionList}this.options=$.extend({},this.defaults,e);this.elements=[];this._interactions={}};t.Components.InteractiveElementsManager.prototype={defaults:{},register:function(e,t){function r(e,t){t.actionList=n.actionList;n.registered(e)?n.updateElement(e,t):n._addToRegistry(e,t)}var n=this;if(e instanceof Array)_.each(e,function(e){r(e,t)});else r(e,t)},release:function(e,t){function r(e,t){var r=n.getInteractiveElementFor(e);!!r?n._removeFromRegistry(r):null}var n=this;if(e instanceof Array)_.each(e,function(e){r(e,t)});else r(e,t)},getInteractiveElementFor:function(e){return _.find(this.elements,function(t){return t.element==e})},registered:function(e){return!!this.getInteractiveElementFor(e)},updateElement:function(e,t){var n=this.getInteractiveElementFor(e);if(!!n)n.set(t)},inProgress:function(e){return!!this._interactions[e]},getElementInAction:function(e){var t;this.inProgress(e)?t=this._interactions[e]:t=null;return t},_notify:function(e,t){var n=e.split(":")[0],r=e.split(":")[1];switch(r){case"start":this.inProgress(n)?this._stop(n):null;this._start(n,t);break;case"stop":this._stop(n);break}},_start:function(e,t){this._interactions[e]=t},_stop:function(e){delete this._interactions[e]},_removeFromRegistry:function(e){var t=this;_.each(_.keys(this._interactions),function(n){e==t.getElementInAction(n)?t._stop(n):null});e.destroy();this.elements.splice(this.elements.indexOf(e),1)},_addToRegistry:function(e,t){this.elements.push(new n(this,e,t))}}})(window,Zoomdata);(function(e,t){function i(e,t){var n=arguments.length>2?Array.prototype.slice.call(arguments,2):[];e.hasOwnProperty(t)&&typeof e[t]=="function"?e[t].apply(e,n):null}t.Components=t.Components||{};var n=t.eventDispatcher;var r=t.Components.Thread=function(e){var r=this;e=e||{};_.bindAll(this,"_onStreamError","_onMessage","_onTimeLine","_onStartFromTimeDone","_onStartVisDone","_onNoDataFound","_onDirtyData","_onNotDirtyData");if(e.dataStream)this.dataStream=e.dataStream;else throw new Error("dataStream must be defined");if(e.state){this.state=e.state;this.time=this.state.time}else if(e.config){this.state=new t.Models.State({streamSourceId:config.source.sourceId},{config:new t.MVC.Model(config)});this.time=this.state.time}else throw new Error("state or config must be defined");this.state.config.options={};this._progress=0;this.status("idle");this.onStreamError=$.noop;this.onMessage=$.noop;this.onTimeLine=$.noop;this.onStartFromTimeDone=$.noop;this.onStartVisDone=$.noop;this.onNoDataFound=$.noop;this.onPauseDone=$.noop;this.onSpeedUpdatedDone=$.noop;this.onDirtyData=$.noop;this.onNotDirtyData=$.noop;this.onPagination=$.noop;this.onPivotPaging=$.noop;this.listenTo(this.time,"change:time",this._onTimeChange);this.listenTo(this.time,"change:speed",this._onSpeedChange);this.listenTo(this.time,"change:paused",this._onPausedChange);this.listenTo(n,"stream:error",this._onStreamError);this.listenTo(n,"stream:message",this._onMessage);this.listenTo(n,"stream:TIME_LINE",this._onTimeLine);this.listenTo(n,"stream:START_FROM_TIME_DONE",this._onStartFromTimeDone);this.listenTo(n,"stream:START_VIS_DONE",this._onStartVisDone);this.listenTo(n,"stream:NO_DATA_FOUND",this._onNoDataFound);this.listenTo(n,"stream:PAUSE_DONE",this._onPauseDone);this.listenTo(n,"stream:UPDATE_SPEED_DONE",this._onSpeedUpdatedDone);this.listenTo(n,"stream:DIRTY_DATA",this._onDirtyData);this.listenTo(n,"stream:NOT_DIRTY_DATA",this._onNotDirtyData);this.listenTo(n,"stream:PAGINATION",this._onPagination);this.listenTo(n,"stream:PAGING",this._onPivotPaging)};_.extend(r.prototype,t.MVC.Events,{resetProgress:function(){this.progress(0)},progress:function(e){function n(e){t._progress=e;return t}function r(){return t._progress}var t=this;return typeof e=="undefined"?r():n(e)},destroy:function(){this.stop();this.stopListening()},setUUID:function(){this.UUID=t.Utilities.generateUUID();return this.UUID},getUUID:function(){return this.UUID},status:function(e){if(typeof e=="string"){this._status=e;this.trigger("status:change",e,this);return this}else return this._status},start:function(e){var n=this.state.toRequest(e);var r=JSON.stringify({type:"START_VIS",cid:this.UUID,request:n});this.status()!=="idle"?this.stop():null;console.log("Thread: start ",JSON.parse(r));this.dataStream.send(r);this.resetProgress();this.status("start");this.trigger("thread:start",JSON.parse(r));t.eventDispatcher.trigger("thread:start",JSON.parse(r))},stop:function(){var e=JSON.stringify({type:"STOP_VIS",cid:this.UUID});this.dataStream.send(e);this.resetProgress();console.log("Thread: stop",JSON.parse(e));this.status("idle")},pause:function(){var e=JSON.stringify({type:"PAUSE",cid:this.UUID});this.dataStream.send(e);console.log("Thread: pause",JSON.parse(e))},unpause:function(){var e=JSON.stringify({type:"UNPAUSE",cid:this.UUID});this.dataStream.send(e);console.log("Thread: unpause",JSON.parse(e))},togglePause:function(){var e=this.time.get("paused");e?this.unpause():this.pause()},startFromTime:function(e){var n=(new Date).getTime(),r=this.time,i,s;if(e>n&&"LIVE"===this.config.get("source").startFrom)e=null;i={speed:r.get("speed"),time:e,pauseAfterRead:r.get("paused")};s={type:"START_FROM_TIME",cid:this.UUID,request:i};console.log("Thread: startFromTime",s);this.dataStream.send(JSON.stringify(s));this.resetProgress();this.trigger("thread:time",s);t.eventDispatcher.trigger("thread:time",s)},startFromTimeTo:function(e){var t=(new Date).getTime(),n=this.time,r={},i=n.get("time");if(e>t)e=null;r={speed:n.get("speed"),timeWindow:e,pauseAfterRead:n.get("paused")};if(i&&i!==null)r.time=i;var s={type:"START_FROM_TIME",cid:this.UUID,request:r};this.dataStream.send(JSON.stringify(s));this.resetProgress()},updateSpeed:function(e){var t=JSON.stringify({type:"UPDATE_SPEED",cid:this.UUID,request:{speed:e|this.time.get("speed")}});this.dataStream.send(t);console.log("Thread: updateSpeed",t)},_onTimeChange:function(e,t){this.startFromTime(t)},_onSpeedChange:function(e,t){this.updateSpeed(t)},_onPausedChange:function(e,t){t?this.pause():this.unpause()},_onStreamError:function(e){var t=JSON.parse(e.data);if(t.cid==this.UUID){this.status("error");typeof this.onStreamError=="function"?this.onStreamError(t.data):null;this.trigger("thread:error",e)}},_onDirtyData:function(e){var t=JSON.parse(e.data);if(t.cid==this.UUID){this.status("dirtydata");typeof this.onDirtyData=="function"?this.onDirtyData(t.data):null;typeof t.progress=="number"?this.progress(t.progress):this.resetProgress();this.trigger("thread:dirtyData",t)}},_onNotDirtyData:function(e){var t=JSON.parse(e.data);if(t.cid==this.UUID){this.status("running");typeof this.onNotDirtyData=="function"?this.onNotDirtyData(t.data):null;this.progress(100);this.trigger("thread:notDirtyData",t)}},_onMessage:function(e){var t=JSON.parse(e.data);if(t.cid==this.UUID){this.status("progress");typeof this.onMessage=="function"?this.onMessage(t.data):null;this.trigger("thread:message",t.data)}},_onTimeLine:function(e){var t=JSON.parse(e.data);if(t.cid==this.UUID){if(t.source==="HISTORICAL"){this.time.set({historicalFrom:t.fromTime,historicalTo:t.toTime});return}this.stopListening(this.time,"change:time",this._onTimeChange);var n={fromTime:t.fromTime,time:t.toTime,min:t.minTime&&t.minTime!=="-1"?t.minTime:undefined,max:t.maxTime&&t.maxTime!=="-1"?t.maxTime:undefined,live:t.live,speed:t.speed};this.time.set(n);this.listenTo(this.time,"change:time",this._onTimeChange);this.status("progress");typeof this.onTimeLine=="function"?this.onTimeLine(t.data):null;this.trigger("thread:timeline",t.data)}},_onStartFromTimeDone:function(e){var t=JSON.parse(e.data);if(t.cid==this.UUID){this.status("progress");typeof this.onStartFromTimeDone=="function"?this.onStartFromTimeDone(t.data):null;this.trigger("thread:startFromTimeDone",t.data)}},_onStartVisDone:function(e){var t=JSON.parse(e.data);if(t.cid==this.UUID){this.status("progress");typeof this.onStartVisDone=="function"?this.onStartVisDone(t.data):null;this.trigger("thread:startVisDone",t.data)}},_onNoDataFound:function(e){var t=JSON.parse(e.data);if(t.cid==this.UUID){this.status("nodata");typeof this.onNoDataFound=="function"?this.onNoDataFound(t.data):null;this.trigger("thread:noData",t.data)}},_onPauseDone:function(e){var t=JSON.parse(e.data);if(t.cid==this.UUID){this.time.set("paused",true);typeof this.onPauseDone=="function"?this.onPauseDone(t):null;this.trigger("thread:pauseDone",t)}},_onSpeedUpdatedDone:function(e){var t=JSON.parse(e.data);if(t.cid==this.UUID){typeof this.onSpeedUpdatedDone=="function"?this.onSpeedUpdatedDone(t.data):null;this.trigger("thread:updateSpeedDone",t.data)}},_onPagination:function(e){var t=JSON.parse(e.data);if(t.cid===this.UUID){this.state.set("nextPageAvailable",t.nextPageAvailable,{silent:true});this.state.set("pages",t.pages,{silent:true});this.state.set("precise",t.precise,{silent:true});this.state.trigger("pages");typeof this.onPagination=="function"?this.onPagination(t):null;this.trigger("thread:pagination",t)}},_onPivotPaging:function(e){var t=JSON.parse(e.data);if(t.cid===this.UUID){this.state.set("pagesCount",t.pagesCount,{silent:true});this.state.set("precise",t.precise,{silent:true});typeof this.onPivotPaging=="function"?this.onPivotPaging(t):null;this.trigger("thread:pivotPaging",t)}}})})(window,Zoomdata);(function(e,t){t.Components=t.Components||{};var n=t.Collections.ComponentSources;var r=t.Collections.LibrariesSources;var i=t.Views.AxisLabel;var s=t.Views.ColorKey;var o=t.eventDispatcher;var u=t.Components.Thread;var a=t.Components.InteractiveElementsMethods;var f=t.Components.MetricAccessor;var l="$Source";t.Components.VisualizationController=t.MVC.View.extend({defaults:{},remove:function(){this.stopVisualization();this.removeVisualization();t.MVC.View.prototype.remove.apply(this,arguments)},initialize:function(e){var i=this,s,o;this.dfd=null;this.axisLabels=[];this.metrics={};this.progress=0;this.elementsManager=t.interactiveElements;if(typeof e.config=="object"){this.config=e.config;delete e.config}else throw new Error("config must be defined");if(typeof e.source=="object"){this.source=e.source;delete e.source;o=this.source}else throw new Error("source must be defined");if(typeof e.host=="object")this.isRemote=true;else this.isRemote=false;this._assemblyMethods();t.MVC.View.prototype.initialize.apply(this,arguments);this.state=new t.Models.State({streamSourceId:this.config.get("source").sourceId},{config:this.config});this.collection=new t.Collections.Graph([],{metric:{}});this.thread=new u({state:this.state,dataStream:t.dataStream});this.fields=o.objectFields;this.formulas=o.formulaList;this._configureMetricAccessors();this.time=this.state.time;this.$el.attr("data-visid",this.config.get("visId")).removeAttr("id");this.components=new n(this.config.get("components"),{visId:this.config.get("visId"),name:this.config.get("name"),remote:this.isRemote&&this.options.host.remote,secure:this.isRemote&&this.options.host.secure,apiKey:this.isRemote&&this.options.host.apiKey});this.libraries=new r(this.config.get("libs"),{remote:this.isRemote&&this.options.host.remote,secure:this.isRemote&&this.options.host.secure,apiKey:this.isRemote&&this.options.host.apiKey});this.resetIndicators();this.loadVisualization().done(function(){i.initVisualization();i.startVisualization()})},_configureMetricAccessors:function(){var e=this,t=e.config.get("variables"),n,r,i,s,o=[],u=this.metrics={},a=this.fields;$(t).each(function(e,t){if(t.type!=="metric")return;switch(t.metricType){case"color":r=t;if(typeof t.colors==="string")t.colors=JSON.parse(t.colors);if(t.savedColors&&typeof t.savedColors==="string")t.savedColors=JSON.parse(t.savedColors);s=t.colors.length;$.each(t.colors,function(e,t){if(r.savedColors&&typeof r.savedColors[e]==="string")o.push(r.savedColors[e]);else o.push(t.color)});break;case"size":i=t;break;case"position":n=t;break}});this.state.divergingColorRange="gradient";this.state.metrics.each(function(l){var c=l.get("name"),h=l.get("label"),p=_.where(t,{name:h})[0],d=p?p.type:"metric",v=l.isNone()?a.noneField:l.isCount()?a.volumeField:a.findWhere({name:c});if(d=="multi-metric")u[h]instanceof Array?u[h].push(new f(l.toJSON(),v.toJSON())):u[h]=[new f(l.toJSON(),v.toJSON())];else u[h]=new f(l.toJSON(),v.toJSON());if(r&&h===r.name){e.state.colorMetric=l;e.state.colorNumb=s;e.state.legendType=r.legendType||"range";e.state.divergingColorRange=r.divergingColorRange||"gradient";e.metrics[r.name].metric.colors=o;e.metrics[r.name].metric.colorsData=r.colors}else if(i&&h===i.name)e.state.sizeMetric=l;else if(n&&h===n.name)e.state.positionMetric=l});if(this._controller)this._controller.metrics=this.metrics},_onMetricChange:function(e){function s(e,t){var n=_.find(e,function(e){var n=e.metric.name==(typeof t.changed.name!=="undefined"?t.previous("name"):t.get("name"))&&e.metric.func==(typeof t.changed.func!=="undefined"?t.previous("func"):t.get("func"));return n});n.setAccessTo(t.toJSON(),i.toJSON())}var t=e.get("label"),n=e.get("name"),r=this.metrics[t],i=e.isNone()?this.fields.noneField:e.isCount()?this.fields.volumeField:this.fields.findWhere({name:n});r instanceof Array?s(r,e):r.setAccessTo(e.toJSON(),i.toJSON());this.restartVisualization()},_onMetricAdd:function(e){var t=e.get("label"),n=e.get("name"),r=this.metrics[t],i=e.isCount()?this.fields.volumeField:this.fields.findWhere({name:n});r instanceof Array?null:r=[].concat(r);r.push(new f(e.toJSON(),i.toJSON()));this.restartVisualization()},_onMetricRemove:function(e){var t=e.get("label"),n=e.get("func"),r=e.get("name"),i=this.metrics[t]instanceof Array?this.metrics[t]:[].concat(this.metrics[t]),s=_.find(i,function(e){return e.metric.name==r&&e.metric.func==n});s&&i.splice(i.indexOf(s),1);this.restartVisualization()},_onMessage:function(e){if(typeof this._controller.processData=="function")this._controller.processData(e,this.thread.progress());else this.processSocketData(e);this.colorKey.render()},_onNoDataFound:function(){this._controller.onNoDataFound();this._onMessage([])},_onStartVisDone:function(){this.clearVisualization()},_onStartFromTimeDone:function(){this.collection.reset()},_assemblyMethods:function(){_.extend(this,new a)},_createAxisLabel:function(e){if(this.isRemote)return null;var t=new i($.extend({},e,{controller:this})),n=t.render().$el,r=$(this.el.parentElement),s=$(this.el);switch(e.position){case"left":var o=r.find(".widgetLabel.left").eq(0);if(!o||o.length===0){o=$('<div class="widgetLabel left"/>');r.prepend(o);s.css({width:"auto","margin-left":"50px"})}o.append(n);break;case"right":var u=r.find(".widgetLabel.right").eq(0);if(!u||u.length===0){u=$('<div class="widgetLabel right"/>');r.prepend(u);s.css({width:"auto","margin-right":"50px"})}u.append(n);break;case"top":var a=r.find(".widgetLabel.top").eq(0);if(!a||a.length===0){a=$('<div class="widgetLabel top"/>');r.prepend(a);s.css({"margin-top":"50px"})}a.append(n);break;case"bottom":var f=r.find(".widgetLabel.bottom").eq(0);if(!f||f.length===0){f=$('<div class="widgetLabel bottom"/>');r.prepend(f)}f.append(n);break}t.position();n.hide().show(0);this.axisLabels.push(t);return n},resetIndicators:function(){var e=this.config.get("controls")},setVisualization:function(e,n){var r=this,i=e.get("source"),s=i.volume&&i.volume.name||"count",o=["TRENDS","MULTI_METRIC_TREND"].indexOf(this.config.get("type"))!=-1,u="MULTI_LINE"===this.config.get("type"),a="SIDE_BY_SIDE_BARS"===this.config.get("type"),f=["MULTI_LINE","PIVOT_TABLE","MULTI_METRIC_TREND"],l=["SIDE_BY_SIDE_BARS"],c=["MULTI_LINE","MULTI_METRIC_TREND","TRENDS"],h=new t.Models.State({streamSourceId:e.get("source").sourceId},{config:e}),p=["clientSort","color","volume","timeWindowScale","timeTrendStep"],d=[],v=this.state.config.get("source").variables["First Group By"]||this.state.get("groupBy"),m=this.state.time.get("timeWindow")||this.config.get("source").variables["_oldTimeWindow"];for(var g=0,y=p.length;g<y;g++){var b=p[g],w=this.state.get(b);if(w!==undefined){d.push({name:b,value:w});if(b==="timeTrendStep")d.push({name:"limit",value:this.state.get("limit")})}}this.stopVisualization();this.removeVisualization();if(o||u||this.config.get("controls").indexOf("DataPalette")===-1){var E=this.config.get("source").variables["_oldFirstGroupBy"];var S=this.state.config&&this.state.config.get("source")&&this.state.config.get("source").timeWindowScale;E&&h.set("groupBy",E,{silent:true});h.set("timeWindowScale",S||m||"ROLLING_HOUR",{silent:true})}this.state.attributes=h.attributes;this.state.metrics.reset(h.metrics.models,{silent:true});this.config.set(e.attributes,{silent:true});this._configureMetricAccessors();this.libraries.reset(this.config.get("libs"));this.components.reset(this.config.get("components"));this.components.setVisId(this.config.get("visId"));this.components.setVisName(this.config.get("name"));var x={};if(c.indexOf(this.config.get("type"))){this.state.attributes.timeTrendStep="DAY";if(m)i.variables["_oldTimeWindow"]=m;if(v)i.variables["_oldFirstGroupBy"]=v}for(g=0;g<d.length;g++){var b=d[g].name;if(this.state.get(b)){if(b==="limit"&&d[g-1].name!=="timeTrendStep")continue;if(b==="color"&&d[g-1].func!=="")continue;x[b]=d[g].value}}this.state.set(x,{silent:true});if(v&&v!==this.state.get("timestampField")&&this.state.get("timestampField")!==this.state.get("groupBy")){this.state.set({groupBy:v},{silent:true});var T=this.state.config.get("source").variables["First Group By"],N=this.state.config.get("source").variables["Second Group By"];if(T&&v!==N)this.state.config.attributes.source.variables["First Group By"]=v}this.state.toRequest=t.Models.State.prototype.toRequest;if(a)this.state.toRequest=function(){var e=t.Models.State.prototype.toRequest.apply(this,arguments);if(e.cfg.group.page){delete e.cfg.group.page;delete e.cfg.group.pageSize}return e};if("Top"===i.variables["Limit Results by Rank"]){var C=i.variables["Limit"];if(C)this.state.set("limit",i.variables["Limit"],{silent:true});this.state.set("sort",{name:s,dir:"desc"},{silent:true})}else if("Bottom"===i.variables["Limit Results by Rank"]){var C=i.variables["Limit"];if(C)this.state.set("limit",i.variables["Limit"],{silent:true});this.state.set("sort",{name:s,dir:"asc"},{silent:true})}if("TRENDS"!==this.config.get("type")&&this.state.get("timeTrendStep"))this.state.unset("timeTrendStep",{silent:true});if("TRENDS"===this.config.get("type")){this.state.set("groupByBefore",this.state.get("groupBy"));this.state.set("groupBy",i.date)}if("HEAT_MAP"===this.config.get("type"))this.state.set("limit",i.variables["Limit"],{silent:true});if("PIVOT_TABLE"===this.config.get("type"))this.state.set("limit",1e3,{silent:true});this.loadVisualization().done(function(){r.initVisualization();r.startVisualization(n)});this.trigger("visualization:change")},applyEvents:function(){var e=this;this.listenTo(o,"visualization:showpopup",e.showPopup);this.listenTo(this.thread,"thread:message",this._onMessage);this.listenTo(this.thread,"thread:error",this._onStreamError);this.listenTo(this.thread,"thread:noData",this._onNoDataFound);this.listenTo(this.thread,"thread:startVisDone",this._onStartVisDone);this.listenTo(this.thread,"thread:startFromTimeDone",this._onStartFromTimeDone);this.listenTo(this.state,"change",this.restartVisualization);this.listenTo(this.state,"change:clientSort",this.refreshVisualization);this.listenTo(this.state.filters,"add remove change reset",this.restartVisualization);this.listenTo(this.collection,"add",function(e){this._controller.onAdd(e.toJSON())});this.listenTo(this.collection,"remove",function(e){this._controller.onRemove(e.toJSON())});this.listenTo(this.collection,"change",function(e){this._controller.onChange(e.toJSON())});this.listenTo(this.state.metrics,"change",this._onMetricChange);this.listenTo(this.state.metrics,"add",this._onMetricAdd);this.listenTo(this.state.metrics,"remove",this._onMetricRemove);this.listenTo(t.eventDispatcher,"restart",function(t){e.startVisualization()});this.on("resize",this._onResize)},muteEvents:function(){this.stopListening(o,"visualization:showpopup",this.showPopup);this.stopListening(this.thread,"thread:message",this._onMessage);this.stopListening(this.thread,"thread:error",this._onStreamError);this.stopListening(this.thread,"thread:noData",this._onNoDataFound);this.stopListening(this.thread,"thread:startVisDone",this._onStartVisDone);this.stopListening(this.state,"change",this.restartVisualization);this.stopListening(this.state,"change:clientSort",this.refreshVisualization);this.stopListening(this.state.filters,"add remove change reset",this.restartVisualization);this.stopListening(this.collection,"add");this.stopListening(this.collection,"remove");this.stopListening(this.collection,"change");this.stopListening(this.state.metrics,"change",this._onMetricChange);this.stopListening(this.state.metrics,"add",this._onMetricAdd);this.stopListening(this.state.metrics,"remove",this._onMetricRemove);this.off("resize",this._onResize);if(this._controller){$(this._controller.element).off("resize");this._controller.element.resize=null}},initVisualization:function(){var e=this,n=this.components.getComponentsNamespace(),r=t.Utilities.MODE.WIDGET===t.Utilities.mode();if(this._controller)this._controller.toolbar().remove();this._controller={element:this.el,state:this.getVisualizationState(),config:this.getSourceConfiguration(),scope:{},labels:this.axisLabels,metrics:this.metrics,fields:this.fields,onAdd:$.noop,onRemove:$.noop,onChange:$.noop,update:$.noop,onNoDataFound:$.noop,resize:$.noop,onStreamError:$.noop,registerInteractiveElements:function(t,n,r,i){e.registerInteractiveElements(t,n,r,i)},releaseInteractiveElement:function(t,n){e.releaseInteractiveElement(t,n)},registered:function(t){return e.elementsManager.registered(t)},customReadyStatusDelay:false,setVisualization:function(t){e.setVisualization(t)},createAxisLabel:function(t){return e._createAxisLabel(t)},toolbar:function(){var n=e._controller.toolbar;if(!n.$_toolbar){n.$_toolbar=$('                            <div class="zd-visualization-toolbar navbar">                                 <div class="navbar-inner">                                      <div class="container">                                         <ul class="nav pull-left"/>                                          <ul class="nav pull-right"/>                                     </div>                                  </div>                            </div>').prependTo($(e._controller.element).parent());var i=function(){return n.$_toolbar.find(".nav.pull-left")};var s=function(){return n.$_toolbar.find(".nav.pull-right")};n.append=function(o,u){if(o.item&&undefined!==o.item.availableForMode&&"function"===typeof o.item.availableForMode){var a=o.item.availableForMode(t.Utilities.mode());if(!a)return}var f=o.side||o.item&&o.item.side||"left",l=o.el||o.item&&o.item.render().el;if(!l){var c=new t.VisualizationControls.ToolbarItem(o);l=c.render().el}if("left"===f)u?i().prepend(l):i().append(l);else u?s().prepend(l):s().append(l);if(o.item&&o.name){if(!n._items)n._items={};n._items[o.name]=o.item}if(r&&o.item.icon!=="list")$(l).remove();else $(e._controller.element).css("height","calc(100% - 42px)");return n};n.get=function(e){return n._items&&n._items[e]||null};n.remove=function(){n._items=null;n.$_toolbar.remove();n.$_toolbar=null}}return n}};$.each(this.metrics,function(t,n){if(n.colorMetric){e._controller.colorMetric=n;return false}});var i=_.filter(this.config.get("controls"),function(e){return e.indexOf("ToolbarItem")>=0?e:null});if(i.length>0){var s=[];i.forEach(function(n){if(t.VisualizationToolbar[n]){var r=new t.VisualizationToolbar[n]({controller:e._controller});r.name=n;s.push(r)}});s=_.sortBy(s,function(e){return e.order||Number.MAX_VALUE});s.forEach(function(t){e._controller.toolbar().append({item:t,name:t.name})})}this._controller.variables=this.config.get("source").variables;this.components.where({type:"text/javascript"}).forEach(function(r){var i=r.getConstructorName();t.Visualizations[n][i](e._controller,t)});this._controller.update=this._controller.update||$.noop;this._controller.onAdd=this._controller.onAdd||$.noop;this._controller.onRemove=this._controller.onRemove||$.noop;this._controller.onChange=this._controller.onChange||$.noop;this._controller.clear=this._controller.clear||$.noop;this._controller.resize=this._controller.resize||$.noop;this._controller.onStreamError=this._controller.onStreamError||$.noop;var o=this.config.get("type");if(r&&o!=="PIVOT_TABLE")this._controller.toolbar().remove();this.initColorKey();this.applyEvents()},removeVisualization:function(){var e=this.config.get("visId"),t={},n=$("script"),r=this.$el.parent();this.components.each(function(r){if(r.get("type")==="text/javascript"){var i=r.get("id");n.each(function(n,r){if(r.getAttribute("src")&&r.getAttribute("src").indexOf(e)>-1&&r.getAttribute("src").indexOf(i)>-1)t[i]=$(r)})}});r.children().not(".widgetContent").remove();r.removeAttr("id");this.clearVisualization();this.collection.reset();if(this._controller){$(this._controller.element).children().not(".zd-legend").remove();if(this._controller.labels.length>0)this._controller.labels.forEach(function(e){e.remove();e=null})}this.$el.removeAttr("style data-visid");this.muteEvents();this.trigger("visualization:removed");for(var i in t)if(t.hasOwnProperty(i))t[i].remove()},initColorKey:function(){this.colorKey=new s({el:this.$el.find(".zd-legend"),controller:this,isDraggable:!this.isRemote})},loadVisualization:function(){var e=this,n=this.components.getComponentsNamespace();this.dfd=$.Deferred();if(t.Visualizations instanceof Array){e.trigger("visualization:loaded");this.dfd.resolve()}else{t.Visualizations[n]||(t.Visualizations[n]={});this.trigger("visualization:loading");this.$el.attr("data-visid",this.config.get("visId")).removeAttr("id");this.libraries.load().done(function(){e.components.load().done(function(){e.trigger("visualization:loaded");e.dfd.resolve()}).fail(function(t){throw t.message;e.trigger("visualization:loaded");e.dfd.reject(t)})}).fail(function(t){throw t.message;e.trigger("visualization:loaded");e.dfd.reject(t)})}return this.dfd.promise()},setUUID:function(){this.thread.setUUID();this.UUID=this.thread.getUUID();this.config.set("id",this.UUID);this._controller.UUID=this.UUID},applyScope:function(){var e=this,t=this._controller.state.config.attributes.components,n=document.styleSheets,r=null,i="uuid_",s=document.createElement("style"),o,u=e.config.attributes.visId;document.body.appendChild(s);o=s.scoped+"";s.parentNode.removeChild(s);if(o){var a=$('style[data-visid="'+u+'"]');a.appendTo(e.$el);a.attr("scoped","");a.scopedPolyFill();return}t.map(function(t){try{if(t.type==="text/css"){for(var s=0,o=n.length;s<o;s++){var a=n[s],f=t.id;if(u&&a.ownerNode.attributes["data-visid"]&&u===a.ownerNode.attributes["data-visid"].value&&f&&a.ownerNode.attributes["data-componentid"]&&f===a.ownerNode.attributes["data-componentid"].value&&a.UUID===undefined){r=a;break}}if(r){var l=e._controller.UUID;e.$el.attr("id",i+l);for(s=0,o=r.cssRules.length;s<o;s++){var c=r.cssRules?r.cssRules[s].selectorText.split(","):r.rules[s].selectorText.split(","),h="";c.forEach(function(e,t){h+="#"+i+l+" "+e+(t!==c.length-1?",":"")});if(r.cssRules){r.cssRules[s].selectorText=h;var p=_.extend({},r.cssRules[s]);r.removeRule?r.removeRule(s):r.deleteRule(s)}else{r.rules[s].selectorText=h;var p=_.extend({},r.rules[s]);r.removeRule?r.removeRule(s):r.deleteRule(s)}if(r.insertRule)r.insertRule(p.cssText,s);else r.addRule(h,p.style.cssText,s)}}}}catch(d){console.log("Scoped error",d);throw d}})},startVisualization:function(e){this.setUUID();if(this._controller.delayedStart&&this._controller.delayedStart===true)return;this.thread.start(e);return this},stopVisualization:function(){this.thread.stop();this.trigger("visualization:stop",this);o.trigger("visualization:stop",this);return this},restartVisualization:function(){this.stopVisualization();this.startVisualization(true)},refreshVisualization:function(){var e=this.state.get("clientSort"),t=this.state.metrics.at(0);if(t&&e)this.state.config.set("clientSort",e);var n=this.collection.toJSON();if(typeof this._controller.processData=="function")this._controller.processData(n,this.progress);this._updateMetricsDomain(n);this.processSocketData(n)},clearVisualization:function(){if(this._controller)typeof this._controller.clear=="function"?this._controller.clear():null;else if(this.dfd)this.dfd.reject();this.collection.reset()},getControlsList:function(){return this.getSourceConfiguration().controls||[]},getSourceConfiguration:function(){return this.config.toJSON()},getVisualizationState:function(){return this.state},updateVisualizationState:function(e){this.state.set(e);return this},processSocketData:function(e){if(this.state.get("clientSort")&&this.state.metrics.size()>0){var n=this.state.metrics.at(0).get("label");if($.isArray(this.metrics[n])&&this.metrics[n].length>0)this.collection.metric=this.metrics[n][0];else this.collection.metric=this.metrics[n];this.collection.setSortOrder(this.state.get("clientSort"))}if(e instanceof Array&&e.length>0){var r=[];var i=[];_.each(e,function(e){var n=new t.Models.Datum(e);if(e.current.count===-1)i.push(n);else r.push(n)});this.collection.remove(i,{merge:true});this.collection.add(r,{merge:true})}else this.collection.add(e,{merge:true});var s=this.collection.toJSON();this._updateMetricsDomain(s);this._controller.update(s,this.thread.progress())},_updateMetricsDomain:function(e){function n(r){$.each(r,function(r,i){if(i instanceof Array)n(i);else i._updateDomain(e,t.state.colorNumb)})}var t=this;n(this.metrics)},_updateMetricsDivergingColorRange:function(e){function t(n){$.each(n,function(n,r){if(r instanceof Array)t(r);else r.setColorRangeType(e)})}this.state.divergingColorRange=e;t(this.metrics)},_onResize:function(){var e=$(this._controller.element),n=e.parents(".widget").eq(0),r=n.width(),i=n.height(),s=e.width(),o=e.height(),u=t.Utilities.getWidgetSizeClass(r,i);e.trigger("resize",[s,o]);s=e.width();o=e.height();this.colorKey.fixPosition();this._controller.resize(s,o,u)},_onStreamError:function(e){this._controller.onStreamError(e)},startFromTime:function(e,t){this.thread.startFromTime(t)},startFromTimeTo:function(e,t){this.thread.startFromTimeTo(t)},updateSpeed:function(e,t){this.thread.updateSpeed(t)},togglePause:function(e){var t=this.thread;e!==undefined?e?t.unpause():t.pause():this.thread.togglePause()},getRestrictions:function(e){var t=e.restrictions;var n=_.map(t,function(e){return{path:e.path,operation:e.operation,value:e.value}});return _.filter(n,function(t){return t.path!=e.tsField})},getDefaultTemplate:function(e){return l},getVisualizationName:function(){var e=this,t=this.state.metrics,n=t.at(0),r=n?this.metrics[n.get("label")]:null,i=this.config.get("source"),s=this.config.get("type"),o=this.config.get("name"),u=this.state.get("groupBy"),a=this.fields.findWhere({name:u}),f=a?a.get("label"):u,c=i.sourceName;var h=i.variables["Visualization Name"]||this.getDefaultTemplate(s);var p=h||c;if(h)p=p.replace(l,c);return p}})})(window,Zoomdata);(function(e,t){function o(e,n,r){var i="/websocket/";if(e){i=e+i+"?key="+n;if(r)i="wss://"+i;else i="ws://"+i}t.dataStream=t.DataStreamProvider.getStream(i);t.dataStream.publish(t.eventDispatcher)}function u(t){t=t||{};var n,r,i,s,o=this,u=$.Deferred(),a=this.sources;if(typeof t.visualization=="string"&&t.visualization)n=t.visualization;else throw new Error("Invalid visualization name");if(typeof t.source=="string"&&t.source)r=t.source;else throw new Error("Invalid source name");if(t.element instanceof e.HTMLElement)s=t.element;else throw new Error("Invalid element");i=a.findWhere({name:r});u.done(function(e,t){var n={remote:o.host,secure:o.secure,apiKey:o.apiKey},r=l(e,t,s,n);o.visualizations.push(r)}).fail(function(e,t){var n=typeof e=="string"?e:null;console.warn(n||t+": "+e.statusText)}).progress(function(e){console.log(e)});if(i)f(n,i).then(u.resolve,u.reject,u.notify);else{u.notify("Loading Source");a.fetch({data:{name:r}}).then(function(e){var t,r;if(e[0]){t=e[0].id;r=a.get(t);f(n,r).then(u.resolve,u.reject,u.notify)}else u.reject("source doesn't exist")})}return u.promise()}function a(e){e=e||{};var t,n,r,i=$.Deferred();if(typeof e.visualization=="string"&&e.visualization)t=e.visualization;else throw new Error("Invalid visualization name");if(typeof e.source=="string"&&e.source)n=e.source;else throw new Error("Invalid source name");r=_.where(this.visualizations,{name:t,source:n})[0];if(r){i.notify("Closing visualization "+t);r.controller.remove();this.visualizations.splice(this.visualizations.indexOf(r),1);i.resolve()}else i.reject("Visualization doesn't exist");return i.promise()}function f(e,t){var n=t.visualizations.findWhere({name:e}),r=$.Deferred();if(n){r.notify("fetching visualization config for "+e);n.fetch().done(function(){r.resolve(n,t)}).fail(function(e,t){r.reject(e,t)})}else{r.notify("fetching visualizations for "+t.get("name"));t.visualizations.fetch().done(function(){var n=t.visualizations.findWhere({name:e});if(n){r.notify("fetching visualization config for "+e);n.fetch().done(function(){r.resolve(n,t)}).fail(function(e,t){r.reject(e,t)})}else r.reject("visualization doesn't exist")}).fail(function(e,t){r.reject(e,t)})}return r}function l(e,t,n,r){var s=$('<div class="widgetContent" style="position: relative; height: 100%;"></div>').appendTo(n)[0],o=new i({config:e,source:t,el:s,host:r}),u={name:e.get("name"),source:t.get("name"),controller:o};console.log(u);return u}t.Components=t.Components||{};var n={secureHost:false},r=t.Collections.Sources,i=t.Components.VisualizationController;var s=function(t){this.visualizations=[];if(typeof t.apiKey!=="undefined")this.apiKey=t.apiKey;else throw new Error("An apiKey must be defined");if(typeof t.secure!=="undefined")this.secure=t.secure;else this.secure=n.secure;if(typeof t.host!=="undefined")this.host=t.host;else throw new Error("An url must be defined");this.sources=new r([],{secure:this.secure,remote:this.host,apiKey:this.apiKey});o(this.host,this.apiKey,this.secure)};s.prototype={visualize:u,stop:a};t.Components.StandaloneClient=s;e.ZoomdataClient=s})(window,Zoomdata)